jQuery(function($){var position,content,options={},tempTooltipEle=void 0,tooltipTimer=void 0,tooltipTimeDelay=800,tooltip=void 0,targetEle=void 0,targetTitle=void 0,tooltipHeader=void 0,tooltipContent=void 0,tooltipCallout=void 0,tooltipIcon=void 0,tooltipShowTimer=void 0,tooltipAjaxTimer=void 0,tooltipTimeoutValue=void 0,tooltipOptions={},calloutDirection={northwest:"top",north:"top",northeast:"top",west:"left",east:"right",southwest:"bottom",south:"bottom",southeast:"bottom"},defaults={callout:"north",autohide:!0,mousetrack:!1,mouseEnter:!1,showShortcutKey:!0,contentType:"text",positionAlterable:!0,calloutHideMode:!1};function bindEvents(ele){this._windowEle=$(window),this._windowWidth=this._windowEle.width();var baseObj=this;this._windowEle.on("resize."+this.widgetName,function(ev){baseObj._windowWidth=baseObj._windowEle.width()}),this._documentEle=$(document),this._documentEle.on("keydown."+this.widgetName,function(eventObj){27==eventObj.keyCode&&removeTip(eventObj)}),$(ele).on("buttondisabled",function(orgEvent,ui){var objEle=$(ui.element),title=objEle.attr("title");ui.disabled?(objEle.removeAttr("title"),objEle.data("ztooltip",title)):objEle.attr("title",objEle.data("ztooltip"))}),$(ele).on("mouseover mouseup",function(ev){var objEle=function(ele,attr){var selector="["+attr+"]";try{ele=ele.is(selector)?ele:$(ele.parents(selector).get(0))}catch(e){}return ele}($(ev.target),"title"),title=objEle.attr("title");if(title&&objEle.length&&"document"!==objEle[0].nodeName.toLowerCase()){if(tooltipTimer&&clearTimeout(tooltipTimer),ev.stopPropagation(),ev.preventDefault(),objEle.attr("disabled")||objEle.hasClass("ui-state-disabled")||objEle.hasClass("ui-ztooltip-ignore"))return clearTitle(objEle),removeTip(),!1;clearTitle(objEle),options=$.extend({},defaults,function(ele,title){try{var parseOptions=$.parseJSON(title);return parseOptions.componentOptions?parseOptions.componentOptions:parseOptions={content:title}}catch(e){return eleOptions={content:title},eleOptions}}(0,title));var eleCallout=objEle.attr("callout");void 0!==eleCallout&&""!==calloutDirection[eleCallout]&&(options.callout=eleCallout),$(tooltip).length&&$(tooltip).find(".ui-ztooltip-close").remove(),tooltipTimeDelay=800,function(ev,ele){var isHtmlContent="html"==options.contentType;!0!==options.mouseEnter&&!0!==options.mousetrack||(options.callout="northwest");var tooltipEle=function(ele){var checkTooltip=!!tooltip,contentCornerClass="ui-corner-all",contentClass=options.ajaxContent?"ui-ztooltip-ajaxcontent ":options.autohide?"ui-ztooltip-content ":"ui-ztooltip-contentwithclose ";if(checkTooltip)tooltipTimeDelay=0;else{tooltip=$("<div>").attr("class","ui-ztooltip ui-widget"),tooltipCallout=void 0;var overlaydiv=$("<div>").attr("class","ui-ztooltip-overlaydiv ui-corner-all");tooltipHeader=$("<div>").attr("class","ui-ztooltip-header ui-corner-top"),tooltipContent=$("<div>").attr({class:contentClass+contentCornerClass,id:"ui-ztooltip-content"}),tooltipIcon=$("<span>").attr("class","ui-ztooltip-img "+options.iconclass).appendTo(overlaydiv),tooltipHeader.appendTo(overlaydiv),tooltipContent.appendTo(overlaydiv),overlaydiv.appendTo(tooltip),$("body").append(tooltip)}tooltipHeader.css("display",""),tooltipIcon.css("display",""),options.iconclass&&tooltipIcon.css({display:"inline-block"});options.title&&(tooltipHeader.text(options.title),contentCornerClass="ui-corner-bottom",tooltipHeader.css({display:"inline-block"}));if(!options.autohide){var closeBtn=$("<span>").attr("class","ui-ztooltip-close ui-icon ui-components-icon").on("click",function(ev){$(targetEle).off("mousemove"),removeTip(ev),$(targetEle).attr("title",targetTitle)});closeBtn.appendTo(tooltip),$(targetEle).attr("noAutoHide",!0)}if(tooltipContent.attr("class",contentClass+" "+contentCornerClass),!options.ajaxContent){content=options.content;var isHtmlContent="html"==options.contentType;if(isHtmlContent&&options.isContentElementId){var tmpParent=$("<div>").append($("#"+options.content).show());content=tmpParent.html()}if(tooltipOptions&&$.ui&&$.ui.shortcutkeys&&tooltipOptions.showShortcutKey){ele=ele.is("label.ui-button")?ele.prev("input"):ele;var key=$(document).shortcutkeys("getShortcutKey",ele);key&&(content=content+" ("+key+")")}}tempTooltipEle&&tempTooltipEle.remove();tempTooltipEle=tooltip.clone(),$("body").append(tempTooltipEle);var isHtmlContent="html"==options.contentType;tempTooltipEle.removeAttr("style").hide(),tempTooltipEle.find("#ui-ztooltip-content").removeAttr("style"),tempTooltipEle.find("#ui-ztooltip-content")[isHtmlContent?"html":"text"](content),options.callout&&!options.ajaxContent?(tooltipCallout||(tooltipCallout=$("<div>").attr("class","ui-ztooltip-callout").appendTo(tooltip)),position=getCalloutPosition(options.callout,tooltipCallout)):tooltipCallout=void 0;return tooltip}(ele);if(tooltipEle){var toolTipPos=void 0;ev.originalEvent?toolTipPos=options.callout&&!options.ajaxContent?getTooltipPosition(ev):{left:ev.pageX+10,top:ev.pageY+10}:((toolTipPos=ele.offset()).left+=ele.width(),toolTipPos.top+=ele.height()),toolTipPos=adjustTooltipPosition(toolTipPos,ele,tempTooltipEle),clearTimeout(tooltipShowTimer),clearTimeout(tooltipAjaxTimer),tooltipShowTimer=setTimeout(function(){if(ele.is(":visible")||ele.is("option")){if(options.ajaxContent){var loader=$("<div>").attr("class","ui-ztooltip-content-loading");$(tooltip).find(".ui-ztooltip-ajaxcontent").append(loader),tooltipAjaxTimer=setTimeout(function(){$.ajax({type:"GET",url:options.ajaxContent,data:"",success:function(resp){$(tooltip).find(".ui-ztooltip-ajaxcontent").html(resp)},error:function(){$(tooltip).find(".ui-ztooltip-ajaxcontent").empty()}})})}options.timeout&&options.autohide&&(tooltipTimeoutValue=setTimeout(function(){removeTip(ev)},parseInt(options.timeout))),tooltipEle.show(1,function(){tooltipContent[isHtmlContent?"html":"text"](content),tooltipCallout.css(position),(toolTipPos=fixTooltip(ev,tooltipEle,toolTipPos,ele))&&tooltipEle.css(toolTipPos),options.calloutHideMode&&tooltip.find(".ui-ztooltip-callout").hide()})}},tooltipTimeDelay)}}(ev,objEle),targetTitle=title,(targetEle=objEle).on("click.ztooltip",function(ev){removeTip()}),objEle.off("mouseout.ztooltip").on("mouseout.ztooltip",function(ev){options.timeout&&clearTimeout(tooltipTimeoutValue),tooltipTimer&&clearTimeout(tooltipTimer),tooltipTimer=setTimeout(function(){options.autohide&&(objEle.unbind("mousemove"),removeTip(ev))},200),clearTitle(objEle,!0)}),baseObj._documentEle.off("mousedown.ztooltip").on("mousedown.ztooltip",function(ev){options.autohide&&(objEle.unbind("mousemove"),removeTip(ev)),clearTitle(objEle,!0)}),options.mousetrack&&objEle.off("mousemove.ztooltip").on("mousemove.ztooltip",function(ev){!function(ev,ele){var tooltipEle=$(tooltip),toolTipPos=(tooltipEle.width(),tooltipEle.height(),options.callout&&!options.ajaxContent?getTooltipPosition(ev):{left:ev.pageX+5,top:ev.pageY+5});toolTipPos=fixTooltip(ev,tooltip,toolTipPos,ele),tooltipEle.width()+parseInt(toolTipPos.left)>this._windowWidth&&tooltipEle.width(this._windowWidth-(parseInt(toolTipPos.left)+50));tooltipEle.css(toolTipPos)}(ev,objEle)})}})}function clearTitle(ele,reset){var parents=reset?ele.data("parents"):ele.parents("[title]");reset?ele.data("parents",void 0):(parents.push(ele),ele.data("parents",parents)),parents&&$.each(parents,function(i,_ele){var title="",eleTitle=(_ele=$(_ele)).attr("title");reset?title=eleTitle!=_ele.data("title")&&""!=eleTitle?eleTitle:_ele.data("title"):_ele.data("title",eleTitle),_ele.attr("title",title)})}function adjustTooltipPosition(toolTipPos,ele,tooltipEle,dir){var direction=options.callout?options.callout:dir,ele_offset=ele.offset(),ele_offset_left=ele_offset.left,ele_offset_top=ele_offset.top;return ele.is("option")&&(ele_offset_left=ele.parent("select").offset().left,ele_offset_top=ele.parent("select").offset().top+ele.offset.top),direction&&(-1!=direction.indexOf("north")?(options.mouseEnter||options.mousetrack||(toolTipPos.left="northwest"===direction?ele_offset_left:"northeast"===direction?ele_offset_left-(tooltipEle.width()-ele.outerWidth()):ele_offset_left-8-(tooltipEle.width()/2-8)+ele.outerWidth()/2),toolTipPos.top=ele_offset_top+ele.outerHeight()+9):-1!=direction.indexOf("south")?(toolTipPos.left="southwest"===direction?ele_offset_left:"southeast"===direction?ele_offset_left-(tooltipEle.width()-ele.outerWidth()):ele_offset_left-8-(tooltipEle.width()/2-8)+ele.outerWidth()/2,toolTipPos.top=ele_offset_top-tooltipEle.outerHeight()-9):"west"===direction?(toolTipPos.left=parseInt(ele_offset_left+ele.outerWidth()+9),toolTipPos.top=ele_offset_top-tooltipEle.height()/2+ele.outerHeight()/2):"east"===direction&&(toolTipPos.left=parseInt(ele_offset_left-tooltipEle.width()-9),toolTipPos.top=ele_offset_top-tooltipEle.height()/2+ele.outerHeight()/2)),toolTipPos}function getCalloutPosition(dir,callout){if(!tooltip)return!1;var pos={};callout.removeAttr("class").attr("class","ui-ztooltip-callout ui-ztooltip-callout-"+calloutDirection[dir]);var calloutWidth=callout.outerWidth(),calloutHeight=callout.outerHeight(),baseEleWidth=tempTooltipEle.width(),baseEleHeight=tempTooltipEle.height();switch(dir){case"north":pos={left:baseEleWidth/2-calloutWidth/2+"px",top:"-"+(calloutHeight-1)+"px"};break;case"west":pos={left:"-"+(calloutWidth-1)+"px",top:baseEleHeight/2-calloutHeight/2+"px"};break;case"east":pos={left:baseEleWidth-1+"px",top:baseEleHeight/2-calloutHeight/2+"px"};break;case"south":pos={left:baseEleWidth/2-calloutWidth/2+"px",top:baseEleHeight-1+"px"};break;case"northeast":pos={left:baseEleWidth-2*calloutWidth+"px",top:"-"+(calloutHeight-1)+"px"};break;case"northwest":pos={left:calloutWidth+"px",top:"-"+(calloutHeight-1)+"px"};break;case"southwest":pos={left:calloutWidth+"px",top:baseEleHeight-1+"px"};break;case"southeast":pos={left:baseEleWidth-2*calloutWidth+"px",top:baseEleHeight-1+"px"};break;default:callout.addClass("ui-ztooltip-callout-top"),pos={left:calloutWidth+"px",top:"-"+(calloutHeight-1)+"px"}}return pos}var tooltipPositions={north:function(ev){return{left:ev.pageX-ev.tooltipWidth/2,top:ev.pageY+(ev.calloutHeight+ev._OFFSET)}},west:function(ev){return{left:ev.pageX+(ev.calloutWidth+ev._OFFSET),top:ev.pageY-ev.tooltipHeight/2}},east:function(ev){return{left:ev.pageX-(ev.calloutWidth+ev._OFFSET)-ev.tooltipWidth,top:ev.pageY-ev.tooltipHeight/2}},south:function(ev){return{left:ev.pageX-ev.tooltipWidth/2,top:ev.pageY-(ev.calloutHeight+ev._OFFSET)-ev.tooltipHeight}},northeast:function(ev){return{left:ev.pageX-(ev.tooltipWidth-(ev.calloutWidth+ev.calloutWidth/2)),top:ev.pageY+ev.calloutHeight+ev._OFFSET}},northwest:function(ev){return{left:ev.pageX-(ev.calloutWidth+ev.calloutWidth/2),top:ev.pageY+ev.calloutHeight+ev._OFFSET}},southwest:function(ev){return{left:ev.pageX-(ev.calloutWidth+ev.calloutWidth/2),top:ev.pageY-(ev.calloutHeight+ev._OFFSET)-ev.tooltipHeight}},southeast:function(ev){return{left:ev.pageX-(ev.tooltipWidth-(ev.calloutWidth+ev.calloutWidth/2)),top:ev.pageY-(ev.calloutHeight+ev._OFFSET)-ev.tooltipHeight}},defaultFn:function(ev){return tooltipPositions.north(ev,ev.calloutHeight,ev.calloutWidth)}};function getTooltipPosition(ev){ev.tooltipWidth=tooltip.outerWidth(),ev.tooltipHeight=tooltip.height();if(ev._OFFSET=10,!tooltip)return!1;var callout=tooltip.find(".ui-ztooltip-callout");ev.calloutWidth=callout.outerWidth(),ev.calloutHeight=callout.outerHeight();var fn=tooltipPositions[options.callout];return fn||(fn=tooltipPositions.defaultFn),fn(ev)}function removeTip(ev){tooltip&&("html"===options.contentType&&options.isContentElementId&&$(tooltip).find("#"+options.content).appendTo("body").hide(),$(tooltip).remove(),tooltip=void 0)}function fixTooltip(ev,tooltipEle,toolTipPos,ele){if(tooltipEle&&toolTipPos){var offset_Top,offsetTop=toolTipPos.top-this._documentEle.scrollTop(),offsetLeft=toolTipPos.left-this._documentEle.scrollLeft(),t_left=offsetLeft+tooltipEle.width(),t_top=offsetTop+tooltipEle.height(),dir=void 0;if(t_left>=this._windowWidth?(toolTipPos.left=this._windowWidth-(tooltipEle.outerWidth(!0)+5),toolTipPos.left+tooltipEle.width()-ele.offset().left<=15&&(options.callout="east"),dir=options.callout):offsetLeft<0&&(toolTipPos.left=toolTipPos.left+5-offsetLeft,ele.offset().left+ele.width()-this._documentEle.scrollLeft()<=20&&(options.callout="west"),dir=options.callout),t_top>=this._windowEle.height()?(toolTipPos.top=ele.offset().top-tooltipEle.outerHeight()-9,dir="south",offset_Top=offsetTop):offsetTop<0&&(toolTipPos.top=ele.offset().top+ele.outerHeight()+9,dir="north",offset_Top=offsetTop),dir)!function(ev,dir,calloutEle,tooltipEle,toolTipPos,offsetLeft,offset_Top){var callout=options.callout?options.callout:dir;switch(dir){case"north":callout="south"==callout?"north":"southeast"==callout?"northeast":"southwest"==callout?"northwest":callout;break;case"south":callout="north"==callout?"south":"northeast"==callout?"southeast":"northwest"==callout?"southwest":callout;break;case"west":callout="east"==callout?"west":callout;break;case"east":callout="west"==callout?"east":callout}(function(ev,callout,calloutEle,tooltipEle,dir,toolTipPos,offsetLeft,offset_Top){if(calloutEle){options.callout=callout;var position=calloutEle.position();offset_Top&&((position=getCalloutPosition(callout,calloutEle))||(position=calloutEle.position())),"east"===callout||"west"===callout?(position=getCalloutPosition(callout,calloutEle),toolTipPos=adjustTooltipPosition(toolTipPos,$(ev.target),tooltipEle,dir)):"northwest"===callout||"northeast"===callout||"southwest"===callout||"southeast"===callout?position=getCalloutPosition(callout,calloutEle):offsetLeft<0?(position.left=tooltipEle.width()/2-calloutEle.outerWidth()/2+offsetLeft-5,position.left<=10&&(position.left=10)):(position.left=tooltipEle.width()/2-calloutEle.outerWidth()/2+(offsetLeft-toolTipPos.left),tooltipEle.width()-position.left<=20&&(position.left=tooltipEle.width()-20)),position&&calloutEle.css(position)}})(ev,callout,calloutEle,tooltipEle,dir,toolTipPos,offsetLeft,offset_Top)}(ev,dir,tooltipEle.find(".ui-ztooltip-callout"),tooltipEle,toolTipPos,offsetLeft,offset_Top)}return toolTipPos}$.fn.ztooltip=function(option,arg1,arg2){var element=$(this);tooltipOptions=$.extend({},defaults,"object"==typeof option&&option),element.data("z-ztooltip")?"remove"===option&&removeTip():(bindEvents(element),element.data("z-ztooltip",!0))},$Support.isMobileWidth()||$(document).ztooltip()});LSDragDrop={onDropEvent:function(chid,event,files){if(-1!=chid)try{event.preventDefault();var file=files||event.dataTransfer.files;this.nooffiles=file.length,this.pos=0,this.uploadFile(chid,file)}catch(e){}},uploadFile:function(chid,filecontent){var $LSD=this,msgid=(new Date).getTime(),callbacks={progress:function(e,msgid){$UI.showUploadProgress({fileobj:filecontent[$LSD.pos-1],prgval:e,msgid:msgid})},complete:function(){handleSuccesCb()},success:function(){handleSuccesCb()}};function handleSuccesCb(){$UI.hideUploadProgress(msgid),$Support.Util.handleCallbacks("chat.file",{}),$LSD.pos<$LSD.nooffiles&&(msgid=(new Date).getTime(),$LSD.uploadFileUsingPost(chid,filecontent,$LSD.pos,callbacks,msgid),$LSD.pos++)}$LSD.uploadFileUsingPost(chid,filecontent,$LSD.pos,callbacks,msgid),$LSD.pos++},getFormData:function(params,file){var form1=new FormData;return $.each(params,function(param,value){form1.append(param,value)}),form1},uploadFileUsingPost:function(chid,filecontent,pos,callbacks,msgid){try{var file=filecontent[pos],eobj=$Support.EmbedObj;if(file.size<=52428800){var formdata=this.getFormData({chid:chid,dname:eobj.visitorname,mod:"att",sid:LSMessanger.getSid(),lsid:eobj.livelsid,sender:eobj.vwmsid,msgid:msgid,file1:file});try{CommonUtil.handleFileUpload({callbacks:callbacks,formdata:formdata,type:file.type,msgid:msgid})}catch(e){}return}var filename=file.name;if(filename=null==filename||null==filename?"file1":filename,this.pos=pos+1,null==filecontent[this.pos]&&null==filecontent[this.pos])return $UI.showBanner(LSResource.getRealValue("infomsg.filesharing.sizeexceed",filename+",50"),!0),void $UI.hideUploadProgress(msgid);if(!confirm(LSResource.getRealValue("infomsg.filesharing.sizeexceedproceednext",filename+",50")))return;this.uploadFileUsingPost(chid,filecontent,this.pos,callbacks,msgid)}catch(e){}}};var PasteImage={};PasteImage={isUser:!1,setIsUser:function(isuser){this.isUser=isuser},onPaste:function(event,txtarea){if($Support.isChatExist()){if(this.txtarea=txtarea||null,window.clipboardData&&window.clipboardData.getData("Text"))return event.preventDefault(),this.insertText(text);var clipboarddata=(event.originalEvent||event).clipboardData;if(clipboarddata){event.preventDefault();var items=clipboarddata.items;items&&this.handlePaste(items);var text=clipboarddata.getData("text/plain");if(text&&0==this.files.length)return this.insertText(text)}return!1}},getHTMLTemplet:function(){return this.isUser?"<div id='fileintex-FILEINDEX' purpose='fileupload' CLASS><input type='text' value='' class='file-name' purp='name'/><div id='pasteimage' class='pasteimage'></div><textarea class='pasteimgcomment' id='pasteimgcomment' purp='comment' placeholder='"+LSResource.getRealValue("transferchat.comment.placeholder")+"'></textarea></div>":$EmbedManger.UI.getPrevHTML()},getEmbPrevHTML:function(){return'<div id="fileintex-FILEINDEX" purpose="fileupload"><div class="imgshr_head txtelips" title="'+getEncodedText(Support.attendername)+'">'+LSResource.getRealValue("common.sharewith",getEncodedText(Support.attendername))+'</div><input type=\'text\' value=\'\' class=\'file-name\' purp=\'name\'/><div class="embd_pstimgdiv" id="pasteimage"></div><textarea id="pasteimgcomment" purp="comment" placeholder="'+LSResource.getRealValue("common.comment.placeholder")+'"></textarea><div class="pstimg_btns"><span id="uploadimage" class="txtelips strtbtn drkdclr">'+LSResource.getRealValue("banner.share")+'</span><span id="cancelupload" class="txtelips cnsl">'+LSResource.getRealValue("common.cancel")+"</span></div></div>"},getHTML:function(){for(var html="<div class='pstimg-main' id='pstimg-main'>",flslen=this.files.length,cls=2<flslen?"class='mult-imgs mrgn-bt18'":2==flslen?"class='mult-imgs'":"",i=0;i<flslen;i++){var htmltemp=this.getHTMLTemplet();html+=htmltemp=(htmltemp=htmltemp.replace(/FILEINDEX/g,i)).replace(/CLASS/g,cls)}return html+"</div>"},insertText:function(text){var selection=document.getSelection();return window.clipboardData?(document.selection.createRange().pasteHTML(text),!0):!!(document.queryCommandEnabled("insertText")&&0<selection.rangeCount&&document.execCommand("insertText",!1,text))},checkAndShowUI:function(){if(0<this.files.length){if(this.isUser)return void this.showPortalUI();$EmbedManger.UI.showPasteUI()}},handlePaste:function(items){this.files=[],itemlen=items.length;for(var self=this,insertHTML=function(htmltxt){var elem=document.createElement("DIV");elem.innerHTML=htmltxt;var img=elem.getElementsByTagName("img");img&&0==img.length&&(self.files=[])},i=0;i<itemlen;i++){var type=items[i].type,getfile=items[i].getAsFile();/^image\/.+$/.test(type)&&getfile&&this.files.push(getfile),$Support.isMacOS()||items[i].getAsString(insertHTML)}this.checkAndShowUI()},updateDetailes:function(dlogobj){for(var i=0,files=this.files,fileslen=files.length;i<fileslen;i++){var file=files[i],filename=file.name,fileextn="",fileobj=dlogobj.find("#fileintex-"+i);filename||(filename=this.generateName(file,i));var extnseperator=filename.lastIndexOf(".");-1!==extnseperator?fileextn=filename.substring(extnseperator):extnseperator=filename.length,filename=(filename=(filename=filename.substring(0,extnseperator)).replace(/[`~!\$%\^&\|\\\"<>\?\/]/g,"-")).substring(0,100),this.Filename=filename,this.ext=fileextn,fileobj.attr("fileextn",fileextn),fileobj.find(".file-name").val(filename),fileobj.find("#pasteimgcomment").focus(),this.bindHandler(fileobj),this.setPreview(fileobj,file)}},bindHandler:function(fileobj){fileobj.find(".file-name").on("blur",function(){""!=$(this).val()?PasteImage.Filename=$(this).val():$(this).val(PasteImage.Filename)}).on("keydown",function(){$(this).removeClass("bdrbot_red")})},generateName:function(file,index){var filetype=file.type,fileextn=filetype.substring(filetype.indexOf("/")+1,filetype.length);return"Image - "+this.getcurrTime()+"."+fileextn},getcurrTime:function(){var time=new Date,curTime="",hour=time.getHours(),minute=time.getMinutes(),curhour=12<hour?hour-12:0==hour?"12":hour;return curTime+=(curhour<10?"0":"")+curhour,curTime+=(minute<10?":0":":")+minute,curTime+=12<=hour?" PM":" AM"},showEmbedUI:function(file){var chtmain=$("#embedcontainer").find(".flcontainer"),html=this.getHTML();chtmain.find(".pstimg-main").remove(),chtmain.append(html).find(".pstimg-main").show(),chtmain.find("#uploadimage").on("click",function(){PasteImage.uploadImage(chtmain)}),chtmain.find("#cancelupload").on("click",function(){PasteImage.hideUI()}),this.updateDetailes(chtmain)},validate:function(dlogobj){for(var i=0,fileslen=PasteImage.files.length;i<fileslen;i++){var fileobj=dlogobj.find("#fileintex-"+i),nameelem=fileobj.find("[purp='name']"),commentelem=fileobj.find("[purp='comment']"),filename=$.trim(nameelem.val());if(/^[`~!\$%\^&\|\\\"<>\?\/]$/.test(filename)||""==filename)return!1;if(100<filename.length)return!1;if(200<commentelem.val().length)return!1}return!0},uploadImage:function(dlogobj){if(PasteImage.validate(dlogobj)){for(var i=0,files=PasteImage.files,commentobj={},filedetailes=[];i<files.length;i++){var file=files[i],filearray=[],fileobj=dlogobj.find("#fileintex-"+i),filename=fileobj.find("[purp='name']").val(),comment=this.comment=fileobj.find("[purp='comment']").val(),fileextn=fileobj.attr("fileextn");filearray.push(file),filearray.push(i+1+"_"+filename+fileextn),""!==comment&&(commentobj[i+1]=comment),filedetailes.push(filearray)}this.handleUploadAjax(filedetailes,commentobj),$EmbedManger.UI.hidePasteUI()}},handleUploadAjax:function(files,comments){var dataval={},isagent=this.isUser,msgid="";if("upload.do"===(isagent?"upload.do":"upload.ls")&&(dataval=lsnocachefix("json",!0)),dataval.chid=isagent?WindowHandler.getCurrentWinChatID():$EmbedManger.getChatID(),dataval.dname=isagent?CurrentUser.getDisplayname():$EmbedManger.getVisitorName(),dataval.mod="att",dataval.sid=isagent?LSMessanger.getSid():$EmbedManger.getLiveSupportID(),dataval.comment=JSON.stringify({}),0!=getObjectSize(comments)&&(dataval.comment=JSON.stringify(comments)),isagent){var statusdiv=$("#"+dataval.chid).find("#chatstatus");statusdiv.text(LSResource.getRealValue("infomsg.sharingfiles"))}else dataval.lsid=$EmbedManger.getLiveSupportID(),dataval.sender=$EmbedManger.getvwmsid(),dataval.msgid=msgid=(new Date).getTime();dataval=this.getFormData(dataval,"file1",files);var isnewemb=!isagent&&$EmbedManger.isNewEmbed,callbacks={progress:function(e,msgid){isnewemb&&$UI.showUploadProgress({fileobj:files[0][0],prgval:e,msgid:msgid,filename:PasteImage.Filename+PasteImage.ext,comment:PasteImage.comment})},complete:function(){isnewemb&&$UI.hideUploadProgress(msgid)},success:function(){isnewemb?PasteImage.isUser&&statusdiv.text(""):$UI.hideUploadProgress(msgid)}};try{CommonUtil.handleFileUpload({callbacks:callbacks,formdata:dataval,type:files.type,msgid:msgid})}catch(e){}},isFileorBlob:function(value){return value instanceof Blob},getFormData:function(params,fileparamname,filesdetails){var form=new FormData;for(var param in params)form.append(param,params[param]);for(var i=0,fileslen=filesdetails.length;i<fileslen;i++){var filedetails=filesdetails[i];this.isFileorBlob(filedetails[0])&&form.append(fileparamname,filedetails[0],filedetails[1])}return form},showPortalUI:function(files){var visitorname=Visitors.getVisitorName(WindowHandler.getVistorID(WindowHandler.getCurrentWinChatID())),composer=$(this.txtarea),dlogobj=Dialog.show({title:LSResource.getRealValue("common.sharewith",getEncodedText(visitorname)),desc:this.getHTML(),i18n:!1,ok:{text:LSResource.getRealValue("banner.share"),callback:function(){PasteImage.uploadImage(dlogobj),composer.focus()}},cancel:{}}).addClass("pasteimg_srn").center();this.updateDetailes(dlogobj)},hideUI:function(){$("#pstimg-main").fadeOut(300,function(){$(this).remove()}),$(this.txtarea).focus()},setPreview:function(fileobj,file){var reader=new FileReader,imgobj=fileobj.find("#pasteimage");reader.onload=function(event){imgobj.html('<img src="'+event.target.result+'" />')},reader.readAsDataURL(file)},handlepasteimage:function($curr){var ext_count=parseInt($curr.attr("mcount")),count=ext_count-$curr.val().length,cls=count<0?" redtxt":"",content=count<0?LSResource.getRealValue("common.count.error",""+ext_count):count+" ";$curr.parent().find(".messagecount").show().removeClass("redtxt").addClass(cls).text(content)}};$Clickoutside={callbackfn:null,dest:null,src:null,ignoreesckey:null,bindclick:function(callback,dest,src,ignoreesc){null!=this.callbackfn&&this.dest!=dest&&this.callbackfn(),this.callbackfn=callback,this.dest=dest,this.src=src,this.ignoreesckey=ignoreesc},handledclick:function(e){var eventid=getEventSourceId(e);if(null!=this.callbackfn&&this.src!=eventid){var p=$(getSource(e)).parents();for(i=0;i<p.length;i++)if($(p[i]).attr("id")==this.src||$(p[i]).attr("id")==this.dest)return;this.callbackfn(),this.callbackfn=null,this.dest=null,this.src=null}},handleEscape:function(e){if(!this.ignoreesckey&&null!=this.callbackfn)return this.callbackfn(),this.callbackfn=null,this.dest=null,!(this.src=null)}},$(document).on("click",function(e){$Clickoutside.handledclick(e)});