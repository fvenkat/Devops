var Markdown={};Markdown={regexes:{markdown_link:/(^|\s)\[(.+?)\]\(((?:https?:\/\/(?:www\.)?|www\.)[a-z0-9][^@ ]*?)\)(?=$|\s)/gi,markdown_quote:/(?:^|\n)!(.+?)(?:\n|$)/gm,markdown_heading:/(?:^|\n)(\#{1,6}) (.*?\S *)(?:\n|$)/gm,markdown_line:/(^|[\n])(\*{3,}|\-{3,})(?=$|[\n])(.*)/g,markdown_codeblock:/(^|\s)`{3}((?:(?:.*?$)\n)?(?:[\s\S]*?))`{3}(?=$|\s)/g,markdown_code:/(^|\s)\`(.*?\S *)?\`(?=$|\s)/g,markdown_bold:/(^|\s|[{\[])\*(.*?\S *)?\*(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,markdown_italic:/(^|\s|[{\[])\_(.*?\S *)?\_(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,markdown_strike:/(^|\s|[{\[])\~(.*?\S *)?\~(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g},apply:function(msg){return msg=this.applyOnce(msg),msg=this.applyRecursive(msg),msg=this.decodeChars(msg)},applyOnce:function(msg){return msg=(msg=(msg=(msg=(msg=msg.replace(this.regexes.markdown_link,this.getLinkHTML)).replace(this.regexes.markdown_quote,this.getQuoteHTML)).replace(this.regexes.markdown_heading,this.getHeadingHTML)).replace(this.regexes.markdown_codeblock,this.getCodeblockHTML)).replace(this.regexes.markdown_code,this.getCodeHTML)},applyRecursive:function(msg){return msg=(msg=(msg=(msg=msg.replace(this.regexes.markdown_bold,this.getBoldHTML)).replace(this.regexes.markdown_italic,this.getItalicHTML)).replace(this.regexes.markdown_strike,this.getStrikeHTML)).replace(this.regexes.markdown_line,this.getLineHTML)},getLinkHTML:function(match,$1,$2,$3,$4){return $1+'<a href="'+("www."===$4?"http://"+$3:$3)+'" target="_blank">'+Markdown.encodeChars($2)+"</a>"},getQuoteHTML:function(match,$1){return 0===($1=$.trim($1)).length?match:'<blockquote class="blkqote">'+Markdown.applyRecursive($1)+"</blockquote>"},getHeadingHTML:function(match,$1,$2){var noofhash=$1.length;return"<h"+noofhash+">"+Markdown.encodeChars($2)+"</h"+noofhash+">"},getLineHTML:function(match,$1,$2,$3){return'<hr class="hr">'+Markdown.applyRecursive($.trim($3))},getCodeblockHTML:function(match,$1,$2){return 0===($2=$.trim($2)).length?match:$1+'<pre class="pre">'+Markdown.applyRecursive($2)+"</pre>"},getCodeHTML:function(match,$1,$2){return!$2||!$2.match(/[^_*`~]/)||"`"===$2[0]||"`"===$2[$2.length-1]||" "===$2[0]&&" "===$2[$2.length-1]?match:$1+'<code class="code">'+Markdown.encodeChars($2)+"</code>"},getBoldHTML:function(match,$1,$2){return!$2||!$2.match(/[^_*`~]/)||"*"===$2[0]||"*"===$2[$2.length-1]||" "===$2[0]&&" "===$2[$2.length-1]?match:$1+"<strong>"+Markdown.applyRecursive($2)+"</strong>"},getItalicHTML:function(match,$1,$2){return!$2||!$2.match(/[^_*`~]/)||"_"===$2[0]||"_"===$2[$2.length-1]||" "===$2[0]&&" "===$2[$2.length-1]?match:$1+"<i>"+Markdown.applyRecursive($2)+"</i>"},getStrikeHTML:function(match,$1,$2){return!$2||!$2.match(/[^_*`~]/)||"~"===$2[0]||"~"===$2[$2.length-1]||" "===$2[0]&&" "===$2[$2.length-1]?match:$1+"<strike>"+Markdown.applyRecursive($2)+"</strike>"},encodeChars:function(str){return str.replace(/\*/g,"&ast;").replace(/\_/g,"&#95;").replace(/\~/g,"&#126;")},decodeChars:function(str){return str.replace(/&ast;/g,"*").replace(/&#95;/g,"_").replace(/&#126;/g,"~")}};$Support={LSDB:parent.$ZSIQLSDB?parent.$ZSIQLSDB:opener?opener.$ZSIQLSDB:void 0,convlistindex:0,convlistlimit:{1:5,2:6,3:7},isallconvlistfetched:!1,getParent:function(){return window.parent.$ZSIQWidget?window.parent:window.opener&&opener.$ZSIQWidget?window.opener:void 0},DEPT_ONLINESTATUES:"1",DEPT_OFFLINESTATUES:"2",DEPT_ENGAGESTATUES:"3",init:function(config){try{$Support.EmbedObj=new $SupportConfig(config),this.setTheme(config),$Support.Util.updateParentFontFamily(),this.isscript="script"===config.params.src,this.Util.setBrowserValues(),DynamicMsg.init();try{Self.status.init()}catch(e){}this.cachearr=[],this.checkAndShowUI(),$Support.Util.isPreview()&&$CWPreview.init(),window.parent.$ZSIQChatWindow.handleESCEvent(window)}catch(e){}},setTheme:function(config){this.theme="theme"+config.theme},isFloat:function(){return"float"===$Support.type},checkAndShowUI:function(isapicall){$Support.appendMetaTag();var embedobj=$Support.EmbedObj,value=this.getCookieValue("ZLD"+embedobj.livelsid),waitingval=this.getWaitingCookie(),triggerval=this.getTriggerCookie();$UI.setContainer();var apivalues=$Support.getParent().$ZSIQUtil.getAPIValues();if(window.parent.$ZSIQWidget.getWidgetObject().isshowcallbubble)return $Support.container.append($Support.contentdiv=CallUIHandler.getInitialHtml()),void handleDrag();if($Support.Util.updateViewAttribute("msgarea"),$Support.Util.isPreview())return $UI.init(),this.Util.setTextareaHeight(),void $Support.handleApiData(apivalues);if((apivalues.floatwindowfields||apivalues.customfield)&&$Support.handleFieldVisibility(apivalues.floatwindowfields,apivalues.customfield),triggerval)return $Support.Util.handleChatTrigger(triggerval),void($Support.isConversationAllowed()&&$Support.container.find("#showsiqconv").click());if(value&&(embedobj.setVisitorName(value.name),embedobj.setVisitorEmail(value.email)),clearTimeout($Support.Util.jsdownloadtimer),value&&value.cid&&"-1"!=value.cid&&$Support.getParent().$ZSIQWidgetUI.getWidgetState()==$Support.getParent().$ZSIQWidgetUI.F_WINDOW?$Support.Util.downloadAdditionalFiles():$Support.Util.jsdownloadtimer=setTimeout($Support.Util.downloadAdditionalFiles,1e4),value&&value.cid&&"-1"!=value.cid&&($Support.isFloat()||"personal"==$Support.type)){this.handleChatCookie(value);var count=$Support.getUnreadCount();count&&$Support.isFloat()&&$Support.getParent().$ZSIQWidgetUI.updateCount(count),$Support.isBotChat&&waitingval&&($Support.handleWaitingDisplay(!0,!0),$UI.showTransferWaiting())}else waitingval&&$Support.isFloat()?(this.handleWaitingCookie(waitingval),waitingval.chid&&this.updateTranscriptFromSession()):embedobj.status?($UI.init(),this.Util.setTextareaHeight()):(DynamicMsg.setValues($Support.getValuesForDynamicMsg()),$Support.Util.isPreview()&&($Support.contentdiv=""),$UI.updateOfflineUI(),$Support.isFloat()||this.Util.showOfflineBanner());if($Support.isConversationAllowed())$Support.container.find("#showsiqconv").click();else{var avuid=this.LSDB.get("ZLD"+$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.lsid+"avuid");this.LSDB.removeSessionStore(avuid+"_conversation")}if(-1!=isapicall&&$Support.handleApiData(apivalues),this.Util.bindUtilEvents(),$Support.Util.calculateContentHeight(),avimpl.curr_status){switch(CallImpl.isCallWithChat=!1,avimpl.curr_status){case"connecting":$("body").append($Temp.getReconnectionUI(avimpl.attenderimgurl,"av.info.connecting"));break;case"ongoing":$("body").append($Temp.getOnCallUI(avimpl.attenderimgurl));break;case"outgoing":$("body").append($Temp.getOutgoingcallUI(avimpl.attenderimgurl,$Support.EmbedObj.attendername));break;case"reconnecting":$("body").append($Temp.getReconnectionUI(avimpl.attenderimgurl,"av.info.reconnecting"))}$("body").find("#faqcall").remove(),document.getElementsByClassName("zsembd_audiocl")[0].sdrag()}-1!=isapicall&&avimpl.checkOngoingCall()},handleFieldVisibility:function(apival,customfields){var embedobj=$Support.EmbedObj,fieldarr=[];if(embedobj.status&&apival&&apival.online?fieldarr=apival.online.split(","):!embedobj.status&&apival&&apival.offline&&(fieldarr=apival.offline.split(",")),customfields&&0!=customfields.length)try{$.each(customfields,function(i,customfields){customfields.index=i;var name=customfields.name;if(fieldarr.length,/^_default./.test(name)){var defaultfieldname=name.replace("_default.","");0<=["name","email","phone"].indexOf(defaultfieldname)&&-1==fieldarr.indexOf(defaultfieldname)&&fieldarr.push(defaultfieldname)}})}catch(e){}if(fieldarr.length){embedobj.eprops.isname[0]=!1,embedobj.eprops.isemail[0]=!1,embedobj.eprops.isphoneno[0]=!1;for(var i=0;i<fieldarr.length;i++){"contactnumber"!=fieldarr[i]&&"phone"!=fieldarr[i]||(fieldarr[i]="phoneno");var propname="is"+fieldarr[i];embedobj.eprops[propname]&&(embedobj.eprops[propname][0]=!0)}}},handleChatCookie:function(value){var embedobj=$Support.EmbedObj;this.updateCommonKeys(value);var visitorid=embedobj.visitorID;embedobj.attenderimagefkey=value.imagefkey,embedobj.uvid=value.uvid||embedobj.uvid,embedobj.question=value.ques,embedobj.setAttender(value.attender),embedobj.setAttenderZUID(value.attenderZUID),value.attenderuseragent&&embedobj.setAttenderUserAgent(value.attenderuseragent),value.attendername=embedobj.attendername=value["attname_"+visitorid]||"",value.aboutme=value["aboutme_"+visitorid]||"",embedobj.attenderemail=value.attenderemail,$Support.proactive=value.isproactive,$Support.istriggeredchat=value.istriggeredchat,$Support.isBotChat=value.isbotchat,$Support.botchatprops=value.botchatprops,LSMessanger.setNickName(value.name),LSMessanger.register($Support.Util.productCode,embedobj.vwmsid),$UI.setInnerHeader(value),this.updateTranscriptFromSession(),DynamicMsg.setValues($Support.getValuesForDynamicMsg()),avimpl.checkAudioCallButton()},updateTranscriptFromSession:function(){var eobj=$Support.EmbedObj,cachedata=this.LSDB.getFromSession(eobj.chatID+"_transcript");cachedata&&cachedata.length&&(myMsgObj.sender=eobj.vwmsid,myMsgObj.dname=eobj.visitorname,this.Util.showChatUI(cachedata))},startChat:function(){$Support.initiateChat()},initiateChat:function(skipregister){DynamicMsg.setValues($Support.getValuesForDynamicMsg()),this.intime=(new Date).getTime(),this.LSDB.remove("ZLD"+$Support.EmbedObj.livelsid+"WTIME"),this.removeBroadCast();var botuser=this.getBotUser(),attender=$Support.EmbedObj.attender;if(!attender){var personalizedchatattender=this.LSDB.get("ZLDPERSONALIZE");attender=$Support.getParent().$ZSIQChat.getWidgetData().widgettype==$Support.getParent().SIQ_PERSONALIZE&&personalizedchatattender?personalizedchatattender:void 0}var showwaiting_banner=!botuser||attender&&-1==botuser.indexOf(attender),isgdprembed=1==$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.isgdprenabled,pinfo=this.EmbedObj.pprops,consentstoragedata=this.LSDB.getFromSession(_SCREENNAME+"_gdpr_chatconsent"),chatcookiepolicyurl=pinfo.chatcookiepolicyurl,isshowchatconsent=!(!isgdprembed||!JSON.parse(pinfo.isgdprenabled)||1!=JSON.parse(pinfo.chatprivacyconfig)||consentstoragedata);if(CallImpl.isCallAloneEmbed()||this.handleWaitingDisplay(null,null,!showwaiting_banner,isshowchatconsent),LSMessanger.setNickName($Support.EmbedObj.visitorname),isshowchatconsent){var contentdiv=$Support.contentdiv;return contentdiv.find(".sqico-edit").remove(),contentdiv.find("div[purpose=name]").attr("documentclick",""),$UI.hideUserEditUI(),void $UI.appendChatConsentDiv(skipregister,!1,chatcookiepolicyurl)}skipregister||LSMessanger.sid?$Support.addVisitor():this.EmbedObj.vwmsid?LSMessanger.register($Support.Util.productCode,this.EmbedObj.vwmsid):$Support.getAnnonID($Support.EmbedObj.visitorname)},updateInputValues:function(){$Support.container.find("[purpose]").each(function(){var curr=$(this),key=curr.attr("purpose"),value=curr.val()||curr.attr("val");if(isUndefined(value)||""==value)return!0;$Support.EmbedObj[key]=value}),$Support.updateVisitorName()},updateVisitorName:function(){var eobj=$Support.EmbedObj;if(!eobj.visitorname){var email=eobj.visitoremail;email?eobj.setVisitorName(email.split("@")[0]):eobj.setVisitorName("Visitor "+Math.round(1e5*Math.random()))}},storeInCookie:function(key,value,expiry){var cookieobj=parent.$ZSIQCookie?parent.$ZSIQCookie:opener?opener.$ZSIQCookie:void 0;key=_SCREENNAME+"-"+key,cookieobj.set(key,value,expiry)},addVisitor:function(){if(CallImpl.CallFailed)CallImpl.CallFailed=!1;else{var that=this,eobj=that.EmbedObj;CallImpl.isCallAloneEmbed()&&(eobj.question=LSResource.getRealValue("av.info.callquesmsg",eobj.visitorname),eobj.isaudiocall=!0);var dataval=lsnocachefix("json");void 0===eobj.question&&(eobj.question=$.trim(this.composer.val())),$.extend(dataval,Browser.getInfo(),{referrer:processInput("trimlength",dataval.referrer,3e3),currentpage:processInput("trimlength",dataval.currentpage,950),name:eobj.visitorname,lsid:eobj.livelsid,email:processInput("emailid",eobj.visitoremail),ques:eobj.question,deptid:eobj.department,annonid:eobj.vwmsid,platform:navigator.platform,embeduniquename:eobj.embedname,autotrigger:$Support.istrigmsg}),$.extend(dataval,$Support.getCaptcha),eobj.uvid&&(dataval.uvid=eobj.uvid),$Support.istrigmsg&&$Support.Util.handleCallbacks("visitor.triggerresponded",{});var attender=eobj.attender,personalizedchatattender=this.LSDB.get("ZLDPERSONALIZE");null!=attender&&""!=attender?(dataval.attender=attender,$Support.isbottrigmsg&&(dataval.isbotchat=!0)):$Support.getParent().$ZSIQChat.getWidgetData().widgettype==$Support.getParent().SIQ_PERSONALIZE&&personalizedchatattender&&(dataval.attender=personalizedchatattender),eobj.visitorphone&&(dataval.phone=eobj.visitorphone);var attenderemail=eobj.attenderemail;attenderemail&&(avimpl.attenderemail=dataval.attenderemail=attenderemail);var avuid=this.LSDB.get("ZLD"+$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.lsid+"avuid");avuid&&(dataval.avuid=avuid);var cvuid=$Support.getParent().$ZSIQUtil.getAPIVisitorID();cvuid&&(dataval.cvuid=cvuid);var cinfo=eobj.cinfo;if($Support.getParent().$ZSIQChat.getWidgetData().embedobj.ismailchimpenabled&&!$Support.getParent().$ZSIQChat.istrackedfrommailchimp){if(dataval.mc_cid=$Support.getParent().$ZSIQUtil.getURLParameterByName("mc_cid"),dataval.mc_eid=$Support.getParent().$ZSIQUtil.getURLParameterByName("mc_eid"),null!=dataval.mc_cid&&""!=dataval.mc_cid&&null!=dataval.mc_eid&&""!=dataval.mc_eid)$Support.storeInCookie("mc_cid",dataval.mc_cid,864e5),$Support.storeInCookie("mc_eid",dataval.mc_eid,864e5);else if(mailchimp=$Support.getCookieValue("mailchimp")){var mailchimpData=mailchimp;"string"==typeof mailchimp&&(mailchimp=JSON.parse(mailchimpData)),dataval.name=mailchimpData.name,dataval.email=mailchimpData.email}else dataval.mc_cid=$Support.getCookieValue("mc_cid"),dataval.mc_eid=$Support.getCookieValue("mc_eid");null!=dataval.mc_cid&&""!=dataval.mc_cid&&null!=dataval.mc_eid&&""!=dataval.mc_eid||(dataval.mc_cid=void 0,dataval.mc_eid=void 0)}else{var mailchimp;(mailchimp=$Support.getCookieValue("mailchimp"))&&("string"==typeof(mailchimpData=mailchimp)&&(mailchimp=JSON.parse(mailchimpData)),dataval.name=mailchimpData.name,dataval.email=mailchimpData.email)}var exid=eobj.exid;exid&&(dataval.exid=exid),cinfo&&("object"==typeof cinfo&&(cinfo=JSON.stringify(cinfo)),dataval.cinfo=cinfo),$Support.Util.isCampaignEnabled()&&$Support.subscribe&&(dataval.subscribe="true");var apivalues=$Support.getParent().$ZSIQUtil.getAPIValues();if(apivalues.triggermsg&&eobj.pmsg&&(dataval.prevtrigg=eobj.pmsg),dataval.includebots=!0,apivalues.waitime&&(dataval.custom_waitime=apivalues.waitime),eobj.isaudiocall){CallImpl.isCallWithChat=!0,CallImpl.updateUI(AV_OUTGOINGCALL),dataval.isaudiocall=eobj.isaudiocall,EmbedSound.play("outgoingcall",60),this.LSDB.remove("av_call"),this.LSDB.set("av_call",!0);var time=$Support.waitingtime||$Support.EmbedObj.embedwaitingtime;this.LSDB.set("ZLD_ApiAVCall",!0,1e3*time),clearTimeout(avimpl.ApiCalltimer),avimpl.ApiCalltimer=setTimeout(function(){avimpl.terminateAudioCall();var obj={attenderemail:avimpl.attenderemail,waitingduration:time};avimpl.handleUserBusy(),$Support.Util.handleCallbacks("call.missed",obj)},1e3*time),$Support.setWaitingCookie(),avimpl.attenderemail&&(dataval.attenderemail=avimpl.attenderemail)}this.handleAjax("addvist",dataval,function(response){var msgObj=response.objString;if(msgObj.CLEARBITINFO&&(DynamicMsg.updateClearBitValues(JSON.parse(msgObj.CLEARBITINFO)),delete msgObj.CLEARBITINFO),DynamicMsg.setValues(msgObj),$Support.EmbedObj.feedbackcomplete=DynamicMsg.fillValues($Support.EmbedObj.feedbackcomplete),that.updateAddVistObj(msgObj),"object"!==response.objType||"EMBEDOFFLINE"!==msgObj.ERROR){var attender=msgObj.ATTENDER;if(attender&&eobj.attender!=attender&&(eobj.attendername=eobj.attenderemail),eobj.setAttender(attender),eobj.setVisitID(msgObj.VISIT_ID),eobj.setChatID(msgObj.CHID),$Support.isBotChat=""+msgObj.ISBOTCHAT=="true",eobj.isaudiocall||$UI.hideCaptcha(),that.deleteTriggerCookie(),that.handleTrigAddVist(msgObj),$Support.istriggeredchat)that.setCookie();else{var addvistdelay=(new Date).getTime()-parseInt(msgObj.DIFFTIME)-that.intime;that.latency=addvistdelay/(that.remwaitingtime+addvistdelay)*that.stepinterval,that.setWaitingCookie()}delete that.rating;var obj={name:eobj.visitorname,email:eobj.visitoremail,question:eobj.question,visitid:eobj.VISITID};obj.phone=eobj.visitorphone?eobj.visitorphone:"",obj.customfields=eobj.cinfo?eobj.cinfo:"",$Support.istriggeredchat?that.Util.handleCallbacks("visitor.triggeredchat",obj):that.Util.handleCallbacks("visitor.chat",obj),eobj.isaudiocall||$Support.handleOnGoingchatActionsInConversation("newchat"),delete eobj.isaudiocall}else that.handleAddVisitStatusChange(msgObj)},function(response){that.addVisitErrorHandling(response),delete eobj.isaudiocall})}},addVisitErrorHandling:function(response){if(/module/.test(response.responseText))try{var digest=JSON.parse(response.responseText)[0].objString.digest;return void(digest?setTimeout(function(){$UI.showCaptcha(digest)},300):$UI.updateOfflineUI())}catch(e){}},updateAddVistObj:function(msgObj){var eobj=this.EmbedObj;eobj.setVisitorName(msgObj.NAME),eobj.setVisitorEmail(msgObj.EMAIL),eobj.setVisitorID(msgObj.CU_ID)},handleTrigAddVist:function(msgObj){var addinfo=msgObj.ADDINFO;addinfo&&(addinfo=JSON.parse(addinfo),$Support.istrigmsg&&addinfo[ADDINFO_TRIGGER]&&(this.istriggeredchat=!0,delete $Support.istrigmsg,$UI.hideUserEditUI(),$UI.populateVisitorQuestion(),$Support.getComposer().attr("dockeyup","sendmessage").val(""),$Support.EmbedObj.setChatID(msgObj.CHID),_JOINED=!0),$Support.isBotChat&&$UI.appendTransferDiv())},handleWaitingDisplay:function(updatetimer,istransferchat,hidewaitingbanner,isshowchatconsent){if(!this.istriggeredchat){if(isshowchatconsent)return $Support.waitingtime=this.EmbedObj.embedwaitingtime,void $UI.showWaitingUI(!0);clearTimeout(this.waitTimer);var waittime=$Support.remwaitingtime=$Support.getWaitingHandlerCookie().remwaitingtime,remwtimeinsecs=Math.round(waittime/1e3),eobj=$Support.EmbedObj;this.waitingtime=remwtimeinsecs;var frwd=void 0===$Support.nochatforward||$Support.nochatforward;if(eobj.attender&&frwd&&this.waitingtime==Math.floor(eobj.embedwaitingtime/2)&&!istransferchat&&$Support.broadcastVisitor(),waittime<=0)if(this.LSDB.remove("ZLD"+eobj.livelsid+"WTIME"),this.removeBroadCast(),istransferchat){$Support.botchatprops.status="missed",$Support.setCookie(),$UI.showTransferMissed();var params={};params.chid=eobj.chid,$Support.handleOnGoingchatActionsInConversation("missedchat",params)}else this.handleMissed("CWTOUT","2",!0);else{if($Support.Util.isApiWaitHandler())try{$Support.Util.handleCallbacks("chat.waitinghandler",{WTIME:eobj.embedwaitingtime,CURRENTTIME:remwtimeinsecs,waitingtime:eobj.embedwaitingtime,currenttime:remwtimeinsecs})}catch(e){}updatetimer?$UI.updateWaitingTime():$UI.showWaitingUI(hidewaitingbanner),this.stepinterval||(this.stepinterval=500),this.waitTimer=setTimeout(function(){$Support.handleWaitingDisplay(!0,istransferchat)},$Support.stepinterval)}}},handlePickUp:function(dataobj){var eobj=this.EmbedObj;$Support.isBotChat=""+dataobj.isbotpickup=="true",$Support.botchatprops={status:"connected"},eobj.setAttender(dataobj.attender),$Support.isBotChat&&$Support.contentdiv.stop(!1,!1,!0),this.removeCookie("ZLD"+eobj.livelsid+"WAITING"),this.LSDB.remove("ZLD"+eobj.livelsid+"WTIME"),this.removeBroadCast(),this.composer&&this.composer.removeAttr("disabled"),$UI.removeCWaitHandler(),clearTimeout(this.waitTimer),handlePaste(),delete this.istriggeredchat,delete this.proactive,delete this.waitingtime,eobj.setChatID(dataobj.chid),eobj.setVisitorID(dataobj.visitorid),eobj.setAttender(dataobj.attender),eobj.setAttenderZUID(dataobj.attenderzuid),eobj.setAttenderUserAgent(dataobj.attender_useragent),eobj.chatintime=$Support.intime;var isaudiocall=CallImpl.isCallWithChat;!isaudiocall&&$UI.hideBanner(),eobj.attenderimagefkey=dataobj.image_fkey,!isaudiocall&&$UI.setInnerHeader(dataobj),eobj.attendername=getUnescapedText(dataobj.attendername),eobj.attenderemail=dataobj.attenderemail,eobj.attenderaboutme=dataobj.aboutme,DynamicMsg.updateValue("attendername",eobj.attendername),DynamicMsg.updateValue("attenderemail",eobj.attenderemail),LSMessanger.joinchat(dataobj.chid,eobj.vwmsid),this.setCookie(),!isaudiocall&&$UI.populateUserAction(),!isaudiocall&&$UI.populateSmileyIcon(),avimpl.checkAudioCallButton();var waitingduration=parseInt(dataobj.pickuptime)-parseInt($Support.intime),obj={attendername:eobj.attendername,attenderemail:eobj.attenderemail,visitid:eobj.VISITID,waitingduration:waitingduration};$Support.Util.handleCallbacks("visitor.attend",obj)},sendMessage:function(msg,txtarea){$Support.BOT_TIMER&&clearTimeout($Support.BOT_TIMER);var eobj=this.EmbedObj,chatid=eobj.chatID;if(-1!==eobj.visitorID)return txtarea.val(""),Message.send(chatid,msg),!1;-1!==chatid?this.joinProactiveChat(msg):$Support.isbottrigmsg&&this.handleBotTriggerReply(msg,txtarea)},handleBotTriggerReply:function(msg,txtarea){$Support.EmbedObj.question=msg,this.istriggeredchat=!0,$Support.EmbedObj,txtarea&&(txtarea.val(""),this.enableTextarea(txtarea)),$Support.updateVisitorName(),$Support.Util.removeSendClickAction(),this.getComposer().attr("dockeyup","sendmessage"),$Support.startChat()},handleSendMessage:function(txtarea,keycode,e){try{this.endtimer&&this.clearEndTimer(),16!=keycode&&Self.status.active(e)}catch(e){}if(this.Util.handlePredictMsg(txtarea),13==keycode&&e.shiftKey)return this.Util.calculateTextareaHeight(),!0;if(this.toggleSendButton(txtarea),13==keycode){if(!Smiley.handleInSertSmiley(null,e.target))return this.Util.calculateTextareaHeight(),!1;this.triggerSendMessage(txtarea),e.preventDefault()}var eprops=$Support.EmbedObj.eprops;JSON.parse(eprops.showsmiley)&&Smiley.checkAndTriggerSmiley(e,keycode),this.Util.calculateTextareaHeight()},toggleSendButton:function(txtarea){txtarea=txtarea||$Support.getComposer(),""===$.trim(txtarea.val())?$Support.Util.removeSendClickAction():$("#sqico-send").attr("documentclick",txtarea.attr("dockeyup"))},triggerSendMessage:function(txtarea){var util=this.Util;clearTimeout(util.prdcttimer),txtarea=txtarea||$Support.getComposer();var msg=$.trim(txtarea.val());if(""!=msg)if(Licence.verify("creditmask")&&Message.checkMaskOccurance(msg,!0)){$UI.appendConsentDiv(!1),$Support.disableTextarea();var sobj=document.getElementById("msgmaindiv");Message.scroll(sobj)}else this.getUserConsent(0,txtarea)},getUserConsent:function(choice,txtarea){var ismask=1==choice,util=this.Util;clearTimeout(util.prdcttimer),txtarea=txtarea||$Support.getComposer();var msg=$.trim(txtarea.val());ismask&&(msg=Message.checkMaskOccurance(msg,!1)),this.endtimer&&$Support.clearEndTimer(),this.sendMessage(msg,txtarea),$Support.Util.removeSendClickAction(),$UI.removeConsentDiv(),$Support.enableTextarea(),$Support.Util.calculateTextareaHeight(),util.enablepmsg=!1},getChatUserConsent:function(isconsentobtained,skipregister,isproactive){return 0==isconsentobtained?this.closeChatConsentCallBk(isproactive):($Support.LSDB.storeInSession(_SCREENNAME+"_gdpr_chatconsent",!0),isproactive&&$Support.proactivedata?($UI.populateUserAction(),$UI.populateSmileyIcon(),handlePaste(),$Support.startProactiveChat($Support.proactivedata)):($Support.istriggeredchat||$Support.startWaitingTimer(),skipregister||LSMessanger.sid?$Support.addVisitor():this.EmbedObj.vwmsid?LSMessanger.register($Support.Util.productCode,this.EmbedObj.vwmsid):$Support.getAnnonID($Support.EmbedObj.visitorname))),void $UI.removeChatConsentDiv()},startWaitingTimer:function(){$UI.showWaitingUI(),$Support.stepinterval||($Support.stepinterval=500),$Support.waitTimer=setTimeout(function(){$Support.handleWaitingDisplay(!0,null)},$Support.stepinterval)},startProactiveChat:function(dataval){var eobj=this.EmbedObj;$Support.getComposer().val(""),$("#msgarea").val(""),Message.displaySendMessage(eobj.chatID,eobj.question),$Support.handleAjax("joinproactive",dataval,function(response){$Support.Util.handleUpdateBTN(),"error"!=response.objType&&($Support.handleJoinProActive(response.objString),$Support.Util.handleCallbacks("visitor.triggerresponded",{}))})},closeChatConsentCallBk:function(isproactive){if(isproactive||$Support.istriggeredchat)return $Support.istriggeredchat&&this.getComposer().attr("dockeyup","triggermsg"),$Support.getComposer().val(""),$("#msgarea").val(""),void $Support.getParent().$ZSIQChatWindow.closeChatWindow();$Support.getParent().$ZSIQChatWindow.closeChatWindow(),setTimeout(function(){$Support.Util.closeEmbed()})},chatWindowUICallBk:function(){var msgarea=this.composer=$Support.getComposer(),statecookieval=$Support.getParent().$ZSIQUtil.getCookieValue("state");msgarea.val(""),$Support.isbottrigmsg||-1!=this.EmbedObj.chatID&&this.EmbedObj.chatID||$UI.populateVisitorQuestion(),this.handleComposerEvents();var istrigger=this.istrigmsg;if(this.proactive||istrigger)return istrigger||(this.updateTranscriptFromSession(),msgarea.attr("dockeyup","sendmessage")),2==statecookieval&&$Support.getParent().$ZSIQChatWindow.expandChatWindow(),void(istrigger&&msgarea.attr("dockeyup","triggermsg"));var isautochat=this.EmbedObj.addinfo.autochat;isautochat&&""+isautochat=="true"&&$Support.getParent().$ZSIQChatWindow.expandChatWindow()},handleComposerEvents:function(){this.composer.on("focus.blinktitle keyup.blinktitle click.blinktitle",function(){$Support.iscomposerfocus=!0,Message.stopBlinking()}),this.composer.bind("blur.blinktitle",function(){$Support.iscomposerfocus=!1})},reJoin:function(){var that=this,embedobj=that.EmbedObj,dataval=lsnocachefix("json");dataval.visitorid=embedobj.visitorID,this.handleAjax("rejoinvisitor",dataval,function(response){if("error"!=response.objType){var objstring=response.objString,chid=objstring.chid?objstring.chid:embedobj.chatID();if(embedobj.setChatID(chid),LSMessanger.joinchat(chid,embedobj.vwmsid),objstring.visitid&&(embedobj.VISITID=objstring.visitid),objstring.ispickup){var cookievalue=$Support.getCookieValue("ZLD"+embedobj.livelsid);(!cookievalue||cookievalue&&!cookievalue.cid)&&that.handlePickUp(objstring)}}})},handleMissed:function(dinfo,actiontype,force){$UI.removeCWaitHandler(),this.missedVisitorAction(dinfo,actiontype,force)},missedVisitorAction:function(dinfo,actiontype,force){var dataval;lsnocachefix("json");var eobj=$Support.EmbedObj;dataval={lsid:eobj.livelsid,visitorid:encodeURIComponent(eobj.visitorID),vwmsid:eobj.vwmsid,mode:"visitor",debuginfo:CommonUtil.toJSON({"Missed By":dinfo}),actiontype:actiontype},this.handleAjax("missedvisitor",dataval,function(response){$Support.handleMissedVisitor("error"!=response.objType,dinfo)},function(response){})},handleMissedVisitor:function(issuccess,dinfo,istransfermissed,showofflinemsg){if($Support.callquitstatus=!0,LSMessanger.disable(),clearTimeout($Support.waitTimer),$Support.removeChatCookie(),issuccess){if(dinfo&&"ONHAS"==dinfo)$Support.init($Support.getParent().$ZSIQWidget.getEmbedObject()),$Support.getParent().$ZSIQChatWindow.constructIframe();else if(!$Support.waitingtime||$Support.waitingtime<=0){var eobj=$Support.EmbedObj;if(eobj.setPrevCHID(eobj.chatID),eobj.setChatID(-1),$UI.showMissedVisitorBanner(showofflinemsg),$("#msgarea").after($Temp.getSendIcon(!0)),!istransfermissed){var obj={name:eobj.visitorname,email:eobj.visitoremail,question:eobj.question,visitid:eobj.VISITID};obj.phone=eobj.visitorphone?eobj.visitorphone:"",obj.customfields=eobj.cinfo?eobj.cinfo:"",$Support.Util.handleCallbacks("visitor.missed",obj)}}var params={};params.chid=eobj.lchid,$Support.handleOnGoingchatActionsInConversation("missedchat",params)}},transferMissedLeaveMessage:function(curr){$Support.callquitstatus=!0,LSMessanger.disable(),$Support.removeChatCookie();var eobj=$Support.EmbedObj;eobj.setPrevCHID(eobj.chatID),eobj.setChatID(-1);var showofflinemsg=!1;"offline"==curr.attr("purpose")&&(showofflinemsg=!0),$TH.handleMissedStatus(showofflinemsg)},handleLeaveMessage:function(){$Support.sendOfflineMsg()},getComposer:function(){return $Support.composer||$("#msgarea")},sendOfflineMsg:function(){var dataval={},that=$Support,embedobj=that.EmbedObj,txtarea=that.getComposer(),msg=$.trim(txtarea.val());$.extend(dataval,Browser.getInfo(),{referrer:processInput("trimlength",dataval.referrer,3e3),currentpage:processInput("trimlength",dataval.currentpage,950),lsid:embedobj.livelsid,email:processInput("emailid",embedobj.visitoremail),name:embedobj.visitorname,msg:msg,deptid:embedobj.department,isengaged:that.engaged||!1}),this.updateDynamicKeys(dataval),embedobj.visitorphone&&(dataval.phone=embedobj.visitorphone),embedobj.uvid&&(dataval.uvid=embedobj.uvid);var avuid=this.LSDB.get("ZLD"+$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.lsid+"avuid");avuid&&(dataval.avuid=avuid);var cvuid=$Support.getParent().$ZSIQUtil.getAPIVisitorID();cvuid&&(dataval.cvuid=cvuid);var exid=embedobj.exid;exid&&(dataval.exid=exid);var cinfo=embedobj.cinfo;cinfo&&("object"==typeof cinfo&&(cinfo=JSON.stringify(cinfo)),dataval.cinfo=cinfo);var attendername,attenderimagekey,personalizedchatattender=this.LSDB.get("ZLDPERSONALIZE");if($Support.getParent().$ZSIQChat.getWidgetData().widgettype==$Support.getParent().SIQ_PERSONALIZE&&personalizedchatattender){dataval.attender=personalizedchatattender;var userobj=$Support.getParent().$ZSIQWidgetUI.getUserObj(personalizedchatattender);attendername=userobj.name,attenderimagekey=userobj.image_fkey}dataval.includebots=!0,$Support.LSDB.storeInSession(_SCREENNAME+"_gdpr_chatconsent",!0),$UI.removeOfflineConsentDiv(),that.handleAjax("leavemsg",dataval,function(response){if("error"!=response.objType&&"leavemsg"==response.module){var params=response.objString;if("object"===response.objType&&"EMBEDONLINE"===params.ERROR)return void that.handleLeaveMessageStatusChange(params);$EmbedManger.setQuitStatus(!0);var aggreg_status=$Support.getAggregateStatus(embedobj.deptlist),respmsg=that.engaged?embedobj.engagedrespmsg:aggreg_status[0]&&embedobj.deptofflinerespmsg?embedobj.deptofflinerespmsg:embedobj.offlinerespmsg;DynamicMsg.updateValue("visit_id",params.visit_id),$Support.Util.removeSendClickAction(),$Support.bannertimeout=setTimeout(function(){$UI.showBanner(DynamicMsg.fillValues(respmsg),!0,$Support.Util.minimizeEmbed,5e3),$("#info_banr").removeClass("relate"),$Support.Util.setTextareaHeight()},700),txtarea.val("");var obj={name:embedobj.visitorname,email:embedobj.visitoremail,question:msg,visitid:params.visit_id};obj.phone=embedobj.visitorphone?embedobj.visitorphone:"",obj.customfields=embedobj.cinfo?embedobj.cinfo:"",$Support.Util.handleCallbacks("visitor.offline",obj);var convparams={};convparams.question=getEscapedText(msg),convparams.endtime=params.servertime,convparams.name=params.name,convparams.visitorid=params.encvisitorid,attendername&&(convparams.attender=attendername,convparams.attender_imgkey=attenderimagekey),$Support.handleOnGoingchatActionsInConversation("leavemsg",convparams)}})},setInfoCookie:function(msg){var embedobj=$Support.EmbedObj,container=$Support.container,cookieobj={question:msg};CommonUtil.addIfExists(cookieobj,"name",container.find('[info = "name"]').val()),CommonUtil.addIfExists(cookieobj,"email",container.find('[info = "email"]').val()),CommonUtil.addIfExists(cookieobj,"phone",container.find('[info = "phone"]').val()),this.LSDB.set("ZLD"+embedobj.livelsid+"VISITORINFO",cookieobj,6e4)},handleTriggerMsg:function(curr,keycode,event){if(13==keycode&&event.shiftKey)return!0;$Support.toggleSendButton(curr),13===keycode&&this.startTriggerChat(curr)},startTriggerChat:function(txtarea){return txtarea=txtarea||this.getComposer(),""!==$.trim(txtarea.val())&&(this.istriggeredchat=!0,-1==$Support.EmbedObj.department||$Support.Util.IsMandatoryFieldsAvailable()?(this.disableTextarea(txtarea),$UI.showUserEditUI(),void $Support.container.find('[documentclick="updateuserdetails"]').attr("callback","trigger")):(this.enableTextarea(txtarea),$Support.updateVisitorName(),$Support.Util.removeSendClickAction(),this.getComposer().attr("dockeyup","sendmessage"),void $Support.startChat()))},disableTextarea:function(txtarea){(txtarea=txtarea||$Support.getComposer()).attr("disabled","true")},enableTextarea:function(txtarea){(txtarea=txtarea||$Support.getComposer()).removeAttr("disabled")},missedLeaveMsg:function(txtarea){var that=$Support;that.ismissed=!0,txtarea=txtarea||that.getComposer(),eobj=that.EmbedObj;var message=$.trim(txtarea.val());if(Licence.verify("creditmask")&&Message.checkMaskOccurance(message,!0)){$UI.appendConsentDiv(!0),that.disableTextarea(txtarea);var sobj=document.getElementById("msgmaindiv");Message.scroll(sobj)}else this.getMissedUserConsent(0,txtarea)},getMissedUserConsent:function(choice,txtarea){var ismask=1==choice,that=$Support;txtarea=txtarea||that.getComposer();var eobj=that.EmbedObj,chid=eobj.lchid,message=$.trim(txtarea.val());eobj.setPrevCHID(-1),ismask&&(message=Message.checkMaskOccurance(message,!1)),Message.send(chid,message),$UI.removeConsentDiv(),that.Util.calculateTextareaHeight(),$UI.hideUserEditUI();var dataval={};(dataval=lsnocachefix("json")).lsid=eobj.livelsid,dataval.visitorid=eobj.visitorID,dataval.msg=message,dataval.dname=eobj.visitorname,dataval.email=eobj.visitoremail,dataval.vwmsid=eobj.vwmsid,eobj.visitorphone&&(dataval.phone=eobj.visitorphone),that.updateDynamicKeys(dataval),that.handleAjax("missedleavemsg",dataval,function(response){if("error"!=response.objType&&"unattleavemessage"==response.module){that.disableTextarea(txtarea),txtarea.val(""),delete that.ismissed,DynamicMsg.updateValue("visit_id",response.objString.VISITID),that.removeChatCookie(),$Support.bannertimeout=setTimeout(function(){$UI.showBanner(DynamicMsg.fillValues($Support.EmbedObj.missedrespmsg),!0,function(){$Support.Util.closeEmbed()}),$("#info_banr").removeClass("relate"),$Support.Util.setTextareaHeight()},1e3);var params={};params.msg=message,$Support.handleOnGoingchatActionsInConversation("missedleave",params)}})},setCookie:function(){var eobj=this.EmbedObj,visitorid=eobj.visitorID;if(!(this.waitingtime||-1===eobj.chatID&&-1===visitorid)){clearTimeout($Support.timer);var cookieobject={name:eobj.visitorname,email:eobj.visitoremail,phone:eobj.visitorphone,cid:eobj.chatID,did:eobj.department,vid:eobj.visitorID,vwmsid:eobj.vwmsid,attender:eobj.attender,attenderzuid:eobj.attenderZUID,attenderuseragent:eobj.attenderuseragent,uvid:eobj.uvid,ques:eobj.question,visitid:eobj.VISITID,imagefkey:eobj.attenderimagefkey};eobj.chatintime&&(cookieobject.chatintime=eobj.chatintime);var currcookie=$Support.getCookieValue("ZLD"+eobj.livelsid),ckabtme=currcookie&&currcookie["aboutme_"+visitorid],ckatname=currcookie&&currcookie["attname_"+visitorid];cookieobject["aboutme_"+visitorid]=ckabtme||eobj.attenderaboutme,cookieobject["attname_"+visitorid]=ckatname||eobj.attendername,CommonUtil.addIfExists(cookieobject,"attenderemail",eobj.attenderemail),$Support.proactive&&(cookieobject.isproactive=!0),$Support.istriggeredchat&&(cookieobject.istriggeredchat=!0),$Support.isBotChat&&(cookieobject.isbotchat=!0,$Support.botchatprops&&(cookieobject.botchatprops=$Support.botchatprops)),this.LSDB.set("ZLD"+eobj.livelsid,cookieobject,31e4),$Support.timer=setTimeout(function(){$Support.setCookie()},3e5)}},setWaitingCookie:function(intime){var eobj=this.EmbedObj;if(eobj.type&&"embed"!=eobj.type){var wtime=eobj.embedwaitingtime,cookieobj={vid:eobj.visitorID,vwmsid:eobj.vwmsid,waitinghandlerprops:{intime:this.intime,latency:this.latency},name:eobj.visitorname,email:eobj.visitoremail,phone:eobj.visitorphone,did:eobj.deparment,chid:eobj.chatID,ques:eobj.question,visitid:eobj.VISITID};eobj.attender&&(cookieobj.attender=eobj.attender),this.LSDB.set("ZLD"+eobj.livelsid+"WAITING",cookieobj,1e3*wtime)}},updateChatCookie:function(){clearTimeout($Support.timer);var eobj=this.EmbedObj,cookieobject={name:eobj.visitorname,email:eobj.visitoremail,phone:eobj.visitorphone};this.LSDB.set("ZLD"+eobj.livelsid,cookieobject,31e4)},removeCacheCookie:function(){this.LSDB.removeSessionStore(this.EmbedObj.chatID+"_transcript")},getCookieValue:function(key){return key?this.LSDB.get(key):""},isSessionTranscriptEmpty:function(){var cachedata=this.LSDB.getFromSession(this.EmbedObj.chatID+"_transcript");return!(cachedata&&0<cachedata.length)},getWaitingCookie:function(){var value=this.getCookieValue("ZLD"+this.EmbedObj.livelsid+"WAITING");try{if("window"==PersonalSupport.type)return""}catch(e){}return value},getWaitingHandlerCookie:function(){var eobj=this.EmbedObj,cookiekey="ZLD"+eobj.livelsid+"WTIME",cookie=this.LSDB.get(cookiekey);if($Support.latency||($Support.latency=0),cookie){var interval=(new Date).getTime()-cookie.previouscalltime;cookie.remwaitingtime=cookie.remwaitingtime+parseInt($Support.latency)-interval,cookie.previouscalltime=(new Date).getTime()}else cookie={remwaitingtime:1e3*eobj.embedwaitingtime,previouscalltime:(new Date).getTime()};return this.LSDB.set(cookiekey,cookie,12e4),cookie},removeChatCookie:function(){clearTimeout($Support.timer),this.removeCookie("ZLD"+this.EmbedObj.livelsid)},getTriggerCookie:function(){if(this.isFloat())return this.getCookieValue("ZLDTRIGGER"+this.EmbedObj.livelsid)},setTriggerCookie:function(data){var that=this,eobj=that.EmbedObj;clearTimeout(that.triggercookietimer);var name=eobj.visitorname,email=eobj.visitoremail,cookieobj={sendername:data.sendername,message:data.message,uvid:eobj.uvid,name:name,email:email,cinfo:eobj.cinfo};data.attenderdetails&&(cookieobj.attenderdetails=data.attenderdetails),this.LSDB.set("ZLDTRIGGER"+eobj.livelsid,cookieobj,31e4),that.triggercookietimer=setTimeout(function(){that.setTriggerCookie(data)},3e5)},deleteTriggerCookie:function(){clearTimeout(this.triggercookietimer),this.removeCookie("ZLDTRIGGER"+this.EmbedObj.livelsid)},removeCookie:function(key){this.LSDB.remove(key)},handleWaitingCookie:function(value){if(!this.isFloat())return!1;this.updateCommonKeys(value),LSMessanger.register($Support.Util.productCode,value.vwmsid),LSMessanger.setNickName(value.name);var chid=value.chid,embedobj=$Support.EmbedObj;embedobj.question=value.ques,this.intime=value.intime,embedobj.setChatID(chid),$UI.setHeader(),$UI.setBody(!0),$UI.setFooter(),DynamicMsg.setValues($Support.getValuesForDynamicMsg()),$Support.handleWaitingDisplay("");var waitprops=value.waitinghandlerprops;$Support.intime=waitprops.intime,$Support.latency=waitprops.latency},updateCommonKeys:function(value){var embedobj=this.EmbedObj;embedobj.setVisitorName(value.name),embedobj.setVisitorEmail(value.email),embedobj.setChatID(value.cid),embedobj.setSelectedDept(value.did),embedobj.setVisitorID(value.vid),embedobj.setvwmsID(value.vwmsid),embedobj.setVisitID(value.visitid),embedobj.setVisitorPhone(value.phone),value.attender&&embedobj.setAttender(value.attender),value.chatintime&&(embedobj.chatintime=value.chatintime)},quitChat:function(){var infobanr=$("#info_banr");infobanr.find(".siq-share-url")[0]&&infobanr.remove();var dataval,embedobj=this.EmbedObj,visitorid=embedobj.visitorID;-1!==visitorid&&(lsnocachefix("json"),dataval={chid:embedobj.chatID,lsid:embedobj.livelsid,uname:LSMessanger.getUserId(),visitorid:encodeURIComponent(visitorid),deptid:embedobj.department,tzoffset:CommonUtil.TZOFFSET},CallImpl.isCallWithChat||avimpl.stopOngoingCallOnChatEnding(),this.handleAjax("leavesupport",dataval,function(response){var data=response.objString;$Support.handleChatEnded(data),$Support.convongoingchatobj&&($Support.convongoingchatobj.find(".siqc_eletype")[0].className="siqc_eletype")}))},getAnnonID:function(name){var dataval={};(dataval=lsnocachefix("json",!1)).name=name,this.handleAjax("getannonid",dataval,function(response){if("getannonid"==response.module){var uannonid=response.objString.ANNONID;$Support.EmbedObj.vwmsid=uannonid;var widgetdata=$Support.getParent().$ZSIQChat.getWidgetData();widgetdata.embedobj.annonid=uannonid,$Support.getParent().$ZSIQUtil.storeDetails(widgetdata),LSMessanger.register($Support.Util.productCode,uannonid)}})},handleChatEnded:function(msgObj){if(!$EmbedManger.getQuitStatus()){$Support.cacheCurrentChat(),$Support.clearEndTimer(),$("#msgarea").off("paste"),$UI.updateChatEndMsg(),$Support.Util.handleResize();var thankDefaultMsg,eobj=this.EmbedObj,thnxmsg=eobj.thanksmsg;thnxmsg?thnxmsg=DynamicMsg.fillValues(thnxmsg):(thankDefaultMsg=$Support.israting&&$Support.isfeedback?"embed.thanksmsg.ratingandfeedback":$Support.israting?"embed.thanksmsg.rating":$Support.isfeedback?"embed.thanksmsg.feedback":"embed.thanksmsg.noratingandfeedback",thnxmsg=LSResource.getRealValue(thankDefaultMsg)),$UI.showBanner(thnxmsg,!0,null,2500),this.LSDB.remove(eobj.chatID+"_sound"),this.LSDB.remove(eobj.chatID+"_translate"),$Support.hidetranslatebanner(),$UI.removeSmileyIcon(),$UI.showFeedback(),Message.scroll($Support.chatdiv[0]),Message.stopBlinking(),eobj.setPrevCHID(eobj.chatID),eobj.setChatID(-1),$Support.removeCacheCookie(),$Support.updateChatCookie(),$EmbedManger.setQuitStatus(!0),$Support.isBotChat&&($Support.botchatprops&&$Support.botchatprops.status&&"waiting"==$Support.botchatprops.status&&($Support.removeCookie("ZLD"+eobj.livelsid+"WAITING"),$UI.removeCWaitHandler(),clearTimeout($Support.waitTimer),delete $Support.waitingtime),$UI.removeTransferDiv()),delete $Support.ischatdisabled,delete $Support.botchatprops;var obj={visitid:msgObj.visitid,chatduration:msgObj.chatduration};$Support.Util.handleCallbacks("visitor.chatcomplete",obj),$Support.isipblocked&&this.removeWidget()}},restartchat:function(){if(!$Support.Util.isPreview()){var embedobj=this.EmbedObj;$Support.callquitstatus=!1,embedobj.setVisitorID(-1),embedobj.setChatID(-1),embedobj.setVisitID(-1),_JOINED=!1,Message.presender="",$Support.isfeedbacksent=!1,this.initiateChat(!0),$UI.setFooter()}},sendMail:function(visitorid,mailid,chid){var mailpopup=$("#smailbx"),mailinput=mailpopup.find("input");if(mailid=mailinput.val(),!mailinput.attr("disabled")&&""!=mailid){var maildiv=$Support.contentdiv.find('[documentclick="sendmail"]');if(chid=maildiv.attr("chid"),maildiv.attr("visitorid"),!this.Util.validateFields(mailpopup))return!1;$UI.hideUtilityDiv(mailpopup),$UI.populateSendMailConfirm(mailid,chid)}},sendMailConfirm:function(curr){var embedobj=$Support.EmbedObj,mailconfirmbx=$("#consentbannerdiv"),showchtend=!1;if($Support.contentdiv.find(".infomsg.chtend").length&&(showchtend=!0),curr.hasClass("gltr-no"))$UI.hideUtilityDiv(mailconfirmbx,!0,showchtend);else{var mailid=curr.attr("cattr");$UI.hideUtilityDiv(mailconfirmbx,!0,showchtend);var chid=curr.attr("chid")||embedobj.chatID,visitorid=embedobj.visitorID,dataval={chid:chid,fformat:"mail",toemail:$.trim(mailid),cmode:"live",visitorid:encodeURIComponent(visitorid),oprname:"chat",user:embedobj.vwmsid,tzoffset:_TZCOFFSET};this.handleAjax("visdataexport",dataval,function(){$UI.showBanner(LSResource.getRealValue("infomsg.mailsended"),!0),$Support.Util.handleCallbacks("chat.mail",{})},function(){$UI.showBanner(LSResource.getRealValue("ne.sendmail.failed"),!0)},LSResource.getRealValue("ne.mail.progress"))}},updateTranslateCookie:function(){var translatebannerdiv=$Support.contentdiv.find("#consentbannerdiv"),key=$Support.EmbedObj.chatID+"_translate";this.LSDB.set(key,!0),$UI.hideUtilityDiv(translatebannerdiv,!0)},hidetranslatebanner:function(){var translatebannerdiv=$Support.contentdiv.find("#consentbannerdiv");$UI.hideUtilityDiv(translatebannerdiv,!0)},printPreview:function(){var embedobj=$Support.EmbedObj,chid=embedobj.chatID,visitorid=embedobj.visitorID,tzoffset=_TZCOFFSET;if(-1!=chid){if(null==chid||null==chid)return;var nW=parseInt(80*screen.width/100),nH=parseInt(77*screen.height/100),l=(screen.width-nW)/2,t=(screen.height-nH)/2,url=$Support.getAjaxURL("embedprintchat",".ls");url+="?chid="+encodeURIComponent(chid)+"&visitorid="+encodeURIComponent(visitorid)+"&tzoffset="+tzoffset+"&cross_domain=true",url+=lsnocachefix(),window.open(url,(new Date).getTime(),"height="+nH+", width="+nW+",status=yes,toolbar=no,top="+t+", left="+l+", menubar=no,location=no,scrollbars=yes,resizable=yes"),$Support.Util.handleCallbacks("chat.print",{})}$Support.Util.hideMoreActionDiv()},setRating:function(stardiv){var rating=this.rating=5-stardiv.index(),dataval={};(dataval=lsnocachefix("json")).rate=rating,eobj=$Support.EmbedObj,dataval.visitorid=encodeURIComponent(eobj.visitorID),dataval.isbotchat=$Support.isBotChat,this.handleAjax("setsuppreprate",dataval,function(){if(CallImpl.isCallWithChat){CallImpl.updateUI(AV_FDBCK,rating);var obj={visitid:eobj.VISITID,rating:rating,agent:eobj.attenderemail};return $Support.Util.handleCallbacks("visitor.rating",obj),void $("#fdbkarea").slideDown(250,function(){$(this).focus()})}var fdbmsg=eobj["feedbackcomplete"+rating]||LSResource.getRealValue("ne.rating."+rating);$UI.showBanner(fdbmsg,!0,null,2500),obj={visitid:eobj.VISITID,rating:rating,agent:eobj.attenderemail},$Support.Util.handleCallbacks("visitor.rating",obj),$("#fdbkarea").slideDown(250,function(){$(this).focus()}),$("#sqico-send").show(),!(0<$Support.contentdiv.find("#feedback_res").length&&$Support.contentdiv.find("#feedback_res").hasClass("lstmsg_strs"))&&$Support.isfeedbacksent&&$UI.showFdbkResponse()})},handleAjax:function(url,dataval,successcb,errorcb,loadingmsg){if(!$Support["requestRunning_"+url]){$Support["requestRunning_"+url]=!0;var timer=setTimeout(function(){loadingmsg&&$UI.showBanner(loadingmsg)},500);$.ajax({url:$Support.getAjaxURL(url,dext),type:"POST",data:dataval,dataType:"json",async:!0,success:function(response){clearTimeout(timer),successcb&&(successcb(response&&response[0]),delete $Support["requestRunning_"+url])},error:function(par1,par2,par3){clearTimeout(timer),errorcb&&(errorcb(par1),delete $Support["requestRunning_"+url])}})}},sendFeedback:function(txtarea){if(txtarea=txtarea||$("#fdbkarea"),!($Support.isfeedbacksent||txtarea.val().length<1)){var dataval={},that=this,eobj=$Support.EmbedObj,msg=txtarea.val();(dataval=lsnocachefix("json")).visitorid=encodeURIComponent(eobj.visitorID),dataval.msg=msg,CallImpl.updateUI(AV_FDBCKSUCCESS),this.handleAjax("visitorfeedback",dataval,function(response){if("error"!=response.objType&&"addfeedback"==response.module){if(CallImpl.isCallWithChat){var obj={visitid:eobj.VISITID,rating:rating,agent:eobj.attenderemail};return void $Support.Util.handleCallbacks("visitor.rating",obj)}that.disableTextarea(txtarea),$Support.isfeedbacksent=!0,$UI.showFdbkResponse(),obj={visitid:eobj.VISITID,feedback:msg,agent:eobj.attenderemail},$Support.Util.handleCallbacks("visitor.feedback",obj)}},"",LSResource.getRealValue("ne.feedback.progress"))}},handleEndSession:function(timer,isstart){if(clearTimeout(this.timervar),this.endtimer=!0,this.callquitstatus&&this.clearTimer(),(params={}).timer=--timer,params.isstart=isstart,$Support.handleOnGoingchatActionsInConversation("endtimerupdate",params),0<timer){var params,endtimer=$("#endtimer");endtimer.length?(endtimer.html(timer+" sec"),(params={}).timer=timer,$Support.handleOnGoingchatActionsInConversation("endtimerupdate",params)):Message.displayInfo(LSResource.getRealValue("ne.chatend.timer",""+timer)),this.timervar=setTimeout(function(){$Support.handleEndSession(timer,!1)},1e3)}else this.clearEndTimer()},clearEndTimer:function(){clearTimeout($Support.timervar),this.endtimer&&($("#endtimer").parents(".infomsg").fadeOut(function(){$(this).remove()}),EmbedSound.stop(),$Support.handleOnGoingchatActionsInConversation("endtimerclear"))},updateVisitorInfo:function(name,email,phone,callback){if(name||email||phone){var embedobj=$Support.EmbedObj,dataval=lsnocachefix("json");dataval.visitorid=embedobj.visitorID,name&&(dataval.lastname=name),email&&(dataval.email=email),phone&&(dataval.phone=phone),dataval.isnamefromemail=!!embedobj.isnamefromemail&&embedobj.isnamefromemail,this.handleAjax("updatevistdata",dataval,function(response){$Support.Util.handleUpdateBTN(),"error"!=response.objType&&(embedobj.setVisitorEmail(email),embedobj.setVisitorName(name),embedobj.setVisitorPhone(phone),$UI.updateVisitorName({name:name}),"function"==typeof callback&&callback(),$UI.hideUserEditUI(),$Support.setCookie())})}},checkAndUpdateInfo:function(curr){var callback={"missed-leave":$Support.missedLeaveMsg,trigger:$Support.startChat,proactive:$Support.joinProactiveChat};$Support.checkCustomFields();var editobj=$Support.contentdiv.find("div.editfields");if(!this.Util.validateFields(editobj))return e.preventDefault(),!1;$Support.Util.handleUpdateBTN(!0);var $name_input=editobj.find('input[purpose="visitorname"]'),$email_input=editobj.find('input[purpose="visitoremail"]'),$phone_input=editobj.find('input[purpose="visitorphone"]'),name=$.trim($name_input.val()),email=$.trim($email_input.val()),phone=$.trim($phone_input.val()),cbattr=curr.attr("callback");!name&&email&&(name=email?email.split("@")[0]:name,$Support.EmbedObj.isnamefromemail=!0);var eobj=$Support.EmbedObj;if(email&&eobj.setVisitorEmail(email),name&&eobj.setVisitorName(name),phone&&eobj.setVisitorPhone(phone),"proactive"===cbattr)return callback[cbattr](),$UI.hideUserEditUI(),void $Support.setCookie();"trigger"!==cbattr?this.updateVisitorInfo(name,email,phone,callback[cbattr]):(this.updateInputValues(),curr.removeAttr("documentclick"),$Support.startChat())},joinProactiveChat:function(msg){if($Support.Util.IsMandatoryFieldsAvailable())return this.disableTextarea(),$UI.showUserEditUI(),void $('[documentclick="updateuserdetails"]').attr("callback","proactive");var widgetobj=$Support.getParent().$ZSIQChat.getWidgetData().widgetobj,eobj=$Support.EmbedObj,pinfo=eobj.pprops,consentstoragedata=$Support.LSDB.getFromSession(_SCREENNAME+"_gdpr_chatconsent"),isshowchatconsent=!(1!=widgetobj.isgdprenabled||!JSON.parse(pinfo.isgdprenabled)||1!=JSON.parse(pinfo.chatprivacyconfig)||consentstoragedata),chatcookiepolicyurl=pinfo.chatcookiepolicyurl,dataval=Browser.getInfo(),txtarea=$Support.getComposer();$Support.enableTextarea(txtarea),msg=msg||$.trim(txtarea.val()),LSMessanger.setNickName(eobj.visitorname),$.extend(dataval,{chid:eobj.chatID,uvid:eobj.uvid,vwmsid:eobj.vwmsid,msg:msg,sid:LSMessanger.getSid(),name:eobj.visitorname}),eobj.visitorphone&&(dataval.phone=eobj.visitorphone),eobj.visitoremail&&(dataval.email=processInput("emailid",eobj.visitoremail));var cachefix=lsnocachefix("json");for(var k in cachefix)dataval[k]=cachefix[k];eobj.cinfo&&("object"==typeof eobj.cinfo&&(eobj.cinfo=JSON.stringify(eobj.cinfo)),dataval.cinfo=eobj.cinfo);var avuid=$Support.LSDB.get("ZLD"+$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.lsid+"avuid");avuid&&(dataval.avuid=avuid);var cvuid=$Support.getParent().$ZSIQUtil.getAPIVisitorID();if(cvuid&&(dataval.cvuid=cvuid),eobj.question=msg,isshowchatconsent)return $Support.proactivedata=dataval,void $UI.appendChatConsentDiv(!1,!0,chatcookiepolicyurl);txtarea.val(""),$("#msgarea").val(""),Message.displaySendMessage(eobj.chatID,msg),$UI.populateUserAction(),$UI.populateSmileyIcon(),handlePaste(),avimpl.checkAudioCallButton(),$Support.handleAjax("joinproactive",dataval,function(response){$Support.Util.handleUpdateBTN(),"error"!=response.objType&&($Support.handleJoinProActive(response.objString),$Support.Util.handleCallbacks("visitor.triggerresponded",{}))})},handleJoinProActive:function(dataobj){var embedobj=$Support.EmbedObj;embedobj.setVisitorID(dataobj.CUID),embedobj.VISITID=dataobj.VISITID;var attender=dataobj.ATTENDER;attender&&embedobj.attender!==attender&&embedobj.setAttender(attender),delete this.proactive,this.setCookie()},handleApiData:function(value,isbroadcast){var eobj=$Support.EmbedObj;if(value){if(eobj.setAddinfo(value),eobj.uvid=value.uvid||eobj.uvid,eobj.visitorname=value.name||eobj.visitorname,eobj.visitoremail=value.email||eobj.visitoremail,eobj.visitorphone=value.phone||eobj.visitorphone,eobj.question=value.question||eobj.question,eobj.attenderemail=value.agent||eobj.attenderemail,eobj.messagehint=value.messagehint||"",null!=value.department){var deptarray=value.department;"online.department"!=value.department&&(value.department=[],value.defaultdepartment&&-1!=value.defaultdepartment&&-1==deptarray.indexOf(value.defaultdepartment)&&deptarray.push(value.defaultdepartment));for(var dlength=eobj.deptlist.length,i=0;i<dlength;i++)-1==deptarray.indexOf(eobj.deptlist[i].DNAME)?eobj.deptlist[i].isClient=!1:"online.department"!=value.department&&value.department.push(eobj.deptlist[i].DNAME);if(0!=value.department.length){var apideptlist=deptarray;deptarray=value.department,"personal"==$Support.type&&$Support.status?PersonalSupport.handleDeptChange(deptarray):this.Util.handleDeptApiChange(deptarray,apideptlist)}}value.agent&&$.validateField("email",value.agent)&&(eobj.attenderemail=value.agent),value.info&&(eobj.cinfo=value.info);var requestid=value.requestid;null==requestid||isNaN(requestid)||(eobj.exid=requestid),!value.defaultdepartment&&value.department&&1==value.department.length&&(value.defaultdepartment=value.department[0]);var deftdept=value.defaultdepartment;if(deftdept&&-1!=deftdept){if($Support.status&&"personal"==$Support.type)PersonalSupport.defaultdept=deftdept;else{var deflst=$("#sqico-drpdwn").find('li[uniname="'+deftdept+'"]');deflst.length&&(deflst.trigger("click",[!0]),$Support.isFloat()||$Support.Util.showOfflineBanner())}deftdept&&value.department&&1==value.department.length&&value.department[0]==deftdept&&$Support.container.find("#sqico-drpdwn").hide()}if(void 0!==value.forward&&($Support.nochatforward=value.forward),value["chat.waitinghandler"]&&!isbroadcast&&($Support.isapiwaitinghandler=value["chat.waitinghandler"]),value.callback){var obj=value.callback;if("chat.waitinghandler"in obj){var returnval=obj["chat.waitinghandler"];if("-1"==returnval&&(returnval=null),$Support.cwaitmsg=returnval,$Support.waitingtime&&$UI.populateCWaitHandler(),isbroadcast)return}}if(value.chatstart&&-1==eobj.chatID&&isbroadcast&&(CallImpl.isCallWithChat&&($Support.contentdiv=null,$Support.EmbedObj.lchid=-1,$Support.checkAndShowUI(-1),CallImpl.isCallWithChat=!1,$EmbedManger.setQuitStatus(!1)),$Support.getParent().$ZSIQWidgetUI.removeCallClass(),eobj.addinfo.autochat=!0,$Support.getComposer().trigger("keyup")),-1!=eobj.visitorID&&-1!=eobj.chatID&&value.chatstart){if("outgoing"==avimpl.curr_status)return;$EmbedManger.setQuitStatus(!1),CallImpl.isCallWithChat=null,$Support.contentdiv=null,$Support.getParent().$ZSIQWidgetUI.removeCallClass(),$Support.checkAndShowUI(-1);var url=$Support.getAjaxURL("makeav",dext),dataval={};dataval.chid=$Support.EmbedObj.chatID,dataval.wmsid=$Support.EmbedObj.vwmsid,dataval.mode=AUDIOCALL,dataval.lsuid=$Support.EmbedObj.attender,dataval.action="startchat",$.ajax({url:url,data:dataval,type:"POST"})}value.chatend&&-1!==eobj.chatID&&isbroadcast&&$Support.quitChat();var cmsg=value.chatmessages;if(cmsg&&"object"==typeof cmsg)for(eobj.waitmsg=cmsg.waiting||eobj.waitmsg,eobj.offlinemessage=cmsg.offline||eobj.offlinemessage,eobj.missedmessage=cmsg.busy||eobj.missedmessage,eobj.offlinerespmsg=cmsg.offlinecomplete||eobj.offlinerespmsg,eobj.thanksmsg=cmsg.complete||eobj.thanksmsg,eobj.missedrespmsg=cmsg.busycomplete||eobj.missedrespmsg,eobj.engagedmessage=cmsg.engaged||eobj.engagedmessage,eobj.engagedrespmsg=cmsg.engagedcomplete||eobj.engagedrespmsg,eobj.feedbackcomplete=cmsg.feedbackcomplete,i=1;i<=5;i++)cmsg["feedbackcomplete"+i]&&(eobj["feedbackcomplete"+i]=cmsg["feedbackcomplete"+i]);var customobj=value.customfield;(customobj||value.clearcustomfield)&&(customobj?(this.customobj=customobj,this.Util.handleCustomHTML()):this.Util.checkAndRemoveCustomField(value.clearcustomfield)),value.title&&(document.title=value.title);var rating=value["rating.visible"],feedback=value["feedback.visible"];if((rating||feedback)&&(rating&&($Support.israting="hide"!=rating),feedback&&($Support.isfeedback="hide"!=feedback)),value.clogo){var cmlogo=$("#complogo"),cmurl=$("#compurl"),cwebsite=value.cwebsite;cmlogo.length&&cmlogo.attr("src",value.clogo),cwebsite&&(cwebsite=-1==cwebsite.indexOf("http")?"http://"+cwebsite:cwebsite,cmurl.length?cmurl.attr("href",cwebsite):cmlogo.wrapAll("<a id='compurl' target='_blank' href='"+cwebsite+"'>"))}if($Support.EmbedObj.status&&value.floatwindowonlinetitle&&!$Support.EmbedObj.attender&&!$Support.getTriggerCookie()&&$("#attname").text(value.floatwindowonlinetitle),$Support.EmbedObj.status||!value.floatwindowofflinetitle||$Support.EmbedObj.attender||$("#attname").text(value.floatwindowofflinetitle),$Support.isConversationAllowed()&&value.defaultview&&"Classic"==value.defaultview&&this.openClassicUI(),value.callstart&&-1==eobj.chatID&&isbroadcast&&!$Support.proactive&&!$Support.istriggeredchat){if(avimpl.curr_status)return;avimpl.curr_status="outgoing";var defaultques=LSResource.getRealValue("av.info.callquesmsg",eobj.visitorname);$Support.container.find('[info = "question"]').val(defaultques),eobj.isaudiocall=!0,$Support.updateInputValues(),$Support.startChat(),$Support.container.remove(),$UI.setContainer(),$Support.getParent().$ZSIQUtil.getAPIValues(),$Support.container.append($Support.contentdiv=CallUIHandler.getTempForThemes(AV_OUTGOINGCALL)),$Support.getParent().$ZSIQWidgetUI.handleMinimizeCall(),$Support.getParent().$ZSIQChatWindow.openChatWindow()}value.waitime&&$Support.EmbedObj.status&&($Support.EmbedObj.embedwaitingtime=value.waitime),this.updateValuesFromVisitorInfoCookie(),this.Util.fillApiValues()}},handleAPIFunctionalities:function(key,value){var eobj=$Support.EmbedObj;"chatstart"==key?(eobj.addinfo.autochat=!0,$Support.getComposer().trigger("keyup")):"chatend"==key&&-1!==eobj.chatID&&$Support.quitChat()},updateValuesFromVisitorInfoCookie:function(){var embedobj=$Support.EmbedObj,visitorinfo=this.getCookieValue("ZLD"+embedobj.livelsid+"VISITORINFO");visitorinfo&&(embedobj.setVisitorName(visitorinfo.name),embedobj.setVisitorEmail(visitorinfo.email),embedobj.setAddinfo(visitorinfo),visitorinfo.phone&&embedobj.setVisitorPhone(visitorinfo.phone),this.removeCookie("ZLD"+embedobj.livelsid+"VISITORINFO"))},getOfflineMessage:function(){var eobj=$Support.EmbedObj;if(eobj.bushrstatus)return $UI.getBusinessHrInfo();var deptlist=eobj.deptlist,statusarr=$Support.getAggregateStatus(deptlist),engaged=statusarr[1],status=statusarr[0];return engaged?(this.engaged=!0,eobj.engagedmessage?DynamicMsg.fillValues(eobj.engagedmessage):LSResource.getRealValue(1<deptlist.length&&status?"ne.engagedmsg_multidept":"ne.engagedmsg")):1<deptlist.length&&status?eobj.deptofflinemsg?DynamicMsg.fillValues(eobj.deptofflinemsg):LSResource.getRealValue("ne.offlinemsg_multidept"):eobj.offlinemessage?DynamicMsg.fillValues(eobj.offlinemessage):LSResource.getRealValue("ne.offlinemsg")},getAggregateStatus:function(deptlist){for(var engaged=!1,status=!1,deptid=$Support.EmbedObj.department,i=0;i<deptlist.length;i++){var dept=deptlist[i];""+dept.STATUS=="true"&&(status=!0),"-1"!==deptid&&dept.ID!==deptid||""+dept.ENGAGED!="true"||(engaged=!0)}return[status,engaged]},updateDynamicKeys:function(obj){obj.phone&&DynamicMsg.updateValue("phone",obj.phone);var name=obj.name||obj.dname;DynamicMsg.updateValue("name",name),DynamicMsg.updateValue("email",obj.email),obj.msg&&DynamicMsg.updateValue("question",obj.msg),obj.deptid&&DynamicMsg.updateValue("department",obj.deptid)},updateChatCache:function(data,override){override?($.isEmptyObject(data[data.length-1])&&data.splice(data.length-1,1),$Support.cachearr=data):$Support.cachearr.push(data),this.LSDB.storeInSession($Support.EmbedObj.chatID+"_transcript",$Support.cachearr)},isParentIframe:function(){return window.location!=window.parent.location},broadcastVisitor:function(module){var embedobj=$Support.EmbedObj,dataval={};dataval.visitorid=embedobj.visitorID,dataval.module=module||"addvisitor",$Support.LSDB.get("ZLD_ApiAVCall")&&(dataval.isaudiocall=$Support.LSDB.get("ZLD_ApiAVCall")),this.handleAjax("broadcastvisitor",dataval,function(response){if("broadcastvisitordata"==response.module&&response.objString.isagentsavailable){var attendername=$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.userdetails.find(function(obj){return obj.lsuid==embedobj.attender}).name,msg=LSResource.getRealValue("chatwindow.personalchat.transfer",attendername),msgcont=msg||getUnescapedText(Support.waitmsg);msgcont=DynamicMsg.fillValues(msgcont),$("#info_banr span").first().text(msgcont).show()}})},handleStatusCallback:function(){var clbkopr="chat.offline";$Support.EmbedObj.status&&(clbkopr="chat.online"),$Support.Util.handleCallbacks(clbkopr,{})},handleAudioCallback:function(){-1<window.location.protocol.indexOf("https")&&(-1<navigator.userAgent.indexOf("Chrome")||-1<navigator.userAgent.indexOf("Firefox"))&&$Support.Util.handleCallbacks("call.isavsupported",{})},checkCustomFields:function(){var eobj=$Support.EmbedObj,customfield=$Support.contentdiv.find('[purpose="custom"]');if(!customfield.length)return!0;var infoobj=$Support.EmbedObj.cinfo||{};$.each(customfield,function(key,value){var obj=$(value),type=obj.attr("type"),isrequired="true"==obj.attr("mandatory"),name=obj.attr("custom"),visibility=obj.attr("visibility");if(eobj.status&&"offline"==visibility)return!0;if(!eobj.status&&"online"==visibility)return!0;if("radio"==type||"checkbox"==type){var inputobj=obj.find("input:checked");name=obj.attr("name");var arr=[];return $.each(inputobj,function(k,v){arr.push($(v).attr("id"))}),arr.length?(obj.removeClass("errfield").removeAttr("data-validate"),infoobj[name]=arr.join(",")):isrequired&&obj.addClass("errfield"),!0}var val=obj.val();if("selectbox"==type&&(val=obj.find("#dropheader").attr("val")),!val)return!0;infoobj[name]=val}),eobj.cinfo=infoobj},rejoinVisitorInUTS:function(){var dataval=lsnocachefix("json");dataval.visitorid=$Support.EmbedObj.visitorID,this.handleAjax("utsrejoin",dataval,function(response){})},isSignature:function(eobj){return eobj.eparams&&eobj.eparams.signature},handleDesktopSharing:function(msgobj){if(msgobj.msg){var dname=msgobj.msg.opruser.dname,accessurl=decodeURIComponent(msgobj.link),sharetxt="",jointxt="";"request"==msgobj.msg.opr?(sharetxt="chatwindow.requestdesktop",jointxt="common.share"):(sharetxt="chatwindow.sharedesktop",jointxt="common.join");var msg=LSResource.getRealValue(sharetxt,dname)+'&nbsp;&nbsp;<a href="'+accessurl+'" target="_blank" documentclick=openmeeting>'+LSResource.getRealValue(jointxt)+"</a>";this.Util.displayInfo(msg)}$("#mraction").find("#sharedesktop").addClass("cmn_disable")},handleMeetingJoinCB:function(){this.Util.hideInfo(),$("#mraction").find("#sharedesktop").removeClass("cmn_disable")},shareDesktop:function(obj){if(!$(obj).hasClass("cmn_disable")){var dataval={};dataval.chid=$EmbedManger.getChatID(),dataval.attender=$Support.EmbedObj.attender,this.handleAjax("authenticatesharedesktop",dataval,function(response){$Support.Util.hideMoreActionDiv()})}},isHandHeldDevice:function(){return!!$Support.Util.isSIQMobilePreview()||!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB10|IEMobile|Opera Mini/i.test(navigator.userAgent)},isMobileWidth:function(){return window.outerWidth<555||this.isHandHeldDevice()},setUVID:function(uvid){$Support.EmbedObj.uvid=uvid},setTabOwner:function(){var key="ZLD"+$Support.EmbedObj.livelsid+"tabowner";this.LSDB.set(key,LSMessanger.getSid())},getTabOwner:function(){var key="ZLD"+$Support.EmbedObj.livelsid+"tabowner";return this.LSDB.get(key)},incrementUnreadCount:function(){var key="ZLD"+$Support.EmbedObj.livelsid+"unreadcount",value=$Support.getUnreadCount();value?value+=1:value=1,this.LSDB.set(key,value),$Support.getParent().$ZSIQWidgetUI.updateCount(value)},getUnreadCount:function(){var key="ZLD"+$Support.EmbedObj.livelsid+"unreadcount";return this.LSDB.get(key)},removeUnreadCookie:function(){var key="ZLD"+$Support.EmbedObj.livelsid+"unreadcount";this.LSDB.remove(key)},isAllowFreeLogo:function(){return!CommonUtil.isIntegratedPortal()&&(Licence.isFreePlan()||$Support.EmbedObj.isBetaPortal)},handleAddVisitStatusChange:function(msgObj){var eobj=$Support.EmbedObj;clearTimeout($Support.waitTimer),delete $Support.waitingtime,$UI.hideBanner(),$Support.removeCookie("ZLD"+eobj.livelsid+"WAITING"),eobj.setDepartmentList(msgObj.DEPTLIST),eobj.setEmbedStatus(msgObj.STATUS),$Support.container.find(".msgbox textarea").stop(),$Support.container.empty(),$Support.contentdiv=void 0,$Support.composer=void 0,$UI.updateOfflineUI(!0),$Support.container.addClass("outerwin"),$Support.Util.showOfflineBanner(),$UI.setDepartment(eobj.department),eobj.question&&$("#sqico-send").attr("documentclick","leavemessage"),LSMessanger.sid=void 0;var embedobj=$Support.getParent().$ZSIQWidget.getWidgetObject();embedobj.status=msgObj.STATUS,embedobj.onlysticker=!0,$Support.getParent().$ZSIQWidgetUI.drawWidget(embedobj),embedobj.hideoffline&&1==embedobj.hideoffline[0]&&($Support.disableTextarea($Support.getComposer()),setTimeout(function(){$Support.getParent().$ZSIQChatWindow.handleChatWindowVisible("hide"),$Support.getParent().$ZSIQWidgetUI.handleWidgetVisible("hide")},3e3)),$Support.isConversationAllowed()&&$Support.Util.handleShowConversation(!1,!0)},handleLeaveMessageStatusChange:function(msgObj){var eobj=$Support.EmbedObj;eobj.setDepartmentList(msgObj.DEPTLIST),eobj.setEmbedStatus(msgObj.STATUS),$Support.container.find(".msgbox textarea").stop(),$Support.container.empty(),$Support.contentdiv=void 0,$Support.composer=void 0,$UI.updateOnlineUI(!0),$Support.container.addClass("outerwin"),$Support.Util.showOnlineBanner(),$UI.setDepartment(eobj.department),eobj.question&&$("#sqico-send").attr("documentclick","textarea"),LSMessanger.sid=void 0},getAjaxURL:function(name,extn){return url=_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/"+name+extn},appendMetaTag:function(){$("head").append('<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">')},getValuesForDynamicMsg:function(){var eobj=$Support.EmbedObj,obj={};CommonUtil.addIfExists(obj,"name",eobj.visitorname),CommonUtil.addIfExists(obj,"email",eobj.visitoremail),CommonUtil.addIfExists(obj,"phone",eobj.visitorphone),CommonUtil.addIfExists(obj,"department",eobj.department);var question=eobj.question?eobj.question:$Support.composer?$.trim($Support.composer.val()):"";return CommonUtil.addIfExists(obj,"question",question),CommonUtil.addIfExists(obj,"visit_id",eobj.VISITID),CommonUtil.addIfExists(obj,"attendername",eobj.attendername),CommonUtil.addIfExists(obj,"attenderemail",eobj.attenderemail),obj},getValuesForDynamicMsg:function(){var eobj=$Support.EmbedObj,obj={};CommonUtil.addIfExists(obj,"name",eobj.visitorname),CommonUtil.addIfExists(obj,"email",eobj.visitoremail),CommonUtil.addIfExists(obj,"phone",eobj.visitorphone),CommonUtil.addIfExists(obj,"department",eobj.department);var question=eobj.question?eobj.question:$Support.composer?$.trim($Support.composer.val()):"";return CommonUtil.addIfExists(obj,"question",question),CommonUtil.addIfExists(obj,"visit_id",eobj.VISITID),CommonUtil.addIfExists(obj,"attendername",eobj.attendername),CommonUtil.addIfExists(obj,"attenderemail",eobj.attenderemail),obj},transferChat:function(){var dataval=lsnocachefix("json");dataval.visitorid=$Support.EmbedObj.visitorID,$Support.setWaitingCookie(),$UI.showTransferWaiting(),$Support.handleWaitingDisplay(!0,!0),this.handleAjax("transferchat",dataval,function(response){})},handleTransferMissed:function(curr){$UI.removeTransferDiv();var dataval=lsnocachefix("json"),eobj=$Support.EmbedObj,showofflinemsg=!(dataval={lsid:eobj.livelsid,visitorid:encodeURIComponent(eobj.visitorID),vwmsid:eobj.vwmsid,mode:"visitor",actiontype:"2",isbottransfer:!0});"offline"==curr.attr("purpose")&&(showofflinemsg=!0),this.handleAjax("missedvisitor",dataval,function(response){$Support.handleMissedVisitor("error"!=response.objType,null,!0,showofflinemsg)})},hideTransferOption:function(){$UI.removeTransferDiv(),$Support.botchatprops.hidetransfer=!0,this.setCookie()},areUsersAvailable:function(){var embobj=$Support.EmbedObj,deptid=embobj.department;for(var obj in embobj.deptlist)if(embobj.deptlist[obj].ID==deptid)return!embobj.deptlist[obj].ONLYBOTSAVAILABLE;return!1},getBotUser:function(){try{var embobj=$Support.EmbedObj,deptid=embobj.department,botmode=embobj.eprops.isbotenabled[1].mode,botuser=null;for(var obj in embobj.deptlist)if(embobj.deptlist[obj].ID==deptid&&(botuser=embobj.deptlist[obj].BOTUSER,"1"==botmode||"2"==botmode&&embobj.deptlist[obj].ONLYBOTSAVAILABLE))return botuser}catch(e){}return null},isConversationAllowed:function(){if($Support.Util.isPreview())return!1;var eobj=$Support.EmbedObj;return JSON.parse(eobj.eprops.isconversation)&&Licence.verify("conversationallowed")},bindScrollForConversationListContainer:function(){$Support.convlistcontainer.scroll(function(event){var element=event.target;if($Support.convongoingchatobj&&0==element.scrollTop&&$Support.removeConversationPopupMessage(),element.scrollHeight-element.scrollTop===element.clientHeight){if($Support.convlistindex<$Support.convlistlimit[$Support.EmbedObj.windowsize])return;$Support.PopulateConversationList(function(convlist,isprepend){if(convlist.length){var convhishtml="";convlist.forEach(function(conv){convhishtml+=$Temp.getConversationHistoryHTML(conv)}),isprepend?$Support.convlistcontainer.find("#pastchatconv").prepend($(convhishtml)):$Support.convlistcontainer.find("#pastchatconv").append(convhishtml),$Support.Util.showConversationListUI()}},$Support.convlistindex+1)}})},PopulateConversationList:function(callback,startindex){var recentchatendtime,dataval={},avuid=this.LSDB.get("ZLD"+$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.lsid+"avuid");if(dataval=lsnocachefix("json"),avuid){var cachedata=this.LSDB.getFromSession(avuid+"_conversation");if(cachedata&&cachedata.length&&!startindex){callback(cachedata);var recentchatinfo=cachedata[0];(recentchatendtime=recentchatinfo.endtime)&&(dataval.fromtime=recentchatendtime),$Support.convlistindex=cachedata.length}dataval.avuid=avuid;var cvuid=$Support.getParent().$ZSIQUtil.getAPIVisitorID();if(cvuid&&(dataval.cvuid=cvuid),dataval.limit=$Support.convlistlimit[$Support.EmbedObj.windowsize],startindex&&0!=(dataval.index=startindex)){if(0!=$Support.convlistcontainer.find("#convlistloading").length||$Support.isallconvlistfetched)return;$Support.convlistcontainer.find("#pastchatconv").append($Temp.getConversationListLoadingHTML())}this.handleAjax("conversation",dataval,function(response){if($Support.convlistcontainer.find("#convlistloading").remove(),"error"!=response.objType){var convlist=response.objString;if(!convlist.length)return void(recentchatendtime||($Support.isallconvlistfetched=!0));var isprepend=!!recentchatendtime;$Support.updateConversationCache(convlist,avuid,isprepend),callback(convlist,isprepend),$Support.convlistindex+=convlist.length}})}},updateConversationCache:function(data,avuid,isprepend){if(data&&data.length){data=$Support.checkDuplicateInConversationList(data,avuid);var cachedata=this.LSDB.getFromSession(avuid+"_conversation");cachedata&&cachedata.length&&(data=isprepend?data.concat(cachedata):cachedata.concat(data)),this.LSDB.storeInSession(avuid+"_conversation",data)}},checkDuplicateInConversationList:function(data,avuid){try{var cachedata=this.LSDB.getFromSession(avuid+"_conversation");if(!cachedata||!cachedata.length)return data;for(var index=data.length-1;0<=index;index--)for(var currdata=data[index],cacheindex=0;cacheindex<cachedata.length;cacheindex++){var currcachedata=cachedata[cacheindex];if(currdata.visitorid==currcachedata.visitorid){data.splice(index,1);break}}}catch(e){}return data},getConversationChatTranscript:function(chid,visitorid){var psender=Message.presender;$("#conversioncontainer").hide(),$Support.convtranscontainer.html($Temp.getLoadingHTML()).show();var transcriptcachedata=this.LSDB.getFromSession(chid+"_transcript");$Support.Util.showConversationTranscriptUI(visitorid);var cacheattenderdata,iscacheuptodate=!1;if(transcriptcachedata&&(cacheattenderdata=transcriptcachedata[0],iscacheuptodate=$("#attname").html()==cacheattenderdata.attendername),!chid){var avuid=$Support.LSDB.get("ZLD"+$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.lsid+"avuid"),cachedata=$Support.LSDB.getFromSession(avuid+"_conversation"),visitorobj={};for(var index in cachedata){var conv=cachedata[index];if(conv.visitorid==visitorid){visitorobj=conv;break}}var transdata={};transdata.question=getEscapedText(visitorobj.question),transdata.dname=visitorobj.name,transdata.mode="info",visitorobj.attender&&(transdata.attendername=visitorobj.attender,transdata.userimg=visitorobj.attender_imgkey);var transarr=[];return transarr.push(transdata),$Support.Util.populateChatUI(transarr,visitorid,chid),void avimpl.checkCallIcon()}if(transcriptcachedata&&transcriptcachedata.length&&iscacheuptodate)return $Support.Util.populateChatUI(transcriptcachedata,visitorid,chid),Message.presender=psender,void $Support.Util.setMessageClass();var url=$Support.getAjaxURL("getvisitortranscript",dext);url+="?tzoffset="+_TZCOFFSET+"&visitorid="+visitorid+lsnocachefix(!0)+"&lang="+_LANG+"&conversation=true",_CCODE&&(url+="&ccode="+_CCODE),$.get(url,"",function(content){$.trim(content)&&-1==content.indexOf("transcript.try.after.sometime")&&($.isEmptyObject(content[content.length-1])&&content.splice(content.length-1,1),content.length&&($Support.storeConversationChatTranscriptInSession(chid,content),$Support.Util.populateChatUI(content,visitorid,chid)))},"json")},storeConversationChatTranscriptInSession:function(chid,transcript){this.LSDB.storeInSession(chid+"_transcript",transcript)},isConversationUIFocussed:function(){try{return $Support.convlistcontainer.is(":visible")||$Support.convtranscontainer.is(":visible")}catch(e){}return!1},isConversationTransUIFocussed:function(){try{return $Support.convtranscontainer.is(":visible")}catch(e){}return!1},handleOnGoingchatActionsInConversation:function(opr,params){$Support.isFAQEnabled()&&($FAQ.updateMessageCount(opr),("newchat"===opr||"triggerchat"===opr)&&$Support.isFAQUIFocussed())||$Support.isConversationAllowed()&&!CallImpl.isCallWithChat&&{newchat:function(){$Support.handleNewChatInConversation()},pickupchat:function(){$Support.handlePickupChatInConversation()},wtime:function(){$Support.handleWaitingTimeUpdateInConversation(params)},newmsg:function(){$Support.handleNewMessageInConversation(params)},triggerchat:function(){$Support.handleTriggerChatInConversation(params)},typingstatus:function(){$Support.handleAgentTypingStatusInConversation(params)},missedchat:function(){$Support.handleMissedChatInConversation(params)},missedleave:function(){$Support.handleMissedLeaveInConversation(params)},endtimerupdate:function(){$Support.handleChatEndTimerUpdateInConversation(params)},endtimerclear:function(){$Support.handleChatEndTimerClearInConversation()},endchat:function(){$Support.handleChatEndInConversation(params)},leavemsg:function(){$Support.handleOfflineChatInConversation(params)}}[opr]()},handleNewChatInConversation:function(){var embedobj=$Support.EmbedObj,titlemsg=LSResource.getRealValue("conversation.pleasewait.toconnect"),isattachment=!1;if(-1!=embedobj.chatID){var recntmsgobj=$Support.getRecentMessageOfOngoingChat();titlemsg=recntmsgobj.recentmsg,isattachment=recntmsgobj.isattachment}if($Support.convongoingchatobj){if($Support.convongoingchatobj.attr("id")=="conv"+embedobj.chatID)return void $Support.convongoingchatobj.trigger("click");$Support.istriggeredchat?($Support.convongoingchatobj.attr("id","conv"+embedobj.chatID),$Support.convongoingchatobj.attr("visitorid",embedobj.visitorID),$Support.convongoingchatobj.attr("chid",embedobj.chatID)):($Support.proactive&&(titlemsg=embedobj.pmsg),$Support.convongoingchatobj.find(".siqc_eletype").show().html(count)[0].className="siqc_eletype",$Support.convongoingchatobj.attr("documentclick","fetchconvtranscript"),$Support.applyOngoingChatClass("siqc_cntbody"),$Support.convongoingchatobj=void 0,titlemsg=$Support.proactive?titlemsg:LSResource.getRealValue("conversation.pleasewait.toconnect"))}$Support.isConversationAllowed()&&!$Support.isConversationUIFocussed()&&$Support.getConversationData()&&!$Support.container.find("#showsiqconv").is("visible")&&$Support.container.find("#showsiqconv").show(),!titlemsg&&$Support.proactive&&(titlemsg=embedobj.pmsg,$Support.container.find("#showsiqchatui").hide()),titlemsg=isattachment?titlemsg:getEscapedText(titlemsg);var recentmsg=Message.getDisplayContent(titlemsg);recentmsg=Markdown.apply(recentmsg),recentmsg=Message.format(recentmsg);var attenderimgsrc="";JSON.parse(embedobj.eprops.icphoto)&&embedobj.attenderimagefkey&&(attenderimgsrc=$Support.Util.getPhotoURL()),(!$Support.convongoingchatobj||$Support.convongoingchatobj&&!$Support.istriggeredchat)&&$Support.convlistcontainer.find("#currchatconv").html($Support.convongoingchatobj=$($Temp.getchatWaitingUIinConversation())),$Support.convongoingchatobj.find("#convchatattendername").text(embedobj.attendername?embedobj.attendername:LSResource.getRealValue("conversation.awaitingtoconnect")),$Support.convongoingchatobj.find("#convchatattenderimg").attr("src",attenderimgsrc),$Support.isBotChat&&$Support.convongoingchatobj.find("#convchatattenderimg").addClass("conv_boticn"),embedobj.attender||$Support.convongoingchatobj.find(".sqico-user").addClass("convrstn-wait"),$Support.convongoingchatobj.find("#convmsg").html(recentmsg);var convmtime=$Support.intime||embedobj.chatintime;$Support.convongoingchatobj.find("#convwtime").attr("convmtime",convmtime).html(MyDate.timeDifference(convmtime));var count=$Support.getUnreadCount(),clsname="siqc_cntbody";count?(clsname+=" siqc_newchat",$Support.convongoingchatobj.find(".siqc_eletype").show().html(count)[0].className="siqc_eletype"):$Support.convongoingchatobj.find(".siqc_eletype")[0].className="siqc_eletype sqico-chat2",$Support.applyOngoingChatClass(clsname),$Support.isConversationUIFocussed()&&$Support.proactive&&($Support.isConversationTransUIFocussed()||$Support.convlistcontainer.scrollTop()>$Support.convongoingchatobj.height())&&($Support.removeConversationPopupMessage(),$Support.container.append($Temp.getPopUpMessageInconversation(embedobj.attendername,titlemsg,attenderimgsrc)))},handleTriggerChatInConversation:function(params){if(!$Support.convongoingchatobj){var embedobj=$Support.EmbedObj;$Support.convlistcontainer.find("#currchatconv").html($Support.convongoingchatobj=$($Temp.getchatWaitingUIinConversation())),$Support.convongoingchatobj.find("#convchatattendername").text(params.sendername);var attenderimg="";params.message=getEscapedText(params.message),params.attenderdetails?JSON.parse(embedobj.eprops.icphoto)&&(attenderimg=$Support.Util.getPhotoURL()):$Support.convongoingchatobj.find(".sqico-user").addClass("convrstn-wait"),$Support.convongoingchatobj.find("#convchatattenderimg").attr("src",attenderimg),$Support.convongoingchatobj.find("#convmsg").html(params.message);var convmtime=params.time||(new Date).getTime();$Support.convongoingchatobj.find("#convwtime").attr("convmtime",convmtime).html(MyDate.timeDifference(convmtime)),$Support.container.find("#showsiqchatui").hide();var count=$Support.getUnreadCount(),clsname="siqc_cntbody";count?(clsname+=" siqc_newchat",$Support.convongoingchatobj.find(".siqc_eletype").show().html(count)[0].className="siqc_eletype"):$Support.convongoingchatobj.find(".siqc_eletype")[0].className="siqc_eletype sqico-chat2",$Support.applyOngoingChatClass(clsname),$Support.isConversationUIFocussed()&&($Support.isConversationTransUIFocussed()||$Support.convlistcontainer.scrollTop()>$Support.convongoingchatobj.height())&&($Support.removeConversationPopupMessage(),$Support.container.append($Temp.getPopUpMessageInconversation(params.sendername,params.message,attenderimg)))}},handleWaitingTimeUpdateInConversation:function(params){if(-1!=$Support.EmbedObj.chatID&&$Support.convongoingchatobj){var wtime=params.wtime;$Support.applyOngoingChatClass("siqc_cntbody siqc_time"),$Support.convongoingchatobj.find(".siqc_eletype").html("").show()[0].className="siqc_eletype sqico-timer",$Support.convongoingchatobj.find("#convwtime").html(wtime)}},handleMissedChatInConversation:function(params){if($Support.convongoingchatobj){$Support.applyOngoingChatClass("siqc_cntbody siqc_chatend");var missedmsg=LSResource.getRealValue("conversation.missedmsg"),embedobj=$Support.EmbedObj;$Support.convongoingchatobj.find("#convchatattendername").text(embedobj.attendername?embedobj.attendername:"Missed Chat"),$Support.convongoingchatobj.find("#convmsg").html(missedmsg);var convmtime=$Support.intime||$Support.EmbedObj.chatintime;$Support.convongoingchatobj.find("#convwtime").attr("convmtime",convmtime).html(MyDate.timeDifference(convmtime)),$Support.convongoingchatobj.find(".siqc_eletype")[0].className="siqc_eletype",$Support.convongoingchatobj.find(".sqico-user").removeClass("convrstn-wait"),$Support.convongoingchatobj.find(".siqc_usrimg").addClass("sqico-missed"),$Support.isConversationTransUIFocussed()&&($Support.removeConversationPopupMessage(),$Support.container.append($Temp.getPopUPInfoMessageInConversation(DynamicMsg.fillValues(getUnescapedText($Support.EmbedObj.missedmessage)))))}},handleMissedLeaveInConversation:function(params){$Support.convongoingchatobj&&($Support.convongoingchatobj[0].className="siqc_cntbody",$Support.convongoingchatobj.find("#convmsg").html(getEscapedText(params.msg)))},handlePickupChatInConversation:function(istransfer){if($Support.convongoingchatobj){var embedobj=$Support.EmbedObj,attenderimgsrc="";JSON.parse(embedobj.eprops.icphoto)&&embedobj.attenderimagefkey&&(attenderimgsrc=$Support.Util.getPhotoURL()),$Support.applyOngoingChatClass("siqc_cntbody"),istransfer||$Support.convongoingchatobj.find("#convmsg").html(getEscapedText(embedobj.question)),$Support.convongoingchatobj.find("#convchatattendername").text(embedobj.attendername?embedobj.attendername:"Awaiting agent"),$Support.convongoingchatobj.find("#convchatattenderimg").attr("src",attenderimgsrc).removeClass("conv_boticn");var convmtime=$Support.intime||embedobj.chatintime;$Support.convongoingchatobj.find("#convwtime").attr("convmtime",convmtime).html(MyDate.timeDifference(convmtime)),$Support.convongoingchatobj.find(".siqc_eletype")[0].className="siqc_eletype sqico-chat2",$Support.convongoingchatobj.find(".sqico-user").removeClass("convrstn-wait")}},handleNewMessageInConversation:function(params){if($Support.convongoingchatobj){var embedobj=$Support.EmbedObj,msgval=params.filename,filecontent=params.content;msgval||(msgval=params.msg,"object"==typeof params.msg&&(msgval=params.msg.fName,filecontent=params.msg.content)),msgval=params.iscannedarticle?params.cardheader:msgval;var msg=Message.getDisplayContent(msgval);msg=Markdown.apply(msg),msg=Message.format(msg);var fileclstype=$Support.Util.getFileClassType(filecontent);msg=fileclstype?'<em class="'+fileclstype+'">'+msg+"</em>":msg;var clsname="siqc_cntbody";$Support.convongoingchatobj.find("#convmsg").html(msg);var count=$Support.getUnreadCount();if(count){if(clsname+=" siqc_newchat",$Support.convongoingchatobj.add("#conv-tab").find(".siqc_eletype").show().html(count)[0].className="siqc_eletype",$("#conv-tab").addClass("count"),$Support.isConversationUIFocussed()&&!Message.isLocalUser(params.sender)){if($Support.isConversationTransUIFocussed()||$Support.convlistcontainer.scrollTop()>$Support.convongoingchatobj.height()){$Support.removeConversationPopupMessage();var attenderimgsrc="";-1!=params.sender.indexOf($Support.EmbedObj.attender)&&JSON.parse(embedobj.eprops.icphoto)&&(attenderimgsrc=$Support.Util.getPhotoURL()),$Support.container.append($Temp.getPopUpMessageInconversation(params.dname,msg,attenderimgsrc))}if($Support.isConversationTransUIFocussed()){var showallconvdiv=$Support.container.find("#showsiqconv");0==showallconvdiv.find("#siqnoticon").length&&showallconvdiv.prepend("<em id='siqnoticon' class='siqc_prochtcls' documentclick='showchatui'></em>")}}}else $Support.convongoingchatobj.find(".siqc_eletype")[0].className="siqc_eletype sqico-chat2";$Support.applyOngoingChatClass(clsname)}},removeConversationPopupMessage:function(){$Support.container.find("#convpopupmsg").remove(),$Support.container.find("#convpopupmsg").remove()},handleAgentTypingStatusInConversation:function(params){if($Support.convongoingchatobj){$Support.EmbedObj;var typingmsg=params.msg,count=$Support.getUnreadCount(),clsname="siqc_cntbody";if(typingmsg)clsname+=" siqc_type",$Support.convongoingchatobj.find("#convmsg").html(LSResource.getRealValue("conversation.agent.typing")),$Support.convongoingchatobj.find(".siqc_usrimg").addClass("sqico-typing");else{var titlemsg=$Support.getRecentMessageOfOngoingChat().recentmsg,recentmsg=Message.getDisplayContent(titlemsg);recentmsg=Markdown.apply(recentmsg),recentmsg=Message.format(recentmsg),$Support.convongoingchatobj.find("#convmsg").html(recentmsg),$Support.convongoingchatobj.find(".siqc_usrimg").removeClass("sqico-typing")}count?(clsname+=" siqc_newchat",$Support.convongoingchatobj.find(".siqc_eletype").show().html(count)[0].className="siqc_eletype"):$Support.convongoingchatobj.find(".siqc_eletype")[0].className="siqc_eletype sqico-chat2",$Support.applyOngoingChatClass(clsname)}},handleChatEndTimerUpdateInConversation:function(params){if($Support.convongoingchatobj){var isstart=params.isstart,timer=LSResource.getRealValue("conversation.endtimer.secs",""+params.timer);$Support.applyOngoingChatClass("siqc_cntbody siqc_goend"),$Support.convongoingchatobj.find("#convwtime").html(timer).show();var endtimermsg=LSResource.getRealValue("conversation.chat.goingtoend");if($Support.convongoingchatobj.find("#convmsg").html(endtimermsg),$Support.convongoingchatobj.find(".siqc_eletype").html("").show()[0].className="siqc_eletype sqico-alert",$Support.isConversationUIFocussed()&&($Support.isConversationTransUIFocussed()||$Support.convlistcontainer.scrollTop()>$Support.convongoingchatobj.height())){var attenderimgsrc=$Support.Util.getPhotoURL();if(isstart)$Support.container.append($Temp.getPopUpAlertInconversation($Support.EmbedObj.attendername,LSResource.getRealValue("conversation.chatsess.goingtoend"),timer,attenderimgsrc));else{var popucontainer=$Support.container.find("#convpopupmsg");0!=popucontainer.length&&popucontainer.find("#alerttimer").html(timer)}if($Support.isConversationTransUIFocussed()){var showallconvdiv=$Support.container.find("#showsiqconv");showallconvdiv.find("#siqnoticon").remove(),showallconvdiv.prepend("<em id='siqnoticon' class='sqico-alert' documentclick='showchatui'></em>")}}}},handleChatEndTimerClearInConversation:function(){if($Support.convongoingchatobj){var embedobj=$Support.EmbedObj,titlemsg=$Support.getRecentMessageOfOngoingChat().recentmsg,recentmsg=Message.getDisplayContent(titlemsg);recentmsg=Markdown.apply(recentmsg),recentmsg=Message.format(recentmsg);var clsname="siqc_cntbody";$Support.convongoingchatobj.find("#convwtime").html(MyDate.timeDifference($Support.intime||embedobj.chatintime)),$Support.convongoingchatobj.find("#convmsg").html(recentmsg);var count=$Support.getUnreadCount();count?(clsname+=" siqc_newchat",$Support.convongoingchatobj.find(".siqc_eletype").show().html(count)[0].className="siqc_eletype"):$Support.convongoingchatobj.find(".siqc_eletype")[0].className="siqc_eletype sqico-chat2",$Support.container.find("#showsiqconv").find("#siqnoticon").remove(),$Support.applyOngoingChatClass(clsname),$Support.removeConversationPopupMessage()}},handleChatEndInConversation:function(params){if($Support.convongoingchatobj){var embedobj=$Support.EmbedObj,currchatconvcls=$Support.Util.isAnnonUser(params.sender)?"siqc_cntbody":"siqc_cntbody siqc_chatend";$Support.applyOngoingChatClass(currchatconvcls);var chatendedbytimermsg=LSResource.getRealValue("converation.chat.ended");$Support.convongoingchatobj.find("#convmsg").html(chatendedbytimermsg);var convmtime=$Support.intime||embedobj.chatintime;if($Support.convongoingchatobj.find("#convwtime").attr("convmtime",convmtime).html(MyDate.timeDifference(convmtime)),$Support.convongoingchatobj.find(".siqc_eletype").html("").show()[0].className="siqc_eletype",$Support.removeConversationPopupMessage(),$Support.isConversationTransUIFocussed()){var endmessage=params.msg&&params.msg.opruser&&params.msg.opruser.dname?LSResource.getRealValue("converation.agent.chat.ended","<b>"+params.msg.opruser.dname+"</b>"):LSResource.getRealValue("converation.chat.ended");$Support.container.append($Temp.getPopUPInfoMessageInConversation(endmessage))}}},handleOfflineChatInConversation:function(params){if($Support.isConversationAllowed()){var cachearr=[];cachearr.push(params);var avuid=this.LSDB.get("ZLD"+$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.lsid+"avuid");$Support.updateConversationCache(cachearr,avuid,!0);var offlineconvhtml=$Temp.getConversationHistoryHTML(params);$Support.convlistcontainer.find("#pastchatconv").prepend(offlineconvhtml),!$Support.isConversationAllowed()||$Support.isConversationUIFocussed()||$Support.container.find("#showsiqconv").is("visible")||$Support.container.find("#showsiqconv").show()}},handleChatTransferInConversationListView:function(){if($Support.convongoingchatobj){var embedobj=$Support.EmbedObj,attenderimgsrc="";JSON.parse(embedobj.eprops.icphoto)&&embedobj.attenderimagefkey&&(attenderimgsrc=$Support.Util.getPhotoURL()),$Support.convongoingchatobj.find("#convchatattenderimg").attr("src",attenderimgsrc),$Support.convongoingchatobj.find("#convchatattendername").text(embedobj.attendername)}},getRecentMessageOfOngoingChat:function(){var recentmsg=$Support.EmbedObj.question,isattachment=!1;if($Support.cachearr.length){var msgobj=$Support.cachearr[$Support.cachearr.length-1];if(msgobj.msg)if("object"!=typeof msgobj.msg)recentmsg=msgobj.iscannedarticle?msgobj.cardheader:msgobj.msg;else if("object"==typeof msgobj.msg)if(msgobj.msg.fName){recentmsg=msgobj.msg.fName;var fileclstype=$Support.Util.getFileClassType(msgobj.msg.content);recentmsg=fileclstype?'<em class="'+fileclstype+'">'+recentmsg+"</em>":recentmsg,isattachment=!0}else"cannedarticle"===msgobj.msg.mode&&(recentmsg=$FAQ.getHeaderMessage(msgobj.msg.msg))}return{recentmsg:recentmsg,isattachment:isattachment}},applyOngoingChatClass:function(clsname){$Support.convongoingchatobj&&($Support.convongoingchatobj[0].className=clsname)},cacheCurrentChat:function(){if($Support.isConversationAllowed()){var embedobj=$Support.EmbedObj,cachearr=[],cacheinfo={};cacheinfo.attender=embedobj.attendername,cacheinfo.attender_imgkey=embedobj.attenderimagefkey,cacheinfo.question=embedobj.question,cacheinfo.chid=embedobj.chatID,cacheinfo.visitorid=embedobj.visitorID,cacheinfo.endtime=(new Date).getTime(),cacheinfo.isbotattender=$Support.isBotChat;var lstmsgobj=$Support.cachearr[$Support.cachearr.length-1];lstmsgobj&&(lstmsgobj.iscannedarticle&&(lstmsgobj.msg=lstmsgobj.cardheader),cacheinfo.lastmsg=JSON.stringify(lstmsgobj)),cachearr.push(cacheinfo);var avuid=this.LSDB.get("ZLD"+$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.lsid+"avuid");$Support.updateConversationCache(cachearr,avuid,!0)}},handleNewsLetter:function(){$Support.Util.isPreview()&&$CWPreview.handleNewsLetter()},getEmbedSize:function(){return $Support.getParent().$ZSIQWidget.getEmbedSize()},getEmbedSizeClass:function(){return $Support.isMobileWidth()?"":" zsiq_size"+$Support.getEmbedSize()},removeWidget:function(){var chatwindowdiv=$Support.getParent().$ZSIQChatWindow.getChatWindowDiv(),floatwindowdiv=$Support.getParent().$ZSIQWidgetUI.getWidgetDiv();chatwindowdiv&&chatwindowdiv.remove(),floatwindowdiv&&floatwindowdiv.remove()},handleBotTransferAccept:function(){$Support.removeCookie("ZLD"+$Support.EmbedObj.livelsid+"WAITING"),$UI.removeCWaitHandler(),clearTimeout($Support.waitTimer),$UI.removeTransferDiv(),delete $Support.waitingtime,delete $Support.isBotChat,delete $Support.botchatprops,$Support.handlePickupChatInConversation(!0);var $header=$TH.getHeader();JSON.parse($Support.EmbedObj.eprops.icphoto)?$header.find(".cmplogo").attr("data-chttype","agent"):$header.find(".cmplogo").removeAttr("data-chttype"),$UI.populateUserAction()},isChatExist:function(){return-1!=$Support.EmbedObj.chatID},isOnlineChat:function(){return $Support.EmbedObj.status},isMacOS:function(){return!!navigator.platform.match(/Mac/i)},openClassicUI:function(){0<$Support.convlistcontainer.find("#pastchatconv").find(".siqc_cntbody").length&&$Support.container.find("#showsiqchatui").click()},isFAQEnabled:function(){var faqobj=$Support.EmbedObj.faqaccess;return!!Licence.verify("faqallowed")&&!!faqobj.length&&1==$Support.EmbedObj.faqaccess[0]},getConversationData:function(){var avuid=$Support.LSDB.get("ZLD"+$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.lsid+"avuid");return $Support.LSDB.getFromSession(avuid+"_conversation")},isFAQUIFocussed:function(){try{return"faqview"===$Support.container.attr("cwview")}catch(e){}return!1},handleBotBroadcast:function(data){var msg=data.msg;this.LSDB.set("ZSIQ"+$Support.EmbedObj.chatID+"BROATCAST",msg.text),this.waitingtime=this.EmbedObj.embedwaitingtime,this.handleWaitingDisplay(),$UI.populateVisitorQuestion()},handleBotTrigger:function(data){$Support.getParent().$ZSIQChatWindow.openChatWindow(),$Support.EmbedObj.department=data.msg.department?data.msg.department:$Support.EmbedObj.department,$Support.handleBotMessage(data)},handleBotMessage:function(data){var msg=data.msg;msg.reply&&setTimeout(function(){Message.formatAndDisplay({sender:msg.sender,msg:msg.reply,time:msg.time,dname:msg.dname})},1e3),msg.followup&&setTimeout(function(){Message.formatAndDisplay({sender:msg.sender,msg:msg.followup,time:msg.time,dname:msg.dname})},1e3),msg.question&&setTimeout(function(){Message.formatAndDisplay({sender:msg.sender,msg:msg.question,time:msg.time,dname:msg.dname})},1e3);var optionsobj=msg.options;optionsobj&&(msg.options=optionsobj.list,setTimeout(function(){Message.display($Support.Util.getConversationSelect(msg),!0)},1e3)),$Support.ongoingcontext=msg.context_id,data.timer},getBroadcastText:function(){return this.LSDB.get("ZSIQ"+$Support.EmbedObj.chatID+"BROATCAST")},removeBroadCast:function(){return this.LSDB.remove("ZSIQ"+$Support.EmbedObj.chatID+"BROATCAST")},handleBotTimerCB:function(){var dataval;dataval=lsnocachefix("json"),$Support.handleAjax("joinproactive",dataval,function(response){})}};$UI={init:function(forcedeptdrpdwn){this.populateUI(forcedeptdrpdwn)},populateUI:function(forcedeptdrpdwn){this.setHeader(),this.setBody(null,forcedeptdrpdwn),this.setFooter()},setContainer:function(){$TH=$ThemeHandler[$Support.theme],$TH.updateContainer(),$Support.Util.updateParentFontFamily()},setHeader:function(){$TH.updateHeader()},setInnerHeader:function(data){$TH.updateInnerHeader(data)},setBody:function(iscontaineronly,forcedeptdrpdwn){$TH.updateBody(iscontaineronly,forcedeptdrpdwn),(forcedeptdrpdwn||!iscontaineronly&&-1==$Support.EmbedObj.department)&&this.populateDropDown()},setInnerBody:function(iscontaineronly){$TH.updateInnerBody()},setFooter:function(){$TH.updateFooter()},populateDropDown:function(){$TH.updateDeptDropdown()},showBanner:function(msg,autohide,callbk,hidetime,isclickable,clickableobj){$TH.showBanner(msg,autohide,callbk,hidetime,isclickable,clickableobj)},hideBanner:function(callback){$TH.hideBanner(callback)},showTimerBanner:function(msg){$TH.showTimerBanner()},populateSendMail:function(sendmailico){$Support.Util.isPreview()||$TH.populateSendMail(sendmailico)},populateSendMailConfirm:function(mailid,chid){$TH.populateSendMailConfirm(mailid,chid)},populateSmiley:function(sendmailico){$TH.populateSmiley(sendmailico)},showUserEditUI:function(isoptional,ismanualedit){$TH.showUserEditUI(isoptional,ismanualedit)},hideUserEditUI:function(){$TH.hideUserEditUI()},showCaptcha:function(digest){$TH.showCaptcha(digest)},hideCaptcha:function(){$TH.hideCaptcha()},showWaitingUI:function(hidewaitingbanner){$TH.showWaitingUI(hidewaitingbanner)},updateWaitingTime:function(){var waitdiv=this.wait_div,wtime=MyDate.formatMS(1e3*$Support.waitingtime);waitdiv&&waitdiv.html(wtime);var params={};params.wtime=wtime,$Support.handleOnGoingchatActionsInConversation("wtime",params)},showMissedVisitorBanner:function(istransfermissed){$TH.handleMissedStatus(istransfermissed)},populateVisitorQuestion:function(data){$TH.populateVisitorQuestion(data)},getMsgHTML:function(data){return $TH.getMsgHTML(data)},getInfoMsgHTML:function(data,classname){return $TH.getInfoMsgHTML(data,classname)},populateUserAction:function(){$TH.populateUserAction()},setChatStatus:function(msg){msg=$.trim(msg),JSON.parse($Support.EmbedObj.pprops.showtyping)&&$("#typgstatus").html(msg)},updateOfflineUI:function(forcedeptdrpdwn,isdeptchange){$TH.handleOfflineStatus(forcedeptdrpdwn,isdeptchange)},updateOnlineUI:function(forcedeptdrpdwn,isdeptchange){$Support.Util.handleOnlineStatus(forcedeptdrpdwn,isdeptchange)},showFeedback:function(){$TH.populateFeedbackHTML()},showFdbkResponse:function(){$TH.showFdbkResponse()},hideUtilityDiv:function(divobj,isrecalculate,isshowchtend){$TH.hideUtilityDiv(divobj,isrecalculate,isshowchtend)},getInfoMsgContent:function(msgobj,convvisitorid,convchid){return $TH.getInfoMsgContent(msgobj,convvisitorid,convchid)},notifyUrlShare:function(msg){$TH.notifyShareURL(msg)},showDragDropUI:function(){$TH.showDragDropUI()},hideDragDrop:function(){$TH.hideDragDrop()},getPreviewHTML:function(){return $TH.getPreviewHTML()},getCustomHTML:function(customobj){return $TH.getCustomHTML(customobj)},showUploadProgress:function(data){return $TH.showUploadProgress(data)},hideUploadProgress:function(msgid){return $TH.hideUploadProgress(msgid)},updateCloseIcon:function(){$TH.updateCloseIcon()},updateParentFontFamily:function(){return $TH.updateParentFontFamily()},populateSmileyIcon:function(){$TH.populateSmileyIcon()},removeSmileyIcon:function(){$TH.removeSmileyIcon()},updateQuesArea:function(){$TH.updateQuesArea()},updateChatEndMsg:function(){$TH.updateChatEndMsg()},updateVisitorName:function(data){$TH.updateVisitorName(data)},getBusinessHrInfo:function(){return $TH.getBusinessHrInfo()},getSoundHTML:function(isreplace){return $TH.getSoundHTML(isreplace)},setSoundConfig:function(){$TH.setSoundConfig()},addGroupIcon:function(){},removeGroupIcon:function(){},populateCWaitHandler:function(){$TH.populateCWaitHandler()},removeCWaitHandler:function(){$TH.removeCWaitHandler()},showWaitingDialog:function(){$TH.showWaitingDialog()},hideMaskDiv:function(){$TH.hideMaskDiv()},displayInfo:function(msg){$TH.displayInfo(msg)},setDepartment:function(deptid){$("#dropcontent").find("[val='"+deptid+"']").trigger("click")},showCloseAlert:function(){-1!=$Support.EmbedObj.chatID&&1==confirm(LSResource.getRealValue("ne.reload.alert"))&&retrun},focusComposer:function(){window.outerWidth<555||$("#msgarea").focus()},appendTransferDiv:function(){if(!(0<$(".zsiq_transferdiv").length)){var chatdiv=$Support.chatdiv||$("#msgdiv"),hidestyle=parseInt(chatdiv.find(".siq-agntmsg").length)<1?'style="display:none"':"",transferhtml="";transferhtml=$Support.areUsersAvailable()?'<div class="zsiq_transferdiv fnt13" '+hidestyle+' id="agenttransfer">'+LSResource.getRealValue("ne.agent.transfer")+'<span documentclick="transferchat" class="bot_opt">'+LSResource.getRealValue("common.yes")+'</span><span documentclick="hidetransferoption" class="bot_opt">'+LSResource.getRealValue("common.no")+"</span></div>":'<div class="zsiq_transferdiv fnt13" ><span documentclick="transfermissed" purpose="offline" class="bot_opt">'+LSResource.getRealValue("ne.chatwindow.dropmessage")+"</span></div>",chatdiv.append(transferhtml)}},appendConsentDiv:function(ismissed){var transferhtml,onclickaction=ismissed?"$Support.getMissedUserConsent":"$Support.getUserConsent",chatdiv=$Support.chatdiv||$("#msgdiv");transferhtml='<div class="zsiq_transferdiv fnt13" id="creditcardconsent">'+LSResource.getRealValue("ne.agent.cardmask")+'<span onclick="'+onclickaction+'(1)" class="bot_opt">'+LSResource.getRealValue("common.yes")+'</span><span onclick="'+onclickaction+'(0)" class="bot_opt">'+LSResource.getRealValue("common.no")+"</span></div>",0==$(" #creditcardconsent ").length&&chatdiv.append(transferhtml)},appendChatConsentDiv:function(skipregister,isproactive,policyurl){var chatdiv=$Support.chatdiv||$("msgdiv"),policyurltxt=LSResource.getRealValue("common.gdpr.agent.chatconsent2");policyurl&&(policyurltxt="<a class='siq-lnmor' target='_blank' href='"+(policyurl=-1==policyurl.indexOf("http")?"http://"+policyurl:policyurl)+"'>"+policyurltxt+"</a>");var chatconsenttxt=LSResource.getRealValue("common.gdpr.agent.chatconsent1")+" "+policyurltxt+" "+LSResource.getRealValue("common.gdpr.agent.chatconsent3"),acceptbtntxt=LSResource.getRealValue("common.gdpr.agent.accept"),declinebtntxt=LSResource.getRealValue("common.gdpr.agent.decline"),apivalues=$Support.getParent().$ZSIQUtil.getAPIValues();if(apivalues.textbannerobj&&apivalues.textbannerobj.online){var onlinetxtobj=apivalues.textbannerobj.online;if(chatconsenttxt=onlinetxtobj.description&&0!=onlinetxtobj.description.trim().length?onlinetxtobj.description:chatconsenttxt,acceptbtntxt=onlinetxtobj.acceptbutton&&0!=onlinetxtobj.acceptbutton.trim().length?onlinetxtobj.acceptbutton:acceptbtntxt,declinebtntxt=onlinetxtobj.declinebutton&&0!=onlinetxtobj.declinebutton.trim().length?onlinetxtobj.declinebutton:declinebtntxt,onlinetxtobj.policytextandlink){var learnmoreobj=onlinetxtobj.policytextandlink,learnmore_text=learnmoreobj.text&&0!=learnmoreobj.text.trim().length?learnmoreobj.text:"",learnmore_link=learnmoreobj.link&&0!=learnmoreobj.link.trim().length&&$Support.getParent().$ZSIQUtil.isValidURL(learnmoreobj.link)?learnmoreobj.link:"";chatconsenttxt=$Support.getParent().$ZSIQUtil.hyperLinksSubString(chatconsenttxt,learnmore_text,learnmore_link)}}chatconsenthtml='<div class="zsiq_transferdiv fnt13 chatconsent" id="chatconsentdiv">'+chatconsenttxt+'<div class="mT10"><span onclick="$Support.getChatUserConsent(1, '+skipregister+", "+isproactive+')" class="bot_opt gltr-srno">'+acceptbtntxt+'</span><span onclick="$Support.getChatUserConsent(0, null, '+isproactive+')" class="bot_opt gltr-srno gltr-no">'+declinebtntxt+"</span></div></div>",0==$(" #chatconsentdiv ").length&&chatdiv.append(chatconsenthtml)},removeTransferDiv:function(){var transdiv=$(".zsiq_transferdiv");transdiv.fadeOut("slow",function(){transdiv.remove()})},removeConsentDiv:function(){var transdiv=$("#creditcardconsent");transdiv.fadeOut("slow",function(){transdiv.remove()})},removeChatConsentDiv:function(){var chatconsentdiv=$("#chatconsentdiv");chatconsentdiv.fadeOut("slow",function(){chatconsentdiv.remove()})},removeOfflineConsentDiv:function(){var chatconsentdiv=$("#offlineconsent");chatconsentdiv.fadeOut("slow",function(){chatconsentdiv.remove(),$Support.Util.setTextareaHeight()})},showTransferWaiting:function(){$(".zsiq_transferdiv").remove();var time=$Support.waitingtime||$Support.EmbedObj.embedwaitingtime,html='<div class="zsiq_transferdiv fnt13" id="transferwaiting" botstatus="timer">'+LSResource.getRealValue("ne.agent.transferwaiting")+'<span id="wait_div">'+MyDate.formatMS(1e3*time)+"</span></div>";($Support.chatdiv||$("#msgdiv")).append(html),$UI.wait_div=$("#wait_div"),$Support.botchatprops.status="waiting",$Support.setCookie()},showTransferMissed:function(){$(".zsiq_transferdiv").remove();var html='<div class="zsiq_transferdiv zsiq_transmissed fnt13" id="transfermissed">'+LSResource.getRealValue("ne.agent.transfermissed")+'<div><span documentclick="removetransfer" class="bot_opt"> '+LSResource.getRealValue("ne.chatwindow.continuewithbot")+'</span><span documentclick="transfermissed" class="bot_opt">'+LSResource.getRealValue("settings.embed.offline")+"</span></div></div>";($Support.chatdiv||$("#msgdiv")).append(html);var sobj=document.getElementById("msgmaindiv");sobj.scrollHeight-sobj.scrollTop==sobj.clientHeight||sobj.scrollHeight<sobj.clientHeight||Message.scroll(sobj)},getBotImageHTML:function(ishide){return'<em id="boticondiv" class="sqico-boticn"'+(ishide?"style=display:none":"")+'><em class="sqico-botwel1"></em><em class="sqico-botwel2"></em><em class="sqico-botwel3"></em></em>'},getTranslateBannerHTML:function(dname){return $TH.getTranslateBannerHTML(dname)}};var $NE=!1;$EmbedManger={isNewEmbed:$NE=!("undefined"==typeof $Support),setChatID:function(chid){return $NE?$Support.EmbedObj.chatID=chid:Support.setChatID(chid)},getChatID:function(){return $NE?$Support.EmbedObj.chatID:Support.getChatID()},setPrevCHID:function(chid){return $NE?$Support.EmbedObj.lchid=chid:Support.setPrevCHID(chid)},getPrevCHID:function(){return $NE?$Support.EmbedObj.lchid:Support.getPrevCHID()},getWaitingCookie:function(){return $NE?$Support.getWaitingCookie():SupportUI.getCookieValue("ZLD"+Support.getLiveSupportID()+"WAITING")},getVisitorID:function(){return $NE?$Support.EmbedObj.visitorID:Support.getVisitorID()},getLiveSupportID:function(){return $NE?$Support.EmbedObj.livelsid:Support.getLiveSupportID()},getAttenderID:function(){return $NE?$Support.EmbedObj.attender:Support.getAttender()},showChatUI:function(data,loadforcefully){if($NE&&data){var sessiondata=$Support.LSDB.getFromSession($Support.EmbedObj.chatID+"_transcript");if($.isEmptyObject(data[data.length-1])&&data.splice(data.length-1,1),loadforcefully)return void $Support.Util.showChatUI(data);if($Support.LSDB.isSessionStorageAvail()&&sessiondata&&sessiondata.length==data.length){var len=sessiondata.length;if(sessiondata[len-1].msg==data[len-1].msg)return}$Support.Util.showChatUI(data)}else Support.showChatUI()},isautotrigger:function(){return $NE?$Support.istrigmsg:Support.isautotrigger},getAddinfo:function(){return $NE?$Support.EmbedObj.addinfo:Support.addinfo},getDeptlist:function(){return $NE?$Support.EmbedObj.deptlist:Support.deptlist},updateChatCookie:function(){$NE?$Support.updateChatCookie():Support.updateChatCookie()},handleChatEnded:function(msgObj){if(!$NE)return Support.handleChatEnded(msgObj);$Support.handleChatEnded(msgObj)},setVisitorName:function(name){$NE?$Support.EmbedObj.setVisitorName(name):Support.setVisitorName(name)},getVisitorName:function(){return $NE?$Support.EmbedObj.visitorname:Support.getVisitorName()},setVisitorEmail:function(email){$NE?$Support.EmbedObj.setVisitorEmail(email):Support.setVisitorEmail(email)},setVisitorPhone:function(phone){$NE?$Support.EmbedObj.setVisitorPhone(phone):Support.setVisitorPhone(phone)},handleCallbacks:function(type,data){if(!$NE)return Support.handleCallbacks(type,data);$Support.Util.handleCallbacks(type,data)},handlePickUp:function(dataobj){$NE?$Support.handlePickUp(dataobj):Support.handlePickUp(dataobj)},handleDesktopSharing:function(msgobj){return $NE?$Support.handleDesktopSharing(msgobj):Support.handleDesktopSharing(msgobj)},handleEndSession:function(dataobj){return $NE?(EmbedSound.play("endtimer",dataobj.timer),void $Support.handleEndSession(dataobj.timer,!0)):Support.handleEndSession(dataobj)},handleJoinProActive:function(obj){$NE?$Support.handleJoinProActive(obj):Support.handleJoinProActive(obj)},reJoin:function(){$NE?$Support.reJoin():Support.reJoin()},addVisitor:function(){$NE?$Support.addVisitor():Support.addVisitor()},quit:function(){if($NE)return $Support.quitChat();Support.quit()},setCookie:function(){$NE?$Support.setCookie():Support.setCookie()},removeChatCookie:function(){$NE?$Support.removeChatCookie():Support.removeChatCookie()},getType:function(){return $NE?$Support.type:Support.type},getuvid:function(){return $NE?$Support.EmbedObj.uvid:Support.uvid},getvwmsid:function(){return $NE?$Support.EmbedObj.vwmsid:Support.vwmsid},getWaitTimer:function(){return $NE?$Support.waitTimer:Support.waitTimer},setCallbackargs:function(value){$NE?$Support.callbackargs=value:Support.callbackargs=value},setQuitStatus:function(value){$NE?$Support.callquitstatus=value:Support.callquitstatus=value},getQuitStatus:function(){return $NE?$Support.callquitstatus:Support.callquitstatus},setIPBlockStatus:function(value){$NE?$Support.isipblocked=value:Support.isipblocked=value},getVisitID:function(){return $NE?$Support.EmbedObj.VISITID:Support.visitorinfo.VISITID},isComposerFocused:function(){return $NE?$Support.iscomposerfocus:Support.iscomposerfocus},iswindowfocused:function(){return $NE?$Support.iswindowfocused:Support.iswindowfocused},isSoundOff:function(){return $NE?"-1"==$Support.EmbedObj.soundval:!SupportUI.sound},updateChatCache:function(cacheobj,override){return $NE?$Support.updateChatCache(cacheobj,override):""},getChatStatus:function(){return $NE?$Support.ischatdisabled:SupportUI.ischatdisabled},getMessageLength:function(){return $NE?$.trim(" "+$("#msgarea").val()).length:$.trim(" "+$("#lstxteditor").val()).length},handleApiData:function(){return $NE?$Support.handleApiData():SupportUI.handleApiData()},isCrossDomainReq:function(){return!0}},$EmbedManger.UI={isNewEmbed:$EmbedManger.isNewEmbed,displayInfo:function(msg,state){$NE?$UI.showBanner(msg):SupportUI.displayInfo(msg,state)},hideInfo:function(){$NE?$UI.hideBanner():SupportUI.hideInfo()},showProcess:function(msg){$NE||SupportUI.showProcess(msg)},showAgentStatus:function(){$NE||SupportUI.showAgentStatus()},resizequestion:function(){if(!$NE)return SupportUI.resizequestion},postMessage:function(operation,value){$NE?$Support.postMessage(operation,value):SupportUI.postMessage(operation,value)},embeddiv:function(){return $NE?$Support.container:SupportUI.embeddiv},showVisitorInfo:function(){$NE||SupportUI.showVisitorInfo()},resizeWindow:function(){$NE||SupportUI.resizeWindow()},getCaptchaValue:function(){return $NE?$Support.Util.getCaptchaValue():SupportUI.getCaptchaValue()},showCaptcha:function(digest){$NE?$UI.showCaptcha(digest):SupportUI.showCaptcha(digest)},hideCaptcha:function(){$NE?$UI.hideCaptcha():SupportUI.hideCaptcha()},showFeedback:function(data,chid){$NE?$UI.showFeedback(data,chid):SupportUI.showFeedback(data,chid)},handleEndSupport:function(msgObj){$NE||SupportUI.handleEndSupport(msgObj)},hideVisitorInfo:function(){$NE||SupportUI.hideVisitorInfo()},clearProgress:function(){$NE||SupportUI.clearProgress()},handlePushMessage:function(obj){$NE?$Support.Util.handlePushMessage(obj):SupportUI.handlePushMessage(obj.msg)},getDragDropHtml:function(){if(!$NE)return SupportUI.getDragDropHtml()},setChatStatus:function(msg){$NE?$UI.setChatStatus(msg):SupportUI.setChatStatus(msg)},formatAndDisplayInfo:function(chid,msgobj,chattype){if($NE){var msg=$UI.getInfoMsgContent(msgobj);Message.display(msg,!0)}else Message.formatAndDisplayInfo(chid,msgobj,chattype)},getPrevHTML:function(){return $NE?$UI.getPreviewHTML():PasteImage.getEmbPrevHTML()},showPasteUI:function(){if($NE)return $Support.Util.showPasteUI();PasteImage.showEmbedUI()},hidePasteUI:function(){if($NE)return $Support.Util.hidePasteUI();PasteImage.hideUI()},updateVisitorName:function(data){$NE&&$UI.updateVisitorName(data)},showGroupIcon:function(){},hideGroupIcon:function(){},getResendIcon:function(){return $NE?'<em id="resendicon" class="sqico-resend" documentclick="resendmsg" title="'+LSResource.getRealValue("embed.msg.resend")+'" ></em>':'<em id="resendicon" class="sqico-resend spritebg" onclick="LSMessanger.resendMessages('+RESEND_MANUAL+')" title="'+LSResource.getRealValue("embed.msg.resend")+'" ></em>'}};$Support.Util={jsdownloadtimer:-1,ispostloaddone:!1,handleTextClear:function(curr,e){curr.parent().find('input[type="text"]').val("")},minimizeEmbed:function(){$Support.getParent().$ZSIQChatWindow.minimizeChatWindow()},maximizeEmbed:function(){this.postMessage("newEmaximize",{width:"371",height:"460"})},closeEmbed:function(){$Support.getParent().$ZSIQChatWindow.closeChatWindow(),$Support.enableTextarea(),$Support.contentdiv=null;var embedobj=$Support.EmbedObj;$Support.callquitstatus=!1,embedobj.setVisitorID(-1),embedobj.setChatID(-1),embedobj.setVisitID(-1),_JOINED=!1,Message.presender="",$Support.init($Support.getParent().$ZSIQWidget.getEmbedObject()),$Support.getParent().$ZSIQChatWindow.constructIframe(!0)},setThemeInFloat:function(theme){this.postMessage("settheme",theme)},triggerAdditionalFileDownload:function(){var supportutilobj=$Support.Util;supportutilobj.ispostloaddone||(clearTimeout(supportutilobj.jsdownloadtimer),supportutilobj.downloadAdditionalFiles())},downloadAdditionalFiles:function(){if(!$Support.Util.ispostloaddone){var embedobj=$Support.getParent().$ZSIQWidget.getEmbedObject(),commondata=$Support.getParent().$ZSIQChat.getWidgetData().commondata,servurl=commondata.schema+"://"+embedobj.embedserverurl,headArr=document.querySelectorAll("head");if(0==headArr.length&&((headArr=[])[0]=document.createElement("head"),document.insertBefore(document.body,headArr[0])),embedobj.ucomp){var oscript1=document.createElement("script");oscript1.src=commondata.jsstaticserver+"/js/embedpostload.js",headArr[0].appendChild(oscript1),(css=document.createElement("link")).type="text/css",css.rel="stylesheet",css.href=$Support.getParent().$ZSIQWidget.getWidgetObject().cssstaticserver+"/styles/embedpostload.css",headArr[0].appendChild(css)}else{for(var jsfileslist=["/js/embed/new/chatwindow/jquery.ztooltip.js","/js/cw/lsdragdrop.js","/js/cw/pasteimage.js","/js/cw/validator.js","/js/cw/clickoutside.js"],i=0;i<jsfileslist.length;i++){var scriptelem=document.createElement("script");scriptelem.src=servurl+jsfileslist[i],headArr[0].appendChild(scriptelem)}var cssfilelist=["/styles/cw/smiley.css","/styles/cw/ui.ztooltip.css"];for(i=0;i<cssfilelist.length;i++){var css;(css=document.createElement("link")).type="text/css",css.rel="stylesheet",css.href=servurl+cssfilelist[i],headArr[0].appendChild(css)}}$Support.Util.ispostloaddone=!0}},showMoreAction:function(curr,e){$Clickoutside.bindclick($Support.Util.hideMoreActionDiv,"mraction","moreaction");var $userico=curr.parents(".usractions"),ul=$userico.find(".mraction");ul.addClass("shwact"),ul.find('li[purpose="sound"]').replaceWith($UI.getSoundHTML()),$userico.removeClass("showmore")},hideMoreActionDiv:function(){$("ul.mraction").removeClass("shwact").parents(".usractions").addClass("showmore")},getKeyCode:function(e){return(e=null==e?window.event:e).keyCode||e.which},handleBannerSlide:function(content){var bnr=$Support.contentdiv.find("#info_banr");bnr.removeClass("timer");var oldHeight=bnr.outerHeight();if(bnr.html(content),bnr.is(":animated"))bnr.css("height","auto");else{var newHeight=bnr.outerHeight();bnr.css({height:oldHeight+"px"}).animate({height:newHeight},"5000",function(){bnr.height("auto")})}},showInfoBanner:function(content,isautohide,isanim,callbk,hidetime){clearTimeout(this.bnrtimer);var bnrdiv=$Support.contentdiv.find("#info_banr");$Support.container.hasClass("outerwin")?bnrdiv.addClass("relate"):bnrdiv.removeClass("relate"),$Support.EmbedObj.bushrstatus?bnrdiv.addClass("bsnshrs"):bnrdiv.removeClass("bsnshrs"),content?this.handleBannerSlide(content):isanim&&bnrdiv.hide().slideDown(500,function(){}),isautohide&&(hidetime=hidetime||1500,this.bnrtimer=setTimeout(function(){$UI.hideBanner(callbk)},hidetime))},sendMail:function(e){if(e&&13==this.getKeyCode(e))return $Support.sendMail()},validateFields:function(container){if(!$Support.Util.isPreview()){var curr,isvalid=!0,count=0;return container.find("[data-validate]").each(function(){$(this).validateInput()||(isvalid=!1,curr=$(this),count++)}),this.showErrorInfo(count,curr),isvalid}},showErrorInfo:function(count,curr){if(!(count<1||CallImpl.isCallWithChat)){var errmsg=LSResource.getRealValue("ne.errorinfo.all");if(1===count){var info=curr.attr("info");errmsg=/^number|email|url|percentage|decimal|name|email|phone$/.exec(info)?LSResource.getRealValue("ne.errorinfo."+info):errmsg}$UI.showBanner(errmsg,!0),$("#info_banr").removeClass("relate"),this.setTextareaHeight()}},showChatUI:function(data){$Support.contentdiv||($UI.setInnerBody(),$UI.setFooter(),$Support.Util.handleResize());try{this.populateChatUI(data)}catch(e){}},populateChatUI:function(data,convvisitorid,convchid){if(data&&!CallImpl.isCallWithChat){delete $Support.waitTimer;for(var datalength=(data=CommonUtil.parseToJSON(data)).length,i=0,content="",info="",presender="";i<datalength;i++){var cdata=data[i];if(i==datalength-1&&!getObjectSize(cdata))break;var sender=cdata.sender,filobj={},dname=cdata.dname,msg=cdata.msg,time=cdata.time||cdata.intime||"",mode=cdata.mode;if(cdata.formattedmsg&&(msg=cdata.formattedmsg),"ACCEPT_TRANSFER"==(mode=mode||("object"==typeof msg?msg.mode:mode))?(msg.opruser.dname=data[0].attendername,msg.opruser.attendername=data[0].attendername):"BOT_INFO_MESSAGE"==mode&&(msg=cdata),0!==i||(sender=Message.presender=sender||$Support.EmbedObj.vwmsid,dname=cdata.visitorname||cdata.dname,convvisitorid||$Support.isConversationUIFocussed()||$UI.setInnerHeader(cdata),msg=cdata.question||cdata.ques,convvisitorid||($Support.waitingtime||-1===$Support.EmbedObj.visitorID||$Support.istriggeredchat||$UI.populateUserAction(),$UI.populateSmileyIcon()),!isUndefined(msg)&&""!=msg)){if("BOT_INFO_MESSAGE"!=mode&&(info=$UI.getInfoMsgContent(msg,convvisitorid,convchid)),mode)if("TRIGGER"==mode)dname=msg.dname,msg=msg.msg;else if("att"===mode)filobj.file=msg;else if("cannedarticle"===mode)msg=$FAQ.getCustomCard(msg.msg),filobj.iscannedarticle=!0;else if("BOT_INFO_MESSAGE"==mode)(msg=msg.msg).reply&&(msg.msg=msg.reply,content+=Message.getMessageBlock(msg)),msg.followup&&(msg.msg=msg.followup,content+=Message.getMessageBlock(msg)),msg.question&&(msg.msg=msg.question,content+=Message.getMessageBlock(msg));else if(msg.mode&&!info)continue;time=time?-1!=time.indexOf(":")?time:MyDate.getHoursandMin(time,!0,"bclient"):"",content+=info||$UI.getMsgHTML($.extend(filobj,{dname:dname,msg:msg,time:time,sender:sender,previoussender:presender==sender,convvisitorid:convvisitorid,convchid:convchid,iscannedarticle:cdata.iscannedarticle})),presender=Message.presender=sender}}var chatdiv=convvisitorid?$Support.convtranscontainer:$Support.chatdiv||$("#msgmaindiv");if($Support.isBotChat&&0!=$("#msgmaindiv [data-dname]").length||(content=Message.format(content),chatdiv.html(Message.getDisplayContent(content))),$UI.showWaitingDialog(),$Support.isBotChat){var chatstatus=$Support.botchatprops.status;"connected"!=chatstatus||$Support.botchatprops.hidetransfer?"waiting"==chatstatus&&$Support.getWaitingCookie()?$UI.showTransferWaiting():"missed"==chatstatus&&$UI.showTransferMissed():$UI.appendTransferDiv()}chatdiv&&chatdiv.length&&!convchid&&$(chatdiv).scrollTop(chatdiv[0].scrollHeight-chatdiv[0].offsetHeight);var msgmaindiv=$("#msgmaindiv");msgmaindiv[0]&&msgmaindiv.scrollTop(msgmaindiv[0].scrollHeight);var supportrep_count=Object.keys(SUPPORT_REPS).length;msgmaindiv.length&&$Support.isChatExist()&&supportrep_count&&!$Support.proactive&&!avimpl.hideCallIcon&&!convchid?$("#audiocall").show():$("#audiocall").hide(),convvisitorid||($UI.showWaitingDialog(),$Support.setCookie(),delete $Support.waitTimer),this.setMessageClass()}},getPhotoURL:function(){var embedobj=$Support.EmbedObj;return _SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+embedobj.attenderimagefkey+"/photo.ls?nocache=1"},handleKeyDown:function(txtarea,keycode,e){try{if(13==keycode&&e.shiftKey)return!0}catch(e){}0==txtarea.parent().find(".smileli").length||-1==[39,37,38,40,13].indexOf(keycode)?13==keycode&&(e.preventDefault?e.preventDefault():e.returnValue=!1):e.preventDefault?e.preventDefault():e.returnValue=!1},handlePredictMsg:function(txtarea){if(-1!=$Support.EmbedObj.visitorID&&"sendmessage"===txtarea.attr("dockeyup")){var txtval=$.trim(txtarea.val()),that=this;Licence.verify("creditmask")&&(txtval=Message.checkMaskOccurance(txtval,!1)),""==txtval||that.enablepmsg||(that.enablepmsg=!0,that.prdcttimer=setTimeout(function(){LSMessanger.sendPredictMessage(txtval),that.enablepmsg=!1},3e3))}},handleRating:function(curr){$Support.Util.isPreview()||($(".sqico-star").removeClass("sel"),curr.addClass("sel"),$("#msgarea").focus(),this.feedbacksent||$Support.setRating(curr))},handleFeedback:function(txtarea,keycode,e){if($Support.toggleSendButton(txtarea),13===keycode){if(!this.validateFields(txtarea.parent()))return e.preventDefault(),!1;$Support.sendFeedback(txtarea)}},submitFile:function(formObj,event){try{var fileobj=$(formObj)[0];if(0===fileobj.files.length)return}catch(e){}this.hideMoreActionDiv();try{this.handleDropEvent($Support.EmbedObj.chatID,event,fileobj.files)}catch(ex){}return!1},handleSendMail:function(inputfield,keycode,e){var parnt=inputfield.parent();1<=inputfield.val().length?parnt.addClass("icoclr"):parnt.removeClass("icoclr"),13===keycode&&parnt.find('[documentclick="triggermail"]').trigger("click")},postMessage:function(operation,value){if(null!=value){var object={type:$Support.type,operation:operation,value:value};sendPostMessage(object)}},loadPostMessage:function(){window.addEventListener?addEventListener("message",$Support.Util.handlePostMessage):attachEvent("onmessage",$Support.Util.handlePostMessage)},handlePostMessage:function(event){var data;try{data=JSON.parse(event.data)}catch(e){return}var operation=data.operation,value=data.value;$Support.Util;"apivalues"==operation?$Support.handleApiData(value):"broadcast"==operation?$Support.handleApiData(value,!0):"sound"==operation&&$UI.setSoundConfig()},handleTriggers:function(type,data){var that=$Support.Util;if(type!==TRIGGER_SEND_MESSAGE||$Support.waitTimer)type===TRIGGER_PLAY_TUNE&&EmbedSound.play(data.tune);else{if(-1!==$Support.EmbedObj.chatID)return;EmbedSound.play("smessage"),that.handleChatTrigger(data),that.handleCallbacks("visitor.chattrigger",data)}},handleTrackChat:function(value){-1===$Support.EmbedObj.chatID&&($Support.Util.handleCallbacks("visitor.chattrigger",{}),$Support.Util.proactiveChat(value))},handleUTSConnect:function(value){var chid=$Support.EmbedObj.chatID,visitorid=$Support.EmbedObj.visitorID;(-1===chid||value.isnewconnection)&&-1!==chid&&-1!==visitorid&&value.isnewconnection&&$Support.rejoinVisitorInUTS()},proactiveChat:function(data){var eobj=$Support.EmbedObj;$Support.istrigmsg||-1!==eobj.chatID||(delete $Support.istrigmsg,eobj.setVisitorID(-1),eobj.uvid=data.uvid,eobj.setAttender(data.attender),eobj.attenderemail=data.attenderemail,eobj.setChatID(data.chid),eobj.setVisitorEmail(data.email),eobj.setVisitorName(data.name),eobj.setVisitorPhone(data.phone),eobj.setSelectedDept(data.department),eobj.attenderimagefkey=data.image_fkey,eobj.attenderuseragent=data.attender_useragent,eobj.setvwmsID(data.vwmsid),eobj.pmsg=data.msg,eobj.attenderaboutme=data.aboutme,eobj.attendername=eobj.triggername=getUnescapedText(data.attendername),eobj.chatintime=(new Date).getTime()-1e3,$Support.proactive=!0,LSMessanger.setNickName(data.name),$EmbedManger.setQuitStatus(!1),LSMessanger.register($Support.Util.productCode,eobj.vwmsid),$Support.setCookie(),$Support.handleOnGoingchatActionsInConversation("newchat"))},handleChatTrigger:function(data){var embedobj=$Support.EmbedObj,apivalues=$Support.getParent().$ZSIQUtil.getAPIValues();if(-1===embedobj.chatID&&-1===embedobj.visitorID&&(apivalues.triggermsg||!$Support.istrigmsg)){$Support.istrigmsg=!0;var attobj=data.attenderdetails;embedobj.pmsg=data.message,embedobj.triggername=data.sendername,attobj&&(embedobj.attenderimagefkey=attobj.imagefkey,embedobj.setAttender(attobj.attender)),delete embedobj.question,delete $Support.waitingtime,$Support.setTriggerCookie(data),this.populateTriggerUI(data),$Support.handleOnGoingchatActionsInConversation("triggerchat",data)}},handleBotTriggers:function(data){var embedobj=$Support.EmbedObj,apivalues=$Support.getParent().$ZSIQUtil.getAPIValues();if(-1===embedobj.chatID&&-1===embedobj.visitorID&&(apivalues.triggermsg||!$Support.istrigmsg)){$Support.isbottrigmsg=!0,$Support.isBotChat=!0,data=data.data,$Support.EmbedObj.attender=data.attender,delete $Support.waitingtime;var headerobj={attendername:data.dname,image_fkey:CommonUtil.getBotImageURL(),aboutme:data.aboutme};this.populateTriggerWindow(headerobj)}},populateTriggerWindow:function(headerobj){var isfaqfocused=$Support.isFAQUIFocussed();$Support.isConversationUIFocussed()||isfaqfocused||$UI.setInnerHeader(headerobj),$Support.contentdiv||$UI.setInnerBody(),$UI.showWaitingUI(),$UI.setFooter(),isfaqfocused&&($Support.incrementUnreadCount(),$("#conv-tab").removeClass("sel"),$("#faqtab").addClass("sel"))},populateTriggerUI:function(data){var attobj=data.attenderdetails||{},headerobj={attendername:data.sendername||data.attendername,image_fkey:attobj.imagefkey||data.attenderimagefkey,aboutme:attobj.attenderaboutme};this.populateTriggerWindow(headerobj)},toggleAudio:function(curr){var value=curr.hasClass("sqico-mute")?-1:1;if($Support.LSDB.set($Support.EmbedObj.chatID+"_sound",value),$UI.setSoundConfig(),this.handleUnmute(),curr.parent()[0]&&"UL"!==curr.parent()[0].nodeName?shtml=$UI.getSoundHTML(!0):shtml=$UI.getSoundHTML(),curr.replaceWith(shtml),-1==value)EmbedSound.stop();else if($Support.endtimer){var timer=0;try{var time_txt=$("#endtimer").text();timer=parseInt(time_txt.split(" ")[0])}catch(e){}0<timer&&EmbedSound.play("endtimer",timer)}},handleUnmute:function(){var soundkey=$Support.EmbedObj.soundval;if(isUndefined(soundkey)||-1!=soundkey)$(".sqico-more").prev("span.sqico-unmute").remove();else{var shtml=$UI.getSoundHTML(!0);$(".sqico-more").before(shtml)}},hideMaskAnim:function(){$Support.maskdiv.addClass("hidemaskanim")},setTextareaHeight:function(){if(!window.parent.$ZSIQWidget.getWidgetObject().isshowcallbubble){var cntntdiv=$Support.contentdiv;if(cntntdiv&&$Support.container.hasClass("outerwin")){var txtheight=0;$Support.getComposer().removeAttr("style"),cntntdiv.children('div:visible:not("#info_banr")').each(function(){txtheight+=$(this).outerHeight(!0)});var contheight=cntntdiv.height();contheight<txtheight?cntntdiv.find(".msgbox").addClass("posrel"):(txtheight=contheight-txtheight,$("#msgarea").height(function(index,height){return height+txtheight}))}}},removeDiv:function(divobj){setTimeout(function(){divobj.remove()},2e3)},handleCaptcha:function(){var $S=$Support;this.LSDB.remove("ZLD"+$S.EmbedObj.livelsid+"WTIME"),delete $S.latency,clearTimeout($S.waitTimer),$S.getCaptcha=this.getCaptchaValue(),$S.handleWaitingDisplay(),$S.addVisitor()},getCaptchaValue:function(){var captchadiv=$Support.contentdiv.find(".captcha");if(captchadiv.hasClass("hidemaskanim"))return{};var inputobj=captchadiv.find('input[type="text"]'),obj={};return obj[inputobj.attr("purpose")]=inputobj.val(),obj},handleDropEvent:function(chid,event,files){if(-1!=chid)try{event.preventDefault(),LSDragDrop.onDropEvent($Support.EmbedObj.chatID,event,files)}catch(e){}},showPasteUI:function(){var html=PasteImage.getHTML();$("#pstimg-main").remove(),$Support.container.addClass("imgcmt").find("header").after(html),PasteImage.updateDetailes($Support.container)},handlePushMessage:function(obj){var msg=obj.msg;-1==msg.indexOf("http")&&(obj.msg=msg="http://"+msg);try{if(null!=$Support.pushwinobj.window)return void($Support.pushwinobj.location.href=msg);$UI.notifyUrlShare(obj)}catch(e){$UI.notifyUrlShare(obj)}},openPushPage:function(url){$UI.hideBanner(),$Support.pushwinobj=window.open(url)},handleTextareaEnter:function(txtarea,keycode,e,callback,isleavemsg){var chatconsentdiv=$("#chatconsent");if(!$Support.Util.getChatConsentStatus()||1!=chatconsentdiv.length||0!=chatconsentdiv.is(":checked"))return $Support.toggleSendButton(txtarea),!(13!=keycode||!e.shiftKey)||(!!isleavemsg||void((13===keycode||isUndefined(keycode))&&this.handleStartChat(callback,e)));$Support.Util.removeSendClickAction()},handleCallFdbEnter:function(txtarea,keycode,e,callback,isleavemsg){if(13==keycode&&e.shiftKey)return!0;""!==$.trim(txtarea.val())&&(13===keycode||isUndefined(keycode))&&$Support.sendFeedback()},handleStartChat:function(callback,e){if(!$Support.Util.isPreview()){var cntainer=$Support.container;if($Support.checkCustomFields(),$UI.hideBanner(),cntainer.find(".hidemaskanim").remove(),cntainer.hasClass("outerwin")&&!this.validateFields(cntainer))return e&&e.preventDefault(),!1;$Support.updateInputValues(),"function"==typeof callback&&callback()}},hidePasteUI:function(){$("#pstimg-main").addClass("hidemaskanim"),$("section.imgcmt").removeClass("imgcmt")},bindUtilEvents:function(){bindDragDropEvents(),handlePaste()},handleDrpdwnEvent:function(curr,keycode,e){if(!$Support.Util.isPreview()){var list=curr.find("ul"),cursel=curr.find("li.atsel"),firstlist=list.find("li:first-child");if(13==keycode){if(cursel.length)return cursel.trigger("click"),void e.preventDefault();curr.find("a").trigger("click"),e.preventDefault()}cursel=list.find("li.atsel").removeClass("atsel");if(40==keycode){if(list.is(":hidden"))return curr.find("a").trigger("click"),void e.preventDefault();var nextli=cursel.next();cursel=nextli.length?nextli:firstlist,e.preventDefault()}else if(38==keycode){var prevli=cursel.prev();cursel=prevli.length?prevli:list.find("li:last-child"),e.preventDefault()}cursel.addClass("atsel"),cursel.length&&list.stop(!0,!0).animate({scrollTop:cursel[0].offsetTop}),e.stopImmediatePropagation()}},fillApiValues:function(){var eobj=$Support.EmbedObj,addinfo=eobj.addinfo;getUnescapedText(addinfo.question),getUnescapedText(eobj.visitorname),eobj.visitorphone,eobj.visitoremail;DynamicMsg.updateValues(addinfo),$Support.container.find("[info]").each(function(){var curr=$(this),infoval=addinfo[curr.attr("info")];isUndefined(infoval)||curr.val(infoval)}),$Support.toggleSendButton();var forcefloat=addinfo?addinfo.forcefloatingwindow:null;($Support.Util.isSIQMobilePreview()||(forcefloat||$Support.Util.isHandHeldDevice())&&$Support.isFloat()&&window.outerWidth<555)&&($("body").removeClass("siq_mprv").addClass("siq_mprv"),$Support.contentdiv.parent().removeClass("siq_mscreen").addClass("siq_mscreen"),this.setTextareaHeight())},handleCustomHTML:function(isuseredit){var currobj=$Support.customobj;if(currobj){this.checkAndRemoveCustomField([]);try{$.each(currobj,function(i,currobj){currobj.index=i;var name=currobj.name;if(/^_default./.test(name)){var defaultfieldname=name.replace("_default.",""),defaultelement=$Support.container.find("[purpose=visitor"+defaultfieldname+"]"),isrequired="true"==currobj.required||1==currobj.required;if(/^department$/.test(defaultfieldname)&&(defaultelement=$Support.container.find("[purpose=department]")).text(getEscapedText(currobj.hint)),/^question$/.test(defaultfieldname))(defaultelement=$Support.container.find("[purpose=question]")).attr("placeholder",getEscapedText(currobj.hint));else if(currobj.hint){if(defaultelement.length<1)return"";if(isrequired)var reqattr=defaultelement.attr("data-validate").replace("optional","required");else reqattr=defaultelement.attr("data-validate").replace("required","optional");defaultelement.attr("data-validate",reqattr),defaultelement.attr("placeholder",getEscapedText(currobj.hint))}return""}var chtml=$($UI.getCustomHTML(currobj));if(!chtml.length)return!0;var insertid=currobj.before||currobj.after||"";if(insertid?(insertelem=$Support.container.find('[custom = "'+insertid+'"]'),insertelem[currobj.before?"before":"after"](chtml)):isuseredit?chtml.insertBefore($("#usereditactionbtn")):chtml.insertBefore("div.msgbox"),"selectbox"==currobj.type&&$("#sqico-cdrpdwn"+i).dropdown({options:currobj.options,purpose:"customdrpdwn",defaultval:currobj.hint||currobj.name||"Custom"}),currobj.errorinfo){var eobj=$Support.EmbedObj;name=currobj.name;eobj.errorinfo[name]=currobj.errorinfo}}),this.handleCustomVisibility(),this.setTextareaHeight()}catch(e){}}},handleCustomVisibility:function(){var eobj=$Support.EmbedObj,cusfield=$Support.contentdiv.find('[purpose="custom"]'),that=this;$.each(cusfield,function(key,value){var obj=$(value),visibility="undefined"!=obj.attr("visibility")?obj.attr("visibility"):"both";obj.hide();var subtitle=obj.prev(".subtitle").hide();"both"==visibility||eobj.status&&"online"==visibility||!eobj.status&&"offline"==visibility?(obj.show(),subtitle.show()):(obj.remove(),subtitle.remove())}),cusfield.find("input[type=radio],input[type=checkbox]").off().on("change",function(){var name=$(this).attr("name");that.handleInputChange(name,cusfield.find("input[name='"+name+"']:checked").map(function(){return this.id}).get())})},removeSendClickAction:function(){$("#sqico-send").removeAttr("documentclick")},getFileURL:function(file,callback){var reader=new FileReader;reader.onload=function(event){callback(event.target.result)},reader.readAsDataURL(file)},handleDeptChange:function(curr,onload){var isdeptchoose=!onload,status=curr.find("span").attr("status"),eobj=$Support.EmbedObj;if(eobj.department=curr.attr("val"),"1"!=status)$UI.updateOfflineUI(null,isdeptchoose);else{if(!this.prevstatus||"1"==this.prevstatus)return;$Support.isFAQEnabled()&&$("#msgarea").parent().find("#sqico-send").remove(),$UI.updateOnlineUI(null,isdeptchoose),eobj.question&&($Support.composer=$("#msgarea"),$Support.composer.text(eobj.question),$Support.toggleSendButton()),this.setTextareaHeight()}this.prevstatus=status},handleResize:function(){if($Support.Util.calculateContentHeight(),$Support.Util.setTextareaHeight(),$Support.Util.calculateTextareaHeight(),!$Support.isParentIframe()||"embed"===$Support.type){var cntr=$Support.container,chd_img=$("body").children('#cmpylogo:not(".nologo")'),img_height=0!=chd_img.length?chd_img.outerHeight():0,header_height=$Support.container.find("header").outerHeight()+img_height;cntr.css("height",$(window).height()-img_height);var contentdiv=$Support.contentdiv;contentdiv.css("height",cntr.find("footer").offset().top-header_height-8),$Support.chatdiv&&$Support.chatdiv.css("height",contentdiv.outerHeight()-(contentdiv.find(".usrinpt").outerHeight()+contentdiv.find(".chtend").outerHeight(!0))),$Support.Util.setTextareaHeight()}},isInValidVisitorName:function(dname){return!(dname=dname||$Support.EmbedObj.visitorname)||dname&&(0===dname.lastIndexOf("Visitor ",0)||0===dname.lastIndexOf("Guest",0))},handleInputChange:function(name,val){var callbackobj={val:val,name:name};this.handleCallbacks("custom.field",callbackobj)},handleCallbacks:function(type,data){if(type&&data){var apidata={};apidata[type]=data,$Support.getParent().$ZSIQWidget.handleCallBacks(apidata)}},handleGroupIcon:function(data){var agents=data.participants;agents&&1<getObjectSize(agents)&&$UI.addGroupIcon()},IsMandatoryFieldsAvailable:function(){var eobj=$Support.EmbedObj,eprops=eobj.eprops,customobj=$Support.customobj,defaultfieldsstatus=$Support.Util.isInValidVisitorName()&&JSON.parse(eprops.isname[0])&&JSON.parse(eprops.isname[1].ismandatory)||!eobj.visitoremail&&JSON.parse(eprops.isemail[0])&&JSON.parse(eprops.isemail[1].ismandatory)||!eobj.visitorphone&&JSON.parse(eprops.isphoneno[0])&&JSON.parse(eprops.isphoneno[1].ismandatory),customfieldstatus=!1;try{for(var i=0;i<customobj.length;i++){var field=customobj[i];if(""+field.required=="true"&&(!field.visibility||"offline"!=field.visibility))if(/^_default./.test(field.name)){var defaultfieldname=field.name.replace("_default.","");if(/^department$/.test(defaultfieldname))continue;if("name"==defaultfieldname&&JSON.parse(eprops.isname[0])&&$Support.Util.isInValidVisitorName()){customfieldstatus=!0;break}if("email"==defaultfieldname&&JSON.parse(eprops.isemail[0])&&!eobj.visitoremail){customfieldstatus=!0;break}if("phone"==defaultfieldname&&JSON.parse(eprops.isphoneno[0])&&!eobj.visitorphone){customfieldstatus=!0;break}}else if(!eobj.cinfo||!eobj.cinfo[field.name]){customfieldstatus=!0;break}}}catch(e){}return defaultfieldsstatus||customfieldstatus},checkAndRemoveCustomField:function(obj){var embeddiv=$Support.contentdiv;if($.isEmptyObject(obj))embeddiv.find("div[custombx]").remove();else for(var i=0;i<obj.length;i++)embeddiv.find("[customid='"+obj[i]+"']").remove()},isApiWaitHandler:function(obj){return isPostMessageSupported()&&$Support.isscript&&$Support.isapiwaitinghandler},setBrowserValues:function(){var eparam=$Support.EmbedObj.eparams,cpage=eparam.cpage||eparam.referrer;Browser.setReferer(eparam.referrer),Browser.setCurrentPage(cpage),Browser.setPageTitle(eparam.pagetitle)},handleDeptApiChange:function(dept,sortdepts){if(null!=dept&&-1!=dept)if($.isArray(dept)){$("#sqico-drpdwn").find("li").each(function(){var obj=$(this);-1==$.inArray(obj.attr("uniname"),dept)&&$(this).hide()});var deptlist=$("#sqico-drpdwn").find("li");deptlist.sort(function(a,b){return sortdepts.indexOf($(b).attr("uniname"))<sortdepts.indexOf($(a).attr("uniname"))?1:-1}),$("#sqico-drpdwn").find("ul").empty().append(deptlist)}else"online.department"===dept&&$Support.EmbedObj.status&&$("#sqico-drpdwn").find("li").each(function(){var obj=$(this);$(obj).children("span").attr("status")===$Support.DEPT_OFFLINESTATUES&&$(this).hide()})},isCampaignEnabled:function(){try{var enabled_integid,integinfo=$Support.EmbedObj.integprops.integinfo;if(Licence.isFreePlan()||!integinfo)return!1;for(var integid in integinfo){enabled_integid=$Support.enabledCampaignID=integid;break}if(enabled_integid&&"0"==integinfo[enabled_integid].status)return!1;var clist=integinfo[enabled_integid].listname;return clist&&""!==clist}catch(e){return!1}},hideFeedback:function(curr){$Support.Util.isPreview()||($UI.hideMaskDiv(),$Support.isfeedbacksent=!0,$Support.Util.handleFeedbackSubmit(),$("#sqico-send").parent().remove())},displayInfo:function(msg){$UI.displayInfo(msg)},hideInfo:function(){$UI.hideBanner()},showOfflineBanner:function(){var embedobj=$Support.EmbedObj;if(!$Support.proactive&&-1===embedobj.chatID&&!(embedobj.status&&this.isOnline(embedobj.department)||$Support.getCookieValue("ZLD"+embedobj.livelsid+"OFFLINEBANNER"))){$UI.showBanner($Support.getOfflineMessage(),!0,null,3e3);setTimeout(function(){$Support.LSDB.set("ZLD"+embedobj.livelsid+"OFFLINEBANNER",!0,31e4)})}},showOnlineBanner:function(){var embedobj=$Support.EmbedObj;if(!$Support.proactive&&-1===embedobj.chatID&&((embedobj.status||this.isOnline(embedobj.department))&&!$Support.getCookieValue("ZLD"+embedobj.livelsid+"ONLINEBANNER"))){$UI.showBanner(LSResource.getRealValue("ne.onlinemsg"),!0,null,3e3);setTimeout(function(){$Support.LSDB.set("ZLD"+embedobj.livelsid+"ONLINEBANNER",!0,31e4)})}},isOnline:function(deptid){if(""+deptid=="-1")return!0;for(var deptlist=$Support.EmbedObj.deptlist,i=0;i<deptlist.length;i++){var dept=deptlist[i];if(dept.ID==deptid)return""+dept.STATUS=="true"}},updateParentFontFamily:function(){var fontfamily=$Support.getParent().$ZSIQUtil.getWebFontFamily();$Support.font=fontfamily,$("html, body").css("font-family",fontfamily)},isSIQMobilePreview:function(){return $Support.Util.isPreview()&&"mobile"==parent._WIDGETPREV_MODE},isPreview:function(){return $Support.getParent().$ZSIQChat.isPreview()},isHandHeldDevice:function(){return!!$Support.Util.isSIQMobilePreview()||!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB10|IEMobile|Opera Mini/i.test(navigator.userAgent)},handleShowConversation:function(isuserclick,forcehide){var currongoingchid="";$Support.Util.updateViewAttribute("msgarea"),0<$Support.convlistcontainer.find("#pastchatconv").find(".siqc_cntbody").length?$Support.Util.showConversationListUI():(1==$Support.convlistcontainer.find("#currchatconv").find(".siqc_cntbody").length&&(currongoingchid=$($Support.convlistcontainer.find("#currchatconv").find(".siqc_cntbody")[0]).attr("chid"),$Support.Util.showConversationListUI()),$Support.PopulateConversationList(function(convlist,isprepend){if(convlist.length){var convhishtml="";if(convlist.forEach(function(conv){currongoingchid!=conv.chid&&(conv.question=getEscapedText(conv.question),convhishtml+=$Temp.getConversationHistoryHTML(conv))}),isprepend?$Support.convlistcontainer.find("#pastchatconv").prepend($(convhishtml)):$Support.convlistcontainer.find("#pastchatconv").append(convhishtml),forcehide||!isuserclick&&-1!=$Support.EmbedObj.chatID){var showallconvdiv=$Support.container.find("#showsiqconv");showallconvdiv.find("#siqnoticon").hide(),showallconvdiv.show()}else $Support.Util.showConversationListUI();$Support.Util.calculateContentHeight()}}))},showMessageAreaUI:function(eventtarget,question){($Support.convlistcontainer.hide(),$Support.convtranscontainer.hide(),$Support.container.find("#showsiqchatui").hide(),"showsiqchatui"==eventtarget&&0==$Support.contentdiv.find("[custom=question]").length)&&($Support.checkAndShowUI(),delete(eobj=$Support.EmbedObj).VISITID,delete eobj.attender,delete eobj.attenderemail,delete eobj.attenderimagefkey,delete eobj.attendername,delete eobj.chatintime,delete eobj.isaudiocall,$Support.callquitstatus=void 0,$Support.Util.showMessageAreaUI());var eobj,visitorid=(eobj=$Support.EmbedObj).visitorID,currcookie=$Support.getCookieValue("ZLD"+eobj.livelsid),ckabtme=currcookie&&currcookie["aboutme_"+visitorid]||eobj.attenderaboutme,ckatname=currcookie&&currcookie["attname_"+visitorid]||eobj.attendername;!ckatname&&$Support.istrigmsg&&(ckatname=$Support.EmbedObj.triggername),$Support.Util.updateViewAttribute("msgarea");var attname=getEscapedText(ckatname)||(eobj.status?LSResource.getRealValue("ne.chatwithus"):LSResource.getRealValue("ne.offlinemessage")),$body=$("body"),$header=$body.find('[prop="header"]');$body.find("#attname").text(attname),$body.find("#attabtme").text(ckabtme?CommonUtil.decodeHTML(ckabtme):""),$body.find("#siqconvchaticon").remove();var apivalues=$Support.getParent().$ZSIQUtil.getAPIValues(),clogo=JSON.parse(eobj.eprops.iclogo)?eobj.clogo:"";apivalues.clogo&&(clogo=apivalues.clogo);var user_logo=JSON.parse(eobj.eprops.icphoto)&&eobj.attenderimagefkey?$Support.Util.getPhotoURL():"";clogo=ckatname?user_logo:clogo,$header.find(".cmplogo").removeAttr("style"),$body.find("#complogo").attr("src",clogo),$Support.isBotChat?$header.find(".cmplogo").attr("data-chttype","bot"):JSON.parse(eobj.eprops.icphoto)?$header.find(".cmplogo").attr("data-chttype","agent"):$header.find(".cmplogo").removeAttr("data-chttype");var $clogo=$header.find('[prop="clogo"]'),classname=ckatname?"sqico-user":"sqico-chat";$clogo.removeClass("sqico-chat sqico-user wincustom_bg").addClass(classname),clogo?$header.removeClass("nologo"):($header.addClass("nologo"),$clogo.addClass("wincustom_bg")),$header.removeClass("siq-usr").removeClass("conv_headview"),eobj.attendername&&$header.addClass("conv_headview");var showallconvdiv=$Support.container.find("#showsiqconv");showallconvdiv.find("#siqnoticon").hide(),$Support.getConversationData()&&showallconvdiv.show(),$Support.contentdiv.show(),$Support.container.find("footer").show(),$Support.removeConversationPopupMessage(),$Support.applyOngoingChatClass("siqc_cntbody");var count=$Support.getUnreadCount(),msgmaindiv=$Support.contentdiv.find("#msgmaindiv");if(count){$Support.removeUnreadCookie(),$Support.getParent().$ZSIQWidgetUI.removeUnreadCount();var unreadnot=showallconvdiv.find(".siqc_prochtcls");0!=unreadnot.length&&unreadnot.remove(),msgmaindiv.length&&Message.scroll(msgmaindiv[0]),$Support.getComposer().focus()}var supportrep_count=Object.keys(SUPPORT_REPS).length;msgmaindiv.length&&$Support.isChatExist()&&supportrep_count&&!$Support.proactive&&!avimpl.hideCallIcon&&$("#audiocall").show(),$Support.convongoingchatobj&&($Support.convongoingchatobj.find(".siqc_eletype").html("")[0].className=-1!=eobj.chatID||$Support.istrigmsg?"siqc_eletype sqico-chat2":"siqc_eletype"),question&&$("#msgarea").val(question),$Support.isFAQEnabled()&&($("#conv-tab").addClass("sel"),$("#faqtab").removeClass("sel")),$Support.Util.calculateContentHeight(),$Support.Util.setTextareaHeight()},showConversationListUI:function(){var curchat=$Support.convlistcontainer.find("#convwtime");0!=curchat.length&&curchat.html(MyDate.timeDifference(curchat.attr("convmtime"))),$Support.convlistcontainer.find("#pastchatconv").find("[convmtime]").each(function(){var currobj=$(this),convmtime=currobj.attr("convmtime");convmtime&&currobj.html(MyDate.timeDifference(convmtime))}),$("#audiocall").hide(),0<$Support.contentdiv.find("#edituserdetails").length&&($Support.contentdiv.find("#edituserdetails").remove(),$Support.enableTextarea($Support.getComposer())),$Support.convtranscontainer.hide(),$Support.isFAQEnabled()||$Support.container.find("footer").hide();var showallconvdiv=$Support.container.find("#showsiqconv");showallconvdiv.find("#siqnoticon").hide(),showallconvdiv.hide(),$Support.Util.updateViewAttribute("convlist");var $body=$("body");$body.find("#attname").text(LSResource.getRealValue("converation.withus")),$body.find("#attabtme").text(""),$body.find("#complogo").attr("src","");var $header=$body.find('[prop="header"]');$header.find(".cmplogo").removeAttr("style"),$header.addClass("nologo"),$header.find(".cmplogo").attr("data-chttype","conv"),$header.removeClass("siq-usr").removeClass("conv_headview"),$header.find('[prop="clogo"]').removeClass("sqico-user wincustom_bg").addClass("sqico-chat wincustom_bg "),$Support.convlistcontainer.show(),this.showSiqChatUI()},showConversationTranscriptUI:function(visitorid){$("#audiocall").hide(),$Support.convlistcontainer.hide(),$Support.isFAQEnabled()||$Support.container.find("footer").hide();var isbotattender,avuid=$Support.LSDB.get("ZLD"+$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.lsid+"avuid"),cachedata=$Support.LSDB.getFromSession(avuid+"_conversation"),attendername="",designation="",imgsrc="";for(var index in cachedata)if(cachedata.hasOwnProperty(index)){var conv=cachedata[index];if(conv.visitorid!=visitorid)continue;conv.chid||conv.attender?conv.attender?(attendername=conv.attender,imgsrc=$Support.EmbedObj.eprops.icphoto?_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+conv.attender_imgkey+"/photo.ls?nocache=1":""):attendername=LSResource.getRealValue("conversation.missedchat"):attendername=LSResource.getRealValue("conversation.offlinechat"),conv.designation&&(designation=conv.designation),isbotattender=conv.isbotattender}$Support.Util.updateViewAttribute("convchat");var $body=$("body");$body.find("#attname").text(attendername),$body.find("#attabtme").text(designation),$body.find("#siqconvchaticon").remove(),$body.find("#complogo").attr("src",imgsrc);var $header=$body.find('[prop="header"]');$header.removeClass("nologo").addClass("conv_headview"),$header.find(".cmplogo").removeAttr("style");var $clogo=$header.find('[prop="clogo"]'),classname=attendername?"sqico-user":"sqico-chat";$clogo.removeClass("sqico-chat sqico-user wincustom_bg").addClass(classname),isbotattender?$header.find(".cmplogo").attr("data-chttype","bot"):$header.find(".cmplogo").attr("data-chttype","agent"),imgsrc||($header.addClass("siq-usr").addClass("nologo"),$clogo.addClass("wincustom_bg")),$Support.convtranscontainer.show(),this.showSiqChatUI();var showallconvdiv=$Support.container.find("#showsiqconv"),count=$Support.getUnreadCount(),siqnoticon=showallconvdiv.find("#siqnoticon");count&&0==siqnoticon.length&&showallconvdiv.prepend("<em id='siqnoticon' class='siqc_prochtcls' documentclick='showchatui'></em>"),showallconvdiv.find("#siqnoticon").show(),showallconvdiv.show()},showSiqChatUI:function(){var eobj=$Support.EmbedObj,check_feedback=$Support.isfeedback&&$Support.isfeedbacksent,check_rating=$Support.israting&&$Support.isratingsent,check_disabled=!$Support.isfeedback&&!$Support.israting;$Support.contentdiv.hide(),$Support.isFAQEnabled()||$Support.container.find("footer").hide(),-1!=eobj.chatID||!(check_feedback||check_rating||check_disabled||-1==$Support.EmbedObj.lchid)||$Support.proactive||$Support.istrigmsg||$Support.container.find("#showsiqchatui").show(),$Support.removeConversationPopupMessage(),$Support.Util.calculateContentHeight()},isAnnonUser:function(nname){try{if(-1!=nname.indexOf("$"))return!0}catch(e){}return!1},getFileClassType:function(contenttype){var fileclstype="";return contenttype?fileclstype=-1!=contenttype.indexOf("image")?"sqico-camera":-1!=contenttype.indexOf("audio")?"sqico-audio":-1!=contenttype.indexOf("video")?"sqico-video":"sqico-file-min":fileclstype},hexToRGBA:function(hex,opacity){return hex+=4==hex.length?hex.slice(1,4):"","rgba("+parseInt(hex.slice(1,3),16)+", "+parseInt(hex.slice(3,5),16)+", "+parseInt(hex.slice(5,7),16)+", "+(opacity||1)+")"},handleCompanyLogo:function(){var $complogo=$("#complogo");$complogo.on("load",function(){$complogo.parent().removeClass("sqico-clogo")}),$complogo.on("error",function(){""!=$complogo.attr("src")&&$complogo.attr("src","").parent().addClass("sqico-clogo")})},lastMessageTemplate:function(){if($Support.rating){var reating=$Support.rating,reating_html=reating?'<div class="lstmsg_strs" id="feedback_res" documentclick="showChatFeedback"><span class="sqico-star" data-prop="rating">'+reating+'</span><div class="rating"><span class="sqico-star siq-rating-icon" documentclick="rating"></span><span class="sqico-star siq-rating-icon" documentclick="rating"></span><span class="sqico-star siq-rating-icon" documentclick="rating"></span><span class="sqico-star siq-rating-icon" documentclick="rating"></span><span class="sqico-star siq-rating-icon" documentclick="rating"></span></div></div>':"";return'<div class="agntmsg siq-agntmsg fd_lastmsg" data-field="message"><div purpose="name" class="siq-user-name"></div><div class="msgbx"><span class="siq-user-message">'+LSResource.getRealValue("ne.rating.message")+"<br>"+LSResource.getRealValue("ne.rating.fbmessage")+"</span>"+reating_html+"</div></div>"}},showChatFeedback:function($curr){$curr.addClass("sel")},handleFeedbackSubmit:function(){var $feedback_res=$("#feedback_res");if(0==$feedback_res.length){var $message_area=$Support.contentdiv.find("#msgdiv");$message_area.append(this.lastMessageTemplate()),this.setMessageClass();var $fb_message=$message_area.find(".fd_lastmsg");$fb_message.hasClass("single_msg")&&$fb_message.find('[purpose="name"]').text($Support.EmbedObj.attendername),Message.scroll($("#msgmaindiv")[0]);var $rating=$("#feedback_res").find(".rating");$rating.find(".sel").removeClass("sel"),$rating.find("span:nth-child("+(6-$Support.rating)+")").addClass("sel")}else $feedback_res.removeClass("sel").find('[data-prop="rating"]').text($Support.rating)},setMessageClass:function(isongoing){$Support.container.find('[data-field="message"]').each(function(){var $this=$(this);$this.removeClass("single_msg lst_msg");var $before_ele=$this.prev(),$next_ele=$this.next();!$next_ele.length&&!$before_ele.length||!$next_ele.length&&$this.hasClass("agntmsg")&&$before_ele.hasClass("vismsg")||!$next_ele.length&&$this.hasClass("vismsg")&&$before_ele.hasClass("agntmsg")||$this.hasClass("agntmsg")&&$next_ele.hasClass("vismsg")&&$before_ele.hasClass("vismsg")||$this.hasClass("vismsg")&&$next_ele.hasClass("agntmsg")&&($before_ele.hasClass("agntmsg")||!$before_ele.length)?$this.addClass("single_msg"):(!$next_ele.length||$this.hasClass("agntmsg")&&$next_ele.hasClass("vismsg")||$this.hasClass("vismsg")&&$next_ele.hasClass("agntmsg"))&&$this.addClass("lst_msg")})},getTextColor:function(hex){return 186<.299*parseInt(hex.slice(1,3),16)+.587*parseInt(hex.slice(3,5),16)+.114*parseInt(hex.slice(5,7),16)?"#444":"#fff"},calculateTextareaHeight:function(){if(!$Support.container.hasClass("outerwin")){var $container=$Support.container,$textarea=$container.find(".msgarea");$textarea.removeAttr("style");var $msg_div=$container.find(".content"),scroll_height=$textarea[0].scrollHeight+2,style=140<scroll_height?{height:"140px",overflow:"auto"}:{height:scroll_height+"px",overflow:"hidden"};$textarea.css(style);var gltr_cont=$("#consentbannerdiv").length?$("#consentbannerdiv").height()+10:0,trns_height=$msg_div.height()-$msg_div.find(".txtarewrap").height();$msg_div.find(".chtcont").css({height:trns_height-gltr_cont+"px"}),$container.find(".dragmask").css({height:trns_height+"px"})}},calculateContentHeight:function(){var $container=$Support.container,border_height=2*parseInt($container.css("border-left-width")),height=$container.outerHeight()-($container.find("header").outerHeight()+$container.find("footer").outerHeight()+border_height);$container.find(".siq_content").css({height:height})},getImagePreviewHTML:function(preview_obj){var user_photo=preview_obj.user_photo||"https://img.zohostatic.com/salesiq/Jul_19_2018_1_https/images/user/user_160-160.png";return'<div class="zsiq_prv_main zsiq_imgprv" id="zsiqimagepreview" zsiqclose="true" onclick="$ZSIQChatWindow.closeImagePreview(event)"><img src="'+preview_obj.url+'" zprv-prop="image" zsiqclose="true" /><div><img src="'+user_photo+'" zprv-prop="userimage"/><div class="zsiq_prv_cmtmain"><p zprv-prop="userneme">'+getEncodedText(preview_obj.user)+'</p><div zprv-prop="comment">'+getEncodedText(preview_obj.comment)+'</div></div><a href="'+preview_obj.durl+'" zprv-prop="download"><em class="sqico-download"></em></a></div><em class="sqico-close" zsiqclose="true"></em></div>'},showImagePreview:function($curr){var $parent=$curr.parents('[data-field="message"]'),is_visitor=$parent.hasClass("vismsg"),img_utl=$parent.find("img").attr("src");if(img_utl){var comment=$parent.find("code").text(),download_url=$parent.find(".fdload").attr("href"),user_photo=is_visitor?"":$Support.container.find("header img").attr("src"),preview_obj={url:img_utl,comment:comment,durl:download_url,user:$parent.attr("data-dname"),user_photo:user_photo},previewhtml=this.getImagePreviewHTML(preview_obj);$(window.parent.document).find("body").append(previewhtml)}},handleUpdateBTN:function(inprogress){var $update_btn=$("#continue_btn"),isupdate="true"==$update_btn.attr("data_isupdate"),btn_text=isupdate?"ne.update":"common.continue";inprogress&&(btn_text=isupdate?"common.updating":"common.continuing"),$update_btn.text(LSResource.getRealValue(btn_text))},handleAccordian:function(callback){var allPanels=$('[data-type="accordian-item"]').hide();$('[data-type="accordian-header"]').click(function(){var curr=$(this),visibleelem=allPanels.filter(":visible"),nextitem=curr.prev();if($('[data-type="accordian-header"]').find(".sqico-uarrow").removeClass("sqico-uarrow"),visibleelem.animate({height:"toggle",opacity:"toggle"},"500"),visibleelem[0]!=nextitem[0])return"function"==typeof callback&&callback(curr),curr.find(".sqico-darrow").addClass("sqico-uarrow"),nextitem.animate({height:"toggle",opacity:"toggle"},"500"),!1})},handleOnlineStatus:function(forcedeptdrpdwn,isdeptchange){var $S=$Support,eobj=$S.EmbedObj;$S.contentdiv||$UI.init(forcedeptdrpdwn),isdeptchange&&!$Support.isOnlineChat()&&$UI.showBanner(LSResource.getRealValue("ne.onlinemsg"),!0,null),$S.contentdiv.find("#msgarea").attr("dockeyup","textarea").val(null!=eobj.question?eobj.question:$("#msgarea").val()).parents(".msgbox").removeClass("posrel"),$S.contentdiv.find("#msgarea").attr("dockeydown","textarea").attr("placeholder",LSResource.getRealValue("ne.message.hitenter")),$Support.isFAQEnabled()||$("footer").find(".floatrg").remove().end().append($Temp.getSendBtnHTML(LSResource.getRealValue("common.startchat"))),""!=$S.contentdiv.find("#msgarea").val()&&$("footer").find("em#sqico-send").attr("documentclick","textarea"),$S.Util.setTextareaHeight();var config=$Support.getParent().$ZSIQWidget.getWidgetObject();config.status=!0,config.onlysticker=!0,$Support.getParent().$ZSIQWidgetUI.drawWidget(config)},updateViewAttribute:function(module){$Support.container.attr("cwview",module),"2"===$Support.container.attr("themeid")&&$("body").attr("cwview",module)},getFAQLabel:function(){var faqlabel="";if($Support.isFAQEnabled()&&(faqlabel=LSResource.getRealValue("faq.header.title"),$Support.EmbedObj.faqaccess)){var label=$Support.EmbedObj.faqaccess[1].label;""!==label&&(faqlabel=label)}return faqlabel},getChatConsentStatus:function(){var widgetobj=$Support.getParent().$ZSIQChat.getWidgetData().widgetobj,pinfo=$Support.EmbedObj.pprops,consentstoragedata=$Support.LSDB.getFromSession(_SCREENNAME+"_gdpr_chatconsent");return!(!(1==widgetobj.isgdprenabled)||!JSON.parse(pinfo.isgdprenabled)||1!=JSON.parse(pinfo.chatprivacyconfig)||consentstoragedata)},getConversationSelect:function(message_obj){for(var options_html="",options=message_obj.options,type=message_obj.type,i=0;i<options.length;i++){var obj=options[i],val=obj.text||obj.value;options_html+='<span class="choose mB10" purpose="custom" val="'+val+'" prop="'+type+'">'+val+"</span>"}return'<div class="vismsg siq-visitmsg single_msg"><div id="sel_msg" isrequired="'+message_obj.required+'" class="sel_msg font14" data-type="type"></div><div class="options textL" id="conversationoption" data-type="'+message_obj.type+'" documentclick="chooseField">'+options_html+"</div></div>"},chooseField:function($curr,event){var message=$(event.target).attr("val"),chatid=$Support.EmbedObj.chatID;!$Support.isbottrigmsg||chatid&&"-1"!=chatid?Message.send(chatid,message):($Support.EmbedObj.question=message,Message.display($Temp.getMsgHTML({msg:message,sender:$Support.EmbedObj.vwmsid}),!0),$Support.handleBotTriggerReply(message)),$curr.parent().remove()},getOfflineAPIConsent:function(label){var apivalues=$Support.getParent().$ZSIQUtil.getAPIValues();if(apivalues.textbannerobj&&apivalues.textbannerobj.offline){var offlinetxtobj=apivalues.textbannerobj.offline;if(label=offlinetxtobj.description&&0!=offlinetxtobj.description.trim().length?offlinetxtobj.description:label,offlinetxtobj.policytextandlink){var learnmoreobj=offlinetxtobj.policytextandlink,learnmore_text=learnmoreobj.text&&0!=learnmoreobj.text.trim().length?learnmoreobj.text:"",learnmore_link=learnmoreobj.link&&0!=learnmoreobj.link.trim().length&&$Support.getParent().$ZSIQUtil.isValidURL(learnmoreobj.link)?learnmoreobj.link:"";label=$Support.getParent().$ZSIQUtil.hyperLinksSubString(label,learnmore_text,learnmore_link)}}return label},getTypingHTML:function(){return'<div class="type-loadr textC"><span></span><span></span><span></span></div>'}};$(document).on("click","[documentclick]",function(event){try{var curr=$(this);({sendCallRating:function(){$Support.Util.isPreview()||($(".sqico-star").removeClass("sel"),curr.addClass("sel"),$("#msgarea").focus(),this.feedbacksent||$Support.setRating(curr))},sendCallFb:function(){$Support.sendFeedback()},moreaction:function(){$Support.Util.showMoreAction(curr,event)},sendmail:function(){$UI.populateSendMail(curr,event)},smiley:function(){$UI.populateSmiley(curr)},userdetails:function(){$UI.showUserEditUI(!0,!0)},hideuserdetails:function(){$UI.hideUserEditUI()},updateuserdetails:function(){$Support.checkAndUpdateInfo(curr)},triggermsg:function(){$Support.startTriggerChat()},min_iframe:function(){$Support.Util.minimizeEmbed()},max_iframe:function(){$Support.Util.maximizeEmbed()},close_iframe:function(){$Support.Util.closeEmbed()},chatend:function(){$Support.quitChat()},triggermail:function(){$Support.sendMail()},triggermailconfirm:function(){$Support.sendMailConfirm(curr)},updatetranslatecookie:function(){$Support.updateTranslateCookie()},rating:function(){$Support.Util.handleRating(curr)},showChatFeedback:function(){$Support.Util.showChatFeedback(curr)},printfile:function(){$Support.printPreview()},toggleaudio:function(){$Support.Util.toggleAudio(curr)},captcha:function(){$Support.Util.handleCaptcha()},restartchat:function(){$Support.restartchat()},imgupload:function(){PasteImage.uploadImage($Support.container)},imgcancel:function(){$Support.Util.hidePasteUI()},accepturl:function(){$Support.Util.openPushPage(curr.attr("url"))},sendmessage:function(){$Support.triggerSendMessage()},textarea:function(){$Support.Util.handleStartChat(function(){$Support.startChat(curr)})},missedleavemsg:function(){$Support.Util.handleStartChat(function(){$Support.missedLeaveMsg()})},leavemessage:function(){$Support.Util.handleStartChat(function(){$Support.handleLeaveMessage()})},feedback:function(){$Support.sendFeedback()},hideprogress:function(){$UI.hideUploadProgress(curr.attr("msgid"))},hidefeedback:function(){$Support.Util.hideFeedback(curr)},openmeeting:function(){$Support.handleMeetingJoinCB()},sharedesktop:function(){$Support.shareDesktop(curr)},sharescreen:function(){avimpl.shareScreen()},resendmsg:function(){LSMessanger.resendMessages(RESEND_MANUAL)},showconvlist:function(){if("siqnoticon"!=event.target.id){var isuserclick=event.hasOwnProperty("originalEvent");$Support.Util.handleShowConversation(isuserclick)}},showchatui:function(){var eventtarget=event.target.id;"removeconvpopup"==event.target.id||$(event.target).is("a")||$Support.Util.showMessageAreaUI(eventtarget)},fetchconvtranscript:function(){"showsiqchatui"!=event.target.id&&$Support.getConversationChatTranscript(curr.attr("chid"),curr.attr("visitorid"))},removeconvpopupmsg:function(){$Support.removeConversationPopupMessage()},toggleMadatoryField:function(){$CWPreview.toggleMadatoryField(curr)},triggerDeleteEMField:function(){$CWPreview.triggerDeleteEMField(curr)},newsletter:function(){$Support.handleNewsLetter()},transferchat:function(){$Support.transferChat()},removetransfer:function(){$UI.removeTransferDiv()},transfermissed:function(){$Support.handleTransferMissed(curr)},hidetransferoption:function(){$Support.hideTransferOption()},audiocall:function(){avimpl.startCall()},imagepreview:function(){$Support.Util.showImagePreview(curr)},showfaq:function(){$FAQ.showFAQUI(curr)},faqcategory:function(){$FAQ.showCategory(curr),event.stopPropagation()},faqsearch:function(){$FAQ.handleSearch(curr)},showconversation:function(){$Support.Util.isPreview()||(curr.addClass("sel").next(".sel").removeClass("sel"),$("#conv-tab").removeClass("count").find(".siqc_eletype").hide(),!$Support.getConversationData()||-1!==$Support.EmbedObj.chatID||$Support.istrigmsg?($Support.Util.showMessageAreaUI(),$Support.Util.calculateTextareaHeight()):$Support.Util.showConversationListUI(curr))},faqpreview:function(){$FAQ.showFAQPreview(curr)},extendview:function(){$FAQ.showAllArticlesInCategory(curr)},chooseField:function(){$Support.Util.chooseField(curr,event)}})[curr.attr("documentclick")]()}catch(e){}});var isComposing=!1,hasCompositionJustEnded=!1,brow_lang=$Support.getParent().$ZSIQUtil.getBrowserLanguage();function bindDragDropEvents(){CommonUtil.isAllowFileSharing()&&(jQuery.event.props.push("dataTransfer"),$Support.container.on({dragover:function(e){e.preventDefault(),$UI.showDragDropUI()},drop:function(e){e.preventDefault(),$Support.Util.handleDropEvent($Support.EmbedObj.chatID,e),$UI.hideDragDrop()},dragleave:function(e){$UI.hideDragDrop()}}))}function handlePaste(){CommonUtil.isAllowPasteImage()&&$("#msgarea").on("paste",function(e){PasteImage.onPaste(e,this),e.stopImmediatePropagation()})}function handleDrag(){if(!$Support.isMobileWidth()){var dragabble=$("header"),x_pos=0,y_pos=0,x_elem=0,y_elem=0;dragabble.on("mousedown.drag",function(e){"INPUT"!==e.target.tagName&&(x_elem=e.pageX,y_elem=e.pageY,dragabble.on("mousemove.drag",function(e){x_pos=e.pageX,y_pos=e.pageY,parent.$ZSIQChatWindow.handleDrag(x_elem-x_pos+"#"+(y_elem-y_pos)),e.stopImmediatePropagation()}),e.preventDefault(),dragabble.on("mouseup.drag",function(e){postDragValues(e)}).on("mouseleave.drag",function(e){postDragValues(e)}))})}function postDragValues(e){parent.$ZSIQChatWindow.cacheChatDivPosition(),dragabble.off("mousemove.drag mouseleave.drag"),e.stopImmediatePropagation()}}$(document).on("keydown","[dockeydown]",function(event){var curr=$(this),docattr=curr.attr("dockeydown"),keycode=$Support.Util.getKeyCode(event);if(229==keycode)return!1;hasCompositionJustEnded=!1,27==keycode&&$Clickoutside.handleEscape(event),{textarea:function(){$Support.Util.handleKeyDown(curr,keycode,event)},captcha:function(){13==keycode&&($Support.addVisitor(),event.preventDefault())},pasteimage:function(){27==keycode&&($Support.Util.hidePasteUI(),event.preventDefault())},dropdown:function(){$Support.Util.handleDrpdwnEvent(curr,keycode,event)},triggermail:function(){$Support.Util.sendMail(event)},removeError:function(){curr.removeClass("errfield")},searchfaq:function(){27==keycode&&curr.parent().find(".sqico-close").trigger("click")}}[docattr]()}).on("compositionstart",function(event){isComposing=!0}).on("compositionend",function(event){hasCompositionJustEnded=!(isComposing=!1)}),$(document).on("keyup","[dockeyup]",function(event){if(brow_lang&&"en"==brow_lang||!isComposing&&!hasCompositionJustEnded){var curr=$(this),docattr=curr.attr("dockeyup"),keycode=$Support.Util.getKeyCode(event);({textarea:function(){$Support.Util.handleTextareaEnter(curr,keycode,event,function(){$Support.startChat(curr)})},sendmessage:function(){$Support.handleSendMessage(curr,keycode,event)},leavemessage:function(){$Support.Util.handleTextareaEnter(curr,keycode,event,function(){$Support.handleLeaveMessage(curr)},!0)},triggermsg:function(){$Support.handleTriggerMsg(curr,keycode,event)},missedleavemsg:function(){$Support.Util.handleTextareaEnter(curr,keycode,event,function(){$Support.missedLeaveMsg(curr)},!0)},feedback:function(){CallImpl.isCallWithChat?$Support.Util.handleCallFdbEnter(curr,keycode,event):$Support.Util.handleFeedback(curr,keycode,event)},triggermail:function(){$Support.Util.handleSendMail(curr,keycode,event)},handlepasteimage:function(){PasteImage.handlepasteimage(curr)},searchfaq:function(){$FAQ.searchFAQ(curr,event)}})[docattr]()}else hasCompositionJustEnded=!1}),$(document).mousedown($Support.Util.triggerAdditionalFileDownload),$(document).on("blur","[docblur]",function(event){var curr=$(this);({email:function(){$Support.Util.validateFields(curr.parent())},custominput:function(){$Support.Util.handleInputChange(curr.attr("id"),curr.val())},required:function(){$Support.Util.validateFields(curr.parent())}})[curr.attr("docblur")]()}),$(document).on("keydown",function(e){27==$Support.Util.getKeyCode(e)&&($Clickoutside.handleEscape(e),CommonUtil.handleEscape(e))}),$(document).on("keyup",function(e){var curtarget=$(e.target);curtarget.filter("[data-validate*='required']").length&&(""===$.trim(curtarget.val())?curtarget.next().addClass("req"):curtarget.next().removeClass("req"))}),$(document).on("focusin",function(event){KeyHandler.winfocus=!0,$Support.iswindowfocused=!0,Message.stopBlinking()}),$(document).on("focusout",function(event){KeyHandler.winfocus=!1,$Support.iswindowfocused=!1}),$(window).resize(function(){$Support.Util.handleResize()}),$(document).on("keypress","[onenter]",function(event){if("13"==(event.keyCode?event.keyCode:event.which)){var curr=$(this);({updateuserdetails:function(){$Support.checkAndUpdateInfo(curr.parents(".editfields").find('[documentclick="updateuserdetails"]'))}})[curr.attr("onenter")]()}}),KeyHandler={isWindowFocused:function(){KeyHandler.winfocus}};$ThemeHandler={},$ThemeHandler.theme6={updateContainer:function(){$(".siqembed").remove(),$("body").append($Support.container=$($Temp.getContainerHTML()))},updateHeader:function(data){$Support.container.prepend($Temp.getHeaderHTML(data)),handleDrag(),$("#zsiq_customcss").remove(),$("body").append(this.getCustomColor()),$Support.Util.handleCompanyLogo()},updateInnerHeader:function(data){var header=$Support.container.find("header");if($Support.container.removeClass("outerwin"),header.length){if(!$Support.proactive&&$Support.EmbedObj.attendername===data.attendername)return;this.animateHeader(data)}else this.updateHeader(data)},updateBody:function(iscontaineronly,forcedeptdrpdwn){$Support.container.append($Support.contentdiv=$($Temp.getBodyHTML(iscontaineronly,forcedeptdrpdwn))).append($Support.convlistcontainer=$($Temp.getConversationContainerHTML())).append($Support.convtranscontainer=$($Temp.getConversationTranscriptContainerHTML())),$Support.bindScrollForConversationListContainer()},updateInnerBody:function(){$Support.container.append($Support.contentdiv=$($Temp.getChatAreaHTML())).append($Support.convlistcontainer=$($Temp.getConversationContainerHTML())).append($Support.convtranscontainer=$($Temp.getConversationTranscriptContainerHTML())),$Support.chatdiv=$("#msgdiv"),$Support.chatmaindiv=$("#msgmaindiv"),$Support.composer=$("#msgarea"),handlePaste(),$Support.bindScrollForConversationListContainer()},updateFooter:function(){$Support.container.find("footer").remove().end().append($Temp.getFooterHTML()),$Support.isConversationUIFocussed()&&!$Support.isFAQEnabled()&&$Support.container.find("footer").hide(),$Support.container.append($Temp.getConversationCreateChatIConHTML()),this.populateSendBtn(),$Support.Util.handleResize(),$Support.Util.isCampaignEnabled()&&($Support.subscribe=!1,$("#newsletter").on("change",function(){$Support.subscribe=$(this).is(":checked")}));var chatconsentdiv=$("#chatconsent");$Support.Util.getChatConsentStatus()&&1==chatconsentdiv.length&&$("#chatconsent").on("change",function(){1==$(this).is(":checked")?$Support.toggleSendButton($Support.getComposer()):$Support.Util.removeSendClickAction()})},updateDeptDropdown:function(){$("#sqico-drpdwn").dropdown({options:$Support.EmbedObj.deptlist,purpose:"department",defaultval:LSResource.getRealValue("ne.chosedepartment")})},animateHeader:function(data){var header=$Support.container.find("header"),abtme=data.aboutme||"",aboutmecls=abtme?"":"noaboutme";(data.attendername&&(header.removeClass("cmplogomain").find("#attname").html(getEscapedText(data.attendername)).removeClass("noaboutme").addClass(aboutmecls),header.find(".cmplogo").removeClass("sqico-chat").addClass("sqico-user")),header.find("#attabtme").html(getEscapedText(abtme)),data.image_fkey&&JSON.parse($Support.EmbedObj.eprops.icphoto))?(header.removeClass("nologo"),header.find(".cmplogo").removeAttr("style").find("#complogo").attr("src",$Support.Util.getPhotoURL())):data.chid&&(header.removeClass("nologo").addClass("nologo"),header.find(".cmplogo").removeAttr("style").find("#complogo").removeAttr("src"));$Support.isBotChat?header.find(".cmplogo").attr("data-chttype","bot"):JSON.parse($Support.EmbedObj.eprops.icphoto)&&data.attendername?header.find(".cmplogo").attr("data-chttype","agent"):header.find(".cmplogo").removeAttr("data-chttype")},showBanner:function(msg,isautohide,callbk,hidetime,isclickable,clickableobj){if(0!=msg.length){var cntdiv=$Support.contentdiv,anim=!1;cntdiv.find("#info_banr").length||(anim=!0,cntdiv.prepend($Temp.getBannerHTML(msg,isautohide,isclickable,clickableobj)),msg=""),$Support.Util.showInfoBanner(msg,isautohide,anim,callbk,hidetime)}},hideBanner:function(callback){$Support.contentdiv.find("#info_banr").slideUp(500,function(){$(this).remove(),"function"==typeof callback&&callback()})},showTimerBanner:function(msg){clearTimeout($Support.Util.bnrtimer),$Support.contentdiv.append($Temp.getTimerBannerHTML(msg))},populateSendMail:function(sendmailico){var that=this,cntdiv=$Support.contentdiv,wrapper=cntdiv.find(".txtarewrap");wrapper=wrapper.length?wrapper:cntdiv.find(".chtlnks");var smailbx=cntdiv.find("#smailbx");smailbx.length||wrapper.before(smailbx=$($Temp.getSendMailHTML()));var vismail=$Support.EmbedObj.visitoremail||"";smailbx.find("input").val(vismail),$Clickoutside.bindclick(function(){that.hideUtilityDiv(smailbx)},"smailbx",sendmailico.attr("id"))},populateSendMailConfirm:function(mailid,chid){var that=this,cntdiv=$Support.contentdiv,showchtend=!1,wrapper=cntdiv.find(".usrinpt"),chtendwrap=cntdiv.find(".infomsg.chtend");(wrapper=wrapper.length?wrapper:chtendwrap).hasClass("chtend")&&(wrapper.hide(),showchtend=!0);var smailconfirmbx=cntdiv.find("#consentbannerdiv");"gtranslateconsent"==smailconfirmbx.attr("cattr")&&(smailconfirmbx.remove(),$Support.Util.calculateTextareaHeight(),smailconfirmbx=cntdiv.find("#consentbannerdiv")),smailconfirmbx.length||wrapper.before(smailconfirmbx=$($Temp.getSendMailConfimHTML(mailid,chid))),$Support.Util.calculateTextareaHeight(),$Clickoutside.bindclick(function(){that.hideUtilityDiv(smailconfirmbx,!0,showchtend)},"consentbannerdiv","smailbx")},populateSmiley:function(smileico){Smiley.showSmileyList()},hideUtilityDiv:function(animatediv,isrecalculate,isshowchtend){animatediv.animate({bottom:"-60px",opacity:"0"},400,function(){(animatediv.remove(),isrecalculate&&!isshowchtend&&$Support.Util.calculateTextareaHeight(),isshowchtend)&&$Support.contentdiv.find(".infomsg.chtend").show()})},animateUtilityDiv:function(animatediv){animatediv.animate({bottom:"82%",opacity:"1"},400,function(){animatediv.find("input").focus()})},showUserEditUI:function(isoptional,ismanualedit){var editdiv=$Support.contentdiv.find(".editfields");editdiv.length&&!editdiv.hasClass("hidemaskanim")||($Support.contentdiv.find(".maskdiv").remove().end().prepend($Temp.getUserEditHTML(isoptional,!0)),-1==$Support.EmbedObj.department&&$UI.populateDropDown(),ismanualedit||$Support.Util.handleCustomHTML(!0),$Support.Util.calculateTextareaHeight())},hideUserEditUI:function(){$Support.enableTextarea(),$UI.hideMaskDiv()},showWaitingUI:function(hidewaitingbanner){$Support.Util.removeSendClickAction(),this.showChatArea(hidewaitingbanner)},hideMaskDiv:function(){var maskdiv=$Support.contentdiv.find(".maskdiv").addClass("hidemaskanim");$Support.Util.removeDiv(maskdiv),$Support.contentdiv.removeClass("siq_popup")},showCaptcha:function(digest){if(null!=CommonUtil.getCaptcha(digest)){var cntdiv=$Support.contentdiv,template=$Temp.getCaptchaHTML(digest),maskdiv=cntdiv.find(".maskdiv");maskdiv.length?maskdiv.html(template).addClass("captcha"):cntdiv.prepend('<div class="maskdiv captcha">'+template+"</div>")}},hideCaptcha:function(){var capthchadiv=$Support.contentdiv.find(".captcha").addClass("hidemaskanim").removeClass("captcha");$Support.Util.removeDiv(capthchadiv)},showChatArea:function(hidewaitingbanner){var $S=$Support;$S.container;$S.contentdiv.replaceWith($S.contentdiv=$($Temp.getChatAreaHTML())),$S.chatdiv=$("#msgdiv"),$S.chatmaindiv=$("#msgmaindiv"),$S.composer=$S.contentdiv.find("#msgarea"),$S.chatWindowUICallBk(),$S.Util.handleResize(),$S.contentdiv=$S.container.find(".content");var broadcast_text=$Support.getBroadcastText();broadcast_text?$UI.showBanner(DynamicMsg.fillValues(broadcast_text)):hidewaitingbanner||($UI.showWaitingDialog(),$S.container.find(".content").hide().fadeIn(1e3))},showWaitingDialog:function(){if(!(!$Support.waitingtime||0<$("#wait_div").length||$Support.isBotChat||$Support.proactive&&-1!=$Support.EmbedObj.chatID))return clearTimeout($Support.Util.bnrtimer),{text:function(){$Support.contentdiv.prepend($Temp.getWaitingTextHTML()),$UI.wait_div=$("#wait_div")},video:function(){$(".content").prepend($Temp.getWaitingTextHTML()).animate({top:"auto"},400)}}[$Support.EmbedObj.waitaction]()},populateCWaitHandler:function(){var cntdiv=$Support.contentdiv;if($Support.cwaitmsg){var msgdiv=cntdiv.find("#cwaitmsg");if(msgdiv.length)return void msgdiv.html($Support.cwaitmsg);cntdiv.find("#info_banr").after($Temp.getWaitHandlerHTML())}},removeCWaitHandler:function(){$("#cwaitmsg").remove()},populateVisitorQuestion:function(){var embedobj=$Support.EmbedObj,dname=embedobj.visitorname,msg=embedobj.question,sender=embedobj.vwmsid;($Support.istrigmsg||$Support.proactive)&&(dname=embedobj.triggername,msg=embedobj.pmsg,sender=-1);var data={sender:sender,dname:dname,msg:getEscapedText(msg),isques:embedobj.question};$("#msgdiv").append(this.getMsgHTML(data)),Message.presender=sender,$Support.Util.setMessageClass()},getMsgHTML:function(data){return $Temp.getMsgHTML(data)},getInfoMsgHTML:function(data,classname){return $Temp.getInfoHTML(data,classname)},populateUserAction:function(){var cntdiv=$Support.contentdiv;$Support.EmbedObj;$UI.setSoundConfig(),cntdiv.find(".usractions").remove().end().find(".usrinpt").prepend($Temp.getUserActionsHTML());var lst=cntdiv.find("#mraction li");lst.length?1===lst.length&&cntdiv.find("#moreaction").removeAttr("title").attr({documentclick:lst.attr("documentclick"),class:lst.attr("class")}).html(lst.children()):cntdiv.find("#moreaction").hide(),this.populateSendBtn(LSResource.getRealValue("ne.send")),$Support.Util.handleUnmute()},getSoundHTML:function(isreplace){var shtml=$Temp.getSoundHTML();return isreplace&&(shtml=shtml.replace(/<li /g,"<span ").replace(/<\/li>/g,"</span>"),shtml=$(shtml).empty()),shtml},populateSmileyIcon:function(){$UI.removeSmileyIcon(),$Support.contentdiv.find("#smilelist").after($Temp.getSmileyIconHTML())},removeSmileyIcon:function(){$Support.contentdiv.find("#smiley").remove()},populateSendBtn:function(text){$Support.isFAQEnabled()||$("footer").find(".floatrg").remove().end().append($Temp.getSendBtnHTML(text))},handleOfflineStatus:function(forcedeptdrpdwn,isdeptchange){var $S=$Support,eobj=$S.EmbedObj;$S.contentdiv||$UI.init(forcedeptdrpdwn),isdeptchange&&$Support.isOnlineChat()&&($UI.showBanner($S.getOfflineMessage(),!0),$("#msgarea").attr("placeholder",$Support.isFAQEnabled()?LSResource.getRealValue("ne.message.clicksubmit.icon"):LSResource.getRealValue("ne.message.clicksubmit")),$Support.isFAQEnabled()&&$("#msgarea").after($Temp.getSendIcon(!0))),$S.contentdiv.find("#msgarea").attr("dockeyup","leavemessage").val(null!=eobj.question?eobj.question:$("#msgarea").val()).parents(".msgbox").addClass("posrel"),$S.contentdiv.find("#msgarea").removeAttr("dockeydown"),this.populateSendBtn(LSResource.getRealValue("ne.submit")),""!=$S.contentdiv.find("#msgarea").val()&&$("footer").find("em#sqico-send").attr("documentclick","leavemessage"),$S.Util.setTextareaHeight()},handleMissedStatus:function(showofflinemsg){var $S=$Support,composer=$S.composer||$("#msgdiv");composer.removeAttr("disabled").attr("placeholder",$Support.isFAQEnabled()?LSResource.getRealValue("ne.missed.placeholder.icon"):LSResource.getRealValue("ne.missed.placeholder")),composer.removeAttr("dockeydown"),showofflinemsg?$UI.showBanner(LSResource.getRealValue("ne.offlinemsg")):$UI.showBanner(DynamicMsg.fillValues(getUnescapedText($S.EmbedObj.missedmessage))),$S.contentdiv.addClass("missed").find("#msgarea").attr("dockeyup","missedleavemsg"),this.populateSendBtn(LSResource.getRealValue("ne.submit")),$UI.updateCloseIcon()},populateFeedbackHTML:function(nofbinput){var contentdiv=$Support.contentdiv;contentdiv.find(".sqico-edit").remove();var showfdbk=JSON.parse($Support.EmbedObj.eprops.feedback[0]),israte=$Support.israting,isfdbk=$Support.isfeedback;if(!(showfdbk||israte||isfdbk)||0==israte&&0==isfdbk)this.emptyFeedback();else{0==isfdbk&&($Support.isfeedbacksent=!0),$Support.contentdiv.removeClass("siq_popup").addClass("siq_popup");var template=!1===$Support.israting?$Temp.getFeedbackOnlyHTML():$Temp.getFeedbackHTML(!isfdbk);contentdiv.find(".maskdiv").remove().end().prepend(template),this.emptyFeedback(),isfdbk&&this.handleFeedbackBtn()}},handleFeedbackBtn:function(){this.populateSendBtn(LSResource.getRealValue("ne.submit")),$("footer #sqico-send").before('<em documentclick="hidefeedback" class="hidemask">'+LSResource.getRealValue("common.cancel")+"</em>")},emptyFeedback:function(){var contentdiv=$Support.contentdiv;contentdiv.find("div.usrinpt").remove(),$("footer #sqico-send").remove(),contentdiv.addClass("nofdbk"),$("#fdbkarea + .sqico-send").hide()},updateCloseIcon:function(){$Support.container.find(".sqico-min").replaceWith($Temp.getCloseHTML())},showFdbkResponse:function(){var msgdiv=document.getElementById("msgmaindiv");if(Message.scroll(msgdiv),$Support.isfeedback){var feedbackmsg=$Support.EmbedObj.feedbackcomplete||LSResource.getRealValue("visitorchat.feedback.submit");$UI.showBanner(feedbackmsg,"psabs",!0)}this.feedbackAck()},feedbackAck:function(){$Support.Util.hideFeedback(),$Support.chatmaindiv.addClass("fdbalone"),$("#msgmaindiv").find('.vismsg [purpose="name"]').removeAttr("documentclick")},getInfoMsgContent:function(msgobj,convvisitorid,convchid){var infomsg=Message.getInfoHTML(msgobj,convvisitorid,convchid);return infomsg?this.getInfoMsgHTML(infomsg):""},showDragDropUI:function(){var maskbx=$("#dragmask");maskbx.length?maskbx.show():$Support.contentdiv.prepend($Temp.getDragDropHTML())},hideDragDrop:function(){$Support.contentdiv.find("#dragmask").hide()},getPreviewHTML:function(){return $Temp.getPreviewHTML()},notifyShareURL:function(msg){var obj={documentclick:"accepturl",attr:"url",value:msg.msg};$UI.showBanner($Temp.getShareURLHTML(msg),!1,null,null,!0,obj)},displayInfo:function(msg){$UI.showBanner(msg)},getCustomHTML:function(customobj){var type=customobj.type||"text";return/^(number|text|email|url|percentage|decimal)$/.exec(type)?$Temp.getCInputHTML(customobj):{checkbox:function(){return $Temp.getCCheckBxHTML(customobj)},radio:function(){return $Temp.getCRadioHTML(customobj)},selectbox:function(){return $Temp.getCDropDwnHTML(customobj)},textarea:function(){return $Temp.getCTextareaHTML(customobj)},label:function(){return $Temp.getCLabelHTML(customobj)}}[type]()||""},showUploadProgress:function(data){var embedobj=$Support.EmbedObj,that=this,file=data.fileobj,msgid=data.msgid,filename=file.name||data.filename,msgobj=$('span[msgid="'+msgid+'"]'),sender=embedobj.vwmsid;if(that["fileprg"+msgid]||msgobj.length){var evt=data.prgval,prgval=parseInt(evt.loaded/evt.total*100),file_obj=msgobj.find(".file_prgs"),deg=prgval/100*360;180<deg&&file_obj.addClass("gt50"),msgobj.find(".size").html(getMemSize(evt.loaded)+" of "+getMemSize(evt.total)+" ("+prgval+"%)"),file_obj.find(".pie:first-child").css({transform:"rotate("+deg+"deg)","-webkit-transform":"rotate("+deg+"deg)","-moz-transform":"rotate("+deg+"deg)"})}else that["fileprg"+msgid]=!0,$Support.Util.getFileURL(file,function(url){Message.display(that.getMsgHTML({sender:sender,dname:embedobj.visitorname,msg:{content:file.type},file:{size:file.size,purl:url,fName:filename,progress:!0,msgid:msgid,comment:data.comment},previoussender:Message.presender&&Message.presender===sender}),!0),$Support.Util.setMessageClass()})},hideUploadProgress:function(msgid){var prgbx=$('span[msgid="'+msgid+'"]');prgbx.find(".file_prgs").removeClass("gt50"),prgbx.removeClass("fprgs");var sizediv=prgbx.find(".size");sizediv.html(sizediv.attr("size")),delete this["fileprg"+msgid]},updateParentFontFamily:function(){$Support.Util.updateParentFontFamily()},updateQuesArea:function(){this.populateSendBtn(),$Support.contentdiv.find(".msgbox").html($Temp.getQuesAreaHTML()),$Support.composer=$("#msgarea")},updateChatEndMsg:function(){$Support.chatmaindiv.addClass("chtcomp").after($Temp.getChatEndHTML())},updateVisitorName:function(data){var name=getEscapedText(data.name);name&&$Support.contentdiv.find('.vismsg div[purpose="name"]').html(name+'<em class="sqico-edit" documentclick="userdetails" title="'+LSResource.getRealValue("ne.title.edit")+'"></em>')},getBusinessHrInfo:function(){var eobj=$Support.EmbedObj;if(!eobj.bushrstatus)return"";var txt=LSResource.getRealValue("ne.offlinemsg"),timeint=eobj.bushrtiming;if(!timeint)return txt;var matchindex;for(var index in timeint){var val=timeint[index];val.length&&(isUndefined(matchindex)&&(matchindex=index),timeint[matchindex][0]!==val[0]&&!1)}return $Temp.getBusnsInfoHTML(timeint[matchindex][0])},setSoundConfig:function(){var eobj=$Support.EmbedObj,soundkey=$Support.getCookieValue(eobj.chatID+"_sound");eobj.setSoundConfig(soundkey)},addGroupIcon:function(){$Support.container.find("#complogo").after($Temp.getGroupIconHTML())},removeGroupIcon:function(){$Support.container.find("#complogo").next(".sqico-grpico").remove()},getCustomColor:function(){var custom_color=$Support.EmbedObj.eprops.color[1].code,text_color=$Support.Util.getTextColor(custom_color);return'<style id="zsiq_customcss">em.sqico-chat2:before, header .siqchat-detl,header .sqico-chat:before, header .cmplogo.sqico-clogo:after, .lstmsg_strs .sqico-star,.infomsg span:before,.infomsg span,[cwview="faqview"] .cmplogo span:before,.artcle-viewal, textarea + .sqico-send[documentclick]::before,[cwview="faqview"] .cmplogo:before{ color : '+custom_color+" !important;}body:before,.siqc_prochtcls:before,.wincustom_bg:not(.sqico-chat), .vismsg .msgbx, .smile_list .siqsmile_li:hover, .smile_list .siqsmile_li.sel, .nologo .sqico-user ,#conv-tab.count .siqc_eletype, .gltr-srno:not(.gltr-no),.siqchat-detl.sqico-call, .gltr-done div { background-color: "+custom_color+"}.vismsg .msgbx span:FIRST-CHILD, .content .vismsg .time, .siqc_hstrycht .vismsg .time, .vismsg .msgbx *, .vismsg .sqico-close:BEFORE, .smile_list .siqsmile_li:hover, .smile_list .siqsmile_li.sel, .gltr-srno:not(.gltr-no), .zsiq_transferdiv .bot_opt.gltr-srno:not(.gltr-no), .gltr-done div { color: "+text_color+"}.msgbx a{ border-bottom-color: "+text_color+"}.file_prgs > .pie { border-color: "+custom_color+"}</style>"},getHeader:function(){return $Support.container.find("header")},getTranslateBannerHTML:function(dname){return $Temp.getTranslateBannerHTML(dname)}};!function(window){window.$Template=window.$Template||{},$Temp=$Template.theme6={getContainerHTML:function(){var classname=($Support.isParentIframe()?"":" emfullwindow")+" emwin";return['<section id="window-crown" themeid="6" class="siqembed outerwin '+(classname+=$Support.isFAQEnabled()?" faq":"")+$Support.getEmbedSizeClass()+'"></section>'].join("")},getHeaderHTML:function(data){var eobj=$Support.EmbedObj,clogo=JSON.parse(eobj.eprops.iclogo)?eobj.clogo+"?nps=404":"",isattenderimg=data&&JSON.parse(eobj.eprops.icphoto)&&(data.attenderimagefkey||data.imagefkey||data.image_fkey),user_logo=isattenderimg?$Support.Util.getPhotoURL():"",attname=getEscapedText(data&&data.attendername||"");clogo=attname?user_logo:clogo;var cmpny_cls=isattenderimg||!clogo||attname?"":"cmplogomain",classname=clogo?"":"nologo";eobj.portalname;attname=attname||(eobj.status?LSResource.getRealValue("ne.chatwithus"):LSResource.getRealValue("ne.offlinemessage"));var is_in_iframe=$Support.isParentIframe(),aboutme=getEscapedText(data&&data.aboutme||""),aboutmecls=aboutme?"":"noaboutme",iscompanywebsite=!1;if(eobj.companywebsite){var companywebsite=eobj.companywebsite;iscompanywebsite=!0}var minhtml=$Support.isSignature(eobj)?"":'<em class="sqico-min siq-minimize-icon" title="'+LSResource.getRealValue("ne.title.minimize")+'" documentclick="min_iframe"></em>';return['<header class="'+classname+" "+cmpny_cls+'" prop="header">',is_in_iframe?'<div class="actbtn">'+minhtml+"</div>":"",'<div class="siq-convback sqico-larrow" id="showsiqconv" documentclick="showconvlist" style="display:none;"></div>','<div class="cmplogo siq-company-logo'+(data?" sqico-user":" sqico-chat")+'" prop="clogo"'+($Support.isBotChat?'data-chttype="bot"':"")+">",iscompanywebsite?'<a id="compurl" href="'+companywebsite+'" target="_blank">':"",$UI.getBotImageHTML(!$Support.isBotChat),'<img src="'+clogo+'" height="49" width="49" id="complogo" class="cmn_mdl siq-company-logo"/></div>',iscompanywebsite?"</a>":"",'<div class="siq-descdiv">','<div class="txtelips attnam '+aboutmecls+' siq-chat-attender-name" id="attname">'+attname+"</div>",'<div class="txtelips fnt12 siq-about-me" id="attabtme" title="'+aboutme+'">'+aboutme+"</div>","</div>",CommonUtil.isAudioCallAllowed()?'<span class="siqchat-detl sqico-call" documentclick="audiocall" id="audiocall" title="'+LSResource.getRealValue("audiovideo.audiocall")+'" style="display:none;"></span>':"","</header>"].join("")},getBodyHTML:function(iscontaineronly,forcedeptdrpdwn){if(iscontaineronly)return'<section class="content siq_content"></section>';var eobj=$Support.EmbedObj,sectionclassname="content posrel siq_content ";$Support.isSignature(eobj)&&(sectionclassname+="algn_hgt ");var status=$Support.EmbedObj.status,eprops=eobj.eprops,chatcookiepolicyurl=eobj.pprops.chatcookiepolicyurl;return['<section class="'+sectionclassname+'" purpose="outer">',JSON.parse(eprops.isname[0])?this.getNameHTML(eprops.isname[1].ismandatory):"",JSON.parse(eprops.isemail[0])?this.getEmailHTML(eprops.isemail[1].ismandatory):"",JSON.parse(eprops.isphoneno[0])?this.getPhoneHTML(eprops.isphoneno[1].ismandatory):"",-1==eobj.department||forcedeptdrpdwn?'<div><div class="fld_labl">'+LSResource.getRealValue("common.department")+'</div><div id="sqico-drpdwn" class="sqico-drpdwn siq-dropdown" custom="department" info="department" data-validate="required"></div></div>':"",'<div class="msgbox" custom="question">',this.getQuesAreaHTML(status),0==status?this.getChatConsentHTML(chatcookiepolicyurl):"",this.getCampaignHTML(),"</div>","</section>"].join("")},getQuesAreaHTML:function(isavail){var placeholdertxt=0==isavail?$Support.isFAQEnabled()?LSResource.getRealValue("ne.message.clicksubmit.icon"):LSResource.getRealValue("ne.message.clicksubmit"):LSResource.getRealValue("ne.message.hitenter");return['<div class="posrel siq-message-area">','<div class="fld_labl">'+LSResource.getRealValue("common.message")+"</div>",'<textarea placeholder="'+placeholdertxt+'" class="msgarea siq-message-textarea" purpose="question" info="question" id="msgarea" dockeydown="textarea" dockeyup="textarea" data-validate="required charlimit 2048"></textarea>',this.getSendIcon(0==isavail)+"</div>"].join("")},getNameHTML:function(required,isedit){var validate="true"===required?"required":"optional",placeholder=isedit?LSResource.getRealValue("ne.entername"):"",visitor_name=$Support.Util.isInValidVisitorName($Support.EmbedObj.visitorname)?"":$Support.EmbedObj.visitorname;return'<div custom="name"><div class="fld_labl">'+LSResource.getRealValue("common.name")+'</div><input type="text" value="'+getEncodedText(visitor_name)+'" id="visname" class="siq-input-text-box" info="name" placeholder="'+placeholder+'" purpose="visitorname" data-validate="'+validate+' charlimit 100"/><em class="req siq-required" title="'+LSResource.getRealValue("ne.required")+'"></em></div>'},getEmailHTML:function(required,isedit){var validate="true"===required?"required":"optional",placeholder=isedit?LSResource.getRealValue("ne.enteremail"):"",visitor_email=$Support.EmbedObj.visitoremail||"";return['<div custom="email">','<div class="fld_labl">'+LSResource.getRealValue("common.email")+"</div>",'<input type="text" id="visemail" value="'+visitor_email+'" class="siq-input-text-box" info="email" placeholder="'+placeholder+'" purpose="visitoremail" data-validate="'+validate+' email charlimit 100" docblur="email" /><em class="req siq-required" title="'+LSResource.getRealValue("ne.required")+'"></em>',this.getFetchMailHTML(),"</div>"].join("")},getFetchMailHTML:function(required){return $Support.EmbedObj.fetchid?'<div class="fetchmail" id="fetchmail"><em>or</em><span class="sqico-fb"></span><span class="sqico-gplus"></span></div>':""},getPhoneHTML:function(required,isedit){var validate="true"===required?"required":"optional",placeholder=isedit?LSResource.getRealValue("ne.enterphone"):"",visitor_phone=$Support.EmbedObj.visitorphone||"";return'<div custom="phone"><div class="fld_labl">'+LSResource.getRealValue("ne.enterphone")+'</div><input type="text" value="'+visitor_phone+'" class="siq-input-text-box" id="visphone" class=""  info="phone" purpose="visitorphone"  data-validate="'+validate+' phone" placeholder="'+placeholder+'"/><em class="req siq-required" title="'+LSResource.getRealValue("ne.required")+'"></em></div>'},getCampaignHTML:function(){if(!$Support.Util.isCampaignEnabled())return"";var label=$Support.EmbedObj.integprops.integinfo[$Support.enabledCampaignID].subscribelabel||LSResource.getRealValue("embed.campaign.label");return['<div class="newsletter siq-newsletter txtelips" documentclick="newsletter">','<input type="checkbox" id="newsletter" name="Checkbox" />','<label for="newsletter" class="siq-checkbox-label txtelips" title="'+label+'"><span class="sqico-chkbx siq-checkbox"></span><em>'+label+"</em></label>","</div>"].join("")},getChatConsentHTML:function(policyurl){if($Support.Util.getChatConsentStatus()){var policyurltxt=LSResource.getRealValue("common.gdpr.agent.offlineaccept2");policyurl&&(policyurltxt="<a class='siq-lnmor' target='_blank' href='"+(policyurl=-1==policyurl.indexOf("http")?"http://"+policyurl:policyurl)+"'>"+policyurltxt+"</a>");var label=LSResource.getRealValue("common.gdpr.agent.offlineaccept1")+policyurltxt;return['<div id="offlineconsent" class="newsletter siq-newsletter">','<input type="checkbox" id="chatconsent" name="Checkbox" />','<label for="chatconsent" class="siq-checkbox-label txtelips" title=""><span class="sqico-chkbx siq-checkbox"></span>'+(label=$Support.Util.getOfflineAPIConsent(label))+"</label>","</div>"].join("")}},getChatAreaHTML:function(){var hint=$Support.EmbedObj.messagehint,eobj=$Support.EmbedObj;return['<section class="content chtanim siq_content '+($Support.isSignature(eobj)?" algn_hgt":"")+'">','<div class="chtcont" id="msgmaindiv"><div class="disply_tbl"><div class="disply_cel" id="msgdiv">',"</div></div></div>",'<div class="usrinpt">','<div class="txtarewrap"><textarea '+(hint?'placeholder="'+hint+'"':'placeholder="'+LSResource.getRealValue("ne.message.hitenter")+'"')+' class="msgarea" id="msgarea" dockeydown="textarea" dockeyup="sendmessage"  data-validate="required"></textarea>'+this.getSendIcon()+'<div class="smile_list siq-smileys-section" id="smilelist" style="display: none;"></div></div>',"</div>","</section>"].join("")},getSendIcon:function(isleavemsgform){return $Support.isFAQEnabled()&&($Support.Util.isHandHeldDevice()||isleavemsgform)?'<span class="sqico-send siq-send-button" id="sqico-send" title="'+LSResource.getRealValue("embed.submit")+'"></span>':""},getSmileyIconHTML:function(){var eprops=$Support.EmbedObj.eprops;return JSON.parse(eprops.showsmiley)?'<span class="sqico-smile" documentclick="smiley" id="smiley" title="'+LSResource.getRealValue("ne.title.emoji")+'"></span>':""},getUserActionsHTML:function(){var eprops=$Support.EmbedObj.eprops;$Support.EmbedObj.isBetaPortal;return['<div class="usractions clearfix">','<div class="txtelips siq-typing-message" id="typgstatus"></div>','<div class="floatrg usractico">','<span class="sqico-more siq-menu" documentclick="moreaction" id="moreaction" title="'+LSResource.getRealValue("ne.title.action")+'"></span>','<span class="sqico-end siq-end-chat-button" documentclick="chatend"  title="'+LSResource.getRealValue("ne.title.chatend")+'"></span>',"</div>",'<ul class="mraction" id="mraction">',CommonUtil.isAllowFileSharing()?'<li class="sqico-attach" documentclick="attachfile">'+this.getSendFileHtml()+LSResource.getRealValue("ne.action.attachfile")+"</li>":"",JSON.parse(eprops.icsound)&&EmbedSound.isPlayerEnable()?this.getSoundHTML():"",JSON.parse(eprops.icmail)?'<li class="sqico-smailico" documentclick="sendmail" id="sendmail">'+LSResource.getRealValue("ne.action.sendmail")+"</li>":"",JSON.parse(eprops.icprint)?'<li class="sqico-print" documentclick="printfile">'+LSResource.getRealValue("common.print")+"</li>":"",CommonUtil.isAllowAssist()&&!$Support.isBotChat?'<li class="sqico-share_screen" documentclick="sharedesktop" id="sharedesktop">'+LSResource.getRealValue("embed.desktop.sharing")+"</li>":"",CommonUtil.isScreenSharingAllowed()?'<li class="sqico-share_screen" documentclick="sharescreen" id="sharescreen">'+LSResource.getRealValue("embed.desktop.siqsharing")+"</li>":"","</ul>","</div>"].join("")},getSoundHTML:function(){var soundkey=$Support.EmbedObj.soundval;return isUndefined(soundkey)||-1!=soundkey?'<li class="sqico-mute" documentclick="toggleaudio" purpose="sound">'+LSResource.getRealValue("ne.action.mute")+"</li>":'<li class="sqico-unmute" documentclick="toggleaudio" purpose="sound">'+LSResource.getRealValue("ne.action.unmute")+"</li>"},getFooterHTML:function(){var faqlabel=$Support.Util.getFAQLabel();return['<footer class="clearfix">',$Support.EmbedObj.sm?'<div class="floatlf"><span class="sqico-fb"></span><span class="sqico-tweet"></span><span class="sqico-gplus"></span></div>':"",$Support.isAllowFreeLogo()?'<div class="flogo">'+LSResource.getRealValue("ne.freelogo",_FREELOGOLINK)+"  </div>":"",$Support.isFAQEnabled()?'<div class="faqdiv dsp_table"><div class="sel sqico-chat" id="conv-tab" documentclick="showconversation"><span clas="txtelips">'+LSResource.getRealValue("ne.conversation")+'</span><span class="disIB"><span class="siqc_eletype"></span></span></div><div class="sqico-faqico" id="faqtab" documentclick="showfaq">'+faqlabel+"</div></div>":"","</footer>"].join("")},getSendBtnHTML:function(text){return'<div class="floatrg"><em class="sqico-send siq-send-button" id="sqico-send">'+(text=text||LSResource.getRealValue("ne.startchat"))+"</em> </div>"},getBannerHTML:function(msg,isautohide,isclickable,clickableobj){var message='<div class="info_banr'+(isautohide?"":" relate")+' siq-info-banner" id="info_banr"';return isclickable&&(message+='style="cursor:pointer;" documentclick="'+clickableobj.documentclick+'"'+clickableobj.attr+'="'+clickableobj.value+'"'),message+=">"+msg+"</div>"},getSendMailHTML:function(){return['<div class="semail sqico-smailico siq-send-email-section" id="smailbx">','<input type="text" class="siq-input-text-box siq-send-email-input" placeholder="'+LSResource.getRealValue("ne.action.enteremail")+'" info="email" data-validate="optional email" dockeyup="triggermail"/><em class="sqico-smail" documentclick="triggermail" title="'+LSResource.getRealValue("ne.action.sendmail")+'"></em>',"</div>"].join("")},getSendMailConfimHTML:function(mailid,chid){var chatid=chid||"";return['<div class="gltr-cont" id="consentbannerdiv" cattr="sendmailconfirm">','<span class="gltr-desc">'+LSResource.getRealValue("common.gdpr.emaildoubleoptin")+" <em>"+mailid+"</em></span>",'<div class="gltr-done"><span class="gltr-srno" documentclick="triggermailconfirm" cattr='+mailid+" chid="+chatid+">"+LSResource.getRealValue("common.yes")+'</span><span class="gltr-srno gltr-no" documentclick="triggermailconfirm" >'+LSResource.getRealValue("common.no")+"</span></div>","</div>"].join("")},getSmileyHTML:function(){var content='<div class="smileydiv" id="smileydiv">',smileyobj=Smiley.defaultsmileyobj;for(var i in smileyobj)content+='<div class="smlynone"><div title="'+smileyobj[i]+'" code="'+i+'" class="siqsly-'+smileyobj[i]+'"></div></div>';return content+="</div>"},getUserEditHTML:function(isoptional,isedit){var $S=$Support,eprops=$S.EmbedObj.eprops,namereq=eprops.isname[1].ismandatory,emailreq=eprops.isemail[1].ismandatory,phonereq=eprops.isphoneno[1].ismandatory,btntxt=isoptional?LSResource.getRealValue("ne.update"):LSResource.getRealValue("common.continue");$S.ismissed&&(btntxt=LSResource.getRealValue("ne.submit"),emailreq="true");var onenter=' onenter="updateuserdetails"';return['<div id="edituserdetails" class="chtcont maskdiv editfields">',JSON.parse(eprops.isname[0])?this.getNameHTML(namereq,onenter):"",JSON.parse(eprops.isemail[0])?this.getEmailHTML(emailreq,onenter):"",JSON.parse(eprops.isphoneno[0])?this.getPhoneHTML(phonereq,onenter):"",-1==$S.EmbedObj.department?'<div custom="department"><div class="fld_labl">'+LSResource.getRealValue("ne.department")+'</div><div id="sqico-drpdwn" tabindex="3" info="department" class="sqico-drpdwn siq-dropdown" data-validate="required"></div>':"",'<div id="usereditactionbtn" class="actionbtn">','<p id="continue_btn" data_isupdate="'+isoptional+'" class="siq-update-button" documentclick="updateuserdetails" tabindex="-1" onenter="updateuserdetails">'+btntxt+"</p>",'<p class="cancel siq-cancel-button" documentclick="hideuserdetails" >'+LSResource.getRealValue("common.cancel")+"</p>","</div>","</div>"].join("")},getCaptchaHTML:function(digest){return["<div>",'<div class="cptcha_heading">'+LSResource.getRealValue("ne.captcha.title1")+"</div>","<p>"+LSResource.getRealValue("ne.captcha.title2")+"</p>",'<div class="captcha_main">'+CommonUtil.getCaptcha(digest)+'<span class="sqico-captcha"  documentclick="captcha"></span></div>','<input type="text" class="siq-input-text-box" value="" purpose="'+digest+'" dockeydown="captcha">','<div class="actionbtn">','<p documentclick="captcha">'+LSResource.getRealValue("ne.submit")+"</p>","</div>","</div>"].join("")},getWaitingTextHTML:function(){return['<div class="info_banr timer siq-info-banner" id="info_banr">','<span class="">'+DynamicMsg.fillValues($Support.EmbedObj.waitmsg)+"</span>",'<span class="sqico-timer siq-info-timer" id="wait_div">'+MyDate.formatMS(1e3*$Support.waitingtime)+"</span>","</div>"].join("")},getMsgHTML:function(data){var convvisitorid=data.convvisitorid,isvisitor=Message.isLocalUser(data.sender)||convvisitorid&&("null"==data.sender||$Support.Util.isAnnonUser(data.sender)),classname="agntmsg siq-agntmsg",name_cls="siq-user-name",msg_cls="siq-user-message",edit_click="";(isvisitor||data.isques)&&(classname="vismsg siq-visitmsg",name_cls="siq-visitor-name",msg_cls="siq-visitor-message");var eprops=$Support.EmbedObj.eprops,dname=isvisitor&&!convvisitorid?$Support.EmbedObj.visitorname||data.name:data.dname;dname=getEscapedText(dname);var msg=data.msg;if(!data.file&&"object"==typeof msg)return"";data.iscannedarticle&&(classname+=" msg-card");var editfield="",nameattr='purpose="name"';!$Support.Util.isInValidVisitorName(dname)&&dname||(dname=LSResource.getRealValue("common.you")),-1<classname.indexOf("vismsg")&&(JSON.parse(eprops.isname[0])||JSON.parse(eprops.isemail[0])||JSON.parse(eprops.isphoneno[0]))&&!convvisitorid&&($Support.waitTimer||(editfield='<em class="sqico-edit" title="'+LSResource.getRealValue("ne.title.edit")+'"></em>',edit_click='documentclick="userdetails"'));var dname_attr='data-dname="'+getEncodedText(dname)+'"';data.previoussender&&(classname+=" mrgT2",dname=editfield=nameattr="");var botimg=isvisitor||!CommonUtil.isBot(data.sender)||data.previoussender?"":"<img class='vis_botimg' src='"+CommonUtil.getBotImageURL()+"' />",time=data.time||"",msgid=data.uniqueid?data.uniqueid:data.msgid?data.msgid:"";msgid=data.file?data.file.msgid:msgid;var smily_cls=function(html){var eprops=$Support.EmbedObj.eprops;if(!JSON.parse(eprops.showsmiley))return"";var tmp=document.createElement("DIV");return tmp.innerHTML=Smiley.replace(html),(tmp.textContent||tmp.innerText).trim()?"":" smily_msg"}(msg),file_cls="",file_type="";return data.file&&(file_cls=" file_msg",file_type=' isimage="'+(-1!=data.msg.content.indexOf("image"))+'"'),["<div "+(msgid?'id="'+msgid+'" msgid="'+data.sender+"_"+msgid+'"':"")+'" '+file_type+' class="'+classname+smily_cls+file_cls+'" data-field="message" '+dname_attr+">","<div "+nameattr+' class="'+name_cls+'" '+edit_click+">"+botimg+dname+editfield+"</div>",'<div class="msgbx">',data.file?this.getFileAttachHTML(data):'<span class="'+msg_cls+'">'+msg+'</span><span class="time siq-message-time">'+time+"</span>","</div>","</div>"].join("")},getFileAttachHTML:function(data){var fileobj=data.file,convvisitorid=data.convvisitorid,convchid=data.convchid,isimage=-1!=data.msg.content.indexOf("image"),time=data.time||"",embedobj=$Support.EmbedObj,fname=fileobj.fName||fileobj.name;fname=getEscapedText(fname);var download_url=$Support.getAjaxURL("download",".ls");download_url+="?fsize="+fileobj.size+"&url="+escape(fileobj.url)+"&fName="+encodeURIComponent(fname),download_url+=convvisitorid?"&visitorid="+convvisitorid+"&chid="+convchid+"&isconversation=true":"&chid="+embedobj.chatID+"&wmsid="+embedobj.vwmsid;var fileurl=fileobj.purl||download_url,msgid=fileobj.msgid||"",fsize=getMemSize(fileobj.size),prgs_cls=(fileobj.progress,fileobj.progress?" fprgs":""),img_comment=$.trim(fileobj.comment)?"<code>"+getEscapedText(fileobj.comment)+"</code>":"";return['<span class="fileattch siq-file-attach'+prgs_cls+(img_comment?" imgcmt":"")+'" msgid="'+msgid+'" data-ftype="'+data.msg.content+'" data-bubble="true">',isimage?'<img src="'+fileurl+'" height="75" width="75" class="siq-attach-image">':"",'<span class="filedet" documentclick="imagepreview"><em class="txtelips">'+fname+"</em>",'<em class="size" size="'+fsize+'">( '+fsize+" )</em></span>",this.getProgressHTML(fileobj,fileurl),isimage?'<em class="img_msk" data-bubble="true" documentclick="imagepreview"></em>':"","</span>"+Smiley.replace(img_comment)+'<span class="time">'+time+"</span>"].join("")},getProgressHTML:function(fileobj,fileurl){return'<div class="file_alin"><div class="file_pmain"><div class="file_prgs" msgid="'+(fileobj.msgid||"")+'"><div class="pie"></div><div class="pie fill"></div></div></div>'+(fileurl='<a target="_blank" class="fdload" href="'+fileurl+'"><span class="sqico-dwnld siq-file-progress"></span></a>')+"</div>"},getInfoHTML:function(msg,classname){return'<div class="infomsg '+(classname=classname||"")+' siq-info-message">'+msg+"</div>"},getFeedbackHTML:function(onlyrating){return['<div class="sqfdbk maskdiv siq-feedback-section" isonlyrating="'+onlyrating+'">','<div class="fdbk_cnt">',"<div>",'<div class="clblck">'+LSResource.getRealValue(onlyrating?"ne.rating.alone":"ne.rating")+"</div>",'<div class="rating">'+this.getStarHTML()+"</div>",'<div class="clblck fd-byline">'+LSResource.getRealValue("ne.rating.byline")+"</div>","</div>",onlyrating?"":'<textarea dockeyup="feedback" dockeydown="textarea" id="fdbkarea" class="siq-feedback-textarea" data-validate="required" placeholder="'+LSResource.getRealValue("ne.feedback.title")+'"></textarea>'+this.getSendIcon(),"</div>","</div>"].join("")},getFeedbackOnlyHTML:function(onlyrating){return['<div class="sqfdbk maskdiv fdbk_aln">','<div class="clblck">'+LSResource.getRealValue("ne.feedback")+"</div>",'<div class="fdbk_cnt">','<textarea dockeyup="feedback" dockeydown="textarea" id="fdbkarea" class="feedback-textarea" data-validate="required" placeholder="'+LSResource.getRealValue("ne.feedback.title")+'"></textarea>'+this.getSendIcon(),"</div>","</div>"].join("")},getStarHTML:function(selindex){for(var star="",attr=null!=selindex?"":'documentclick="rating"',i=0;i<5;i++)star+='<span class="sqico-star'+(i===selindex?" sel":"")+' siq-rating-icon" '+attr+"></span>";return star},getSendFileHtml:function(){$Support.EmbedObj;return'<input name="file1" type="file" multiple size="1" class="embdinpfile" onchange="$Support.Util.submitFile(this, event);" id="embdfileupload" title="'+LSResource.getRealValue("chat.actions.filesharing")+'" onclick="this.value=\'\'"/>'},getDragDropHTML:function(){return'<div class="dragmask siq-dragdrop-mask" id="dragmask"><em>'+LSResource.getRealValue("ne.dropfile")+"</em></div>"},getShareURLHTML:function(obj){var url=obj.msg;return'<span class="shurl siq-share-url"><em class="txtelips">'+LSResource.getRealValue("ne.shareurl.desc",CommonUtil.getformattedtext(obj.dname,20))+'</em></br><em class="txtelips" title="'+url+'">'+url+'</em></span><span class="sqico-surlico" title="'+LSResource.getRealValue("ne.shareurl.title")+'"></span>'},getPreviewHTML:function(){return['<div class="imgprev siq-image-preview" id="fileintex-FILEINDEX" purpose="fileupload">','<div class="cmtbx">','<div contenteditable="false"><input type="text" disabled="true" dockeydown="pasteimage" class="file-name" purp="name" data-validate="required"/></div>','<p id="pasteimage"></p>','<textarea id="pasteimgcomment" class="siq-comment-textarea" mcount="200" purp="comment" dockeyup="handlepasteimage" placeholder="'+LSResource.getRealValue("ne.imgcomment")+'"></textarea>','<em class="floatrg clr999 messagecount">200</em>',"</div>",'<div class="actionbtn">','<p class="siq-update-button" documentclick="imgupload">'+LSResource.getRealValue("common.upload")+"</p>",'<p class="cancel siq-cancel-button" documentclick="imgcancel">'+LSResource.getRealValue("common.cancel")+"</p>","</div>","</div>"].join("")},getCCheckBxHTML:function(obj){for(var opts=obj.options,name=getEscapedText(obj.name)||"",content='<div custombx="true" customid="'+name+'">'+this.getCustomWrap(obj),i=0;i<opts.length;i++){var cobj=opts[i],text=getEscapedText(cobj.text),value=getEscapedText(cobj.value);content+="<div>",content+='<input type="checkbox" id="'+value+'" name="'+name+'" value="'+value+'">',content+='<label for="'+value+'" class="siq-checkbox-label"><span class="sqico-chkbx siq-checkbox"></span>'+text+"</label></div>"}return content+="</div></div>"},getCRadioHTML:function(obj){for(var opts=obj.options,name=getEscapedText(obj.name)||"",content='<div custombx="true" customid="'+name+'">'+this.getCustomWrap(obj),i=0;i<opts.length;i++){var cobj=opts[i],text=getEscapedText(cobj.text),value=getEscapedText(cobj.value);content+="<div>",content+='<input type="radio" id="'+value+'" name="'+name+'">',content+='<label for="'+value+'"><span class="sqico-radio"></span>'+text+"</label></div>"}return content+="</div></div>"},getCustomWrap:function(obj){obj.options;var name=getEscapedText(obj.name)||"",reqhtml=JSON.parse(obj.required)?'<em class="req siq-required" title="'+LSResource.getRealValue("ne.required")+'">*</em>':"",content='<div class="subtitle">'+getEscapedText(obj.hint)+reqhtml+"</div>";return content+='<div class="custombtn" purpose="custom" type="'+obj.type+'"  visibility="'+obj.visibility+'" custom="'+name+'" '+this.getCustomAttr(obj)+' data-validate="">'},getCInputHTML:function(obj){var name=getEscapedText(obj.name)||"",reqhtml=obj.required&&JSON.parse(obj.required)?'<em class="req siq-required" title="'+LSResource.getRealValue("ne.required")+'"></em>':"";return['<div custom="'+name+'" type="'+obj.type+'" customid="'+name+'" custombx="true" >','<input type="text" class="siq-input-text-box" docblur="custominput" purpose="custom" visibility="'+obj.visibility+'" '+this.getCustomAttr(obj)+" >"+reqhtml,"</div>"].join("")},getCustomAttr:function(cobj){cobj.options;var name=getEscapedText(cobj.name)||"",hint=getEscapedText(cobj.hint)||name,validate=$.parseJSON(cobj.required)?"required":"optional",type=cobj.type?cobj.type:"text",maxlength=cobj.maxlength||"url"==cobj.type||"textarea"==cobj.type?100:30,validateattr=validate+" "+type;return'placeholder="'+hint+'" id="'+name+'" mandatory="'+cobj.required+'" custom="'+name+'" name="'+name+'" data-validate="'+validateattr+'" autocomplete="off" maxlength="'+maxlength+'" info="'+type+'"'},getCDropDwnHTML:function(cobj){var name=getEscapedText(cobj.name)||"";return'<div><div class="fld_labl">'+name+'</div><div id="sqico-cdrpdwn'+cobj.index+'" class="sqico-drpdwn siq-dropdown" customid="'+name+'" custombx="true" custom="'+name+'" type="selectbox" visibility="'+cobj.visibility+'" purpose="custom" '+this.getCustomAttr(cobj)+"></div></div>"},getCTextareaHTML:function(obj){var name=getEscapedText(obj.name)||"",reqhtml=JSON.parse(obj.required)?'<em class="req siq-required" title="'+LSResource.getRealValue("ne.required")+'"></em>':"";return['<div custom="'+name+'" custombx="true" customid="'+name+'"  type="'+obj.type+'"  visibility="'+obj.visibility+'">','<textarea type="text" docblur="custominput" visibility="'+obj.visibility+'" purpose="custom" '+this.getCustomAttr(obj)+" ></textarea>"+reqhtml,"</div>"].join("")},getCLabelHTML:function(obj){return['<div class="subtitle" customid="'+(getEscapedText(obj.name)||"")+'" custombx="true">'+getEscapedText(obj.hint)+"</div>"].join("")},getCloseHTML:function(){return'<em class="sqico-close siq-close-icon" documentclick="close_iframe" title="'+LSResource.getRealValue("common.close")+'"></em>'},getChatEndHTML:function(){var eobj=$Support.EmbedObj;return['<div class="infomsg chtend siq-info-message">'+LSResource.getRealValue("ne.chatend",'documentclick="restartchat"'),'<div class="chtlnks">',JSON.parse(eobj.eprops.icmail)?'<a href="javascript:;" class="sqico-smailico" documentclick="sendmail" id="chatendmail" chid="'+eobj.chatID+'" visitorid="'+eobj.visitorID+'">'+LSResource.getRealValue("ne.email.transcript")+"</a>":"","</div>","</div>"].join("")},getBusnsInfoHTML:function(val){return["<div>"+LSResource.getRealValue("ne.offlinemsg")+"</div>","<div>"+LSResource.getRealValue("ne.busnshr")+' : <em class="fnt13">Monday to Friday '+val+"</em></div></div>"].join("")},getGroupIconHTML:function(){return'<span class="sqico-grpico"></span>'},getWaitHandlerHTML:function(){return['<div class="waitmsg" id="cwaitmsg">'+$Support.cwaitmsg,"</div>"].join("")},getConversationContainerHTML:function(){return['<section class="siqc_body sli_view siq_content" id="conversioncontainer" style="display:none;"><div id="currchatconv"></div><div id="pastchatconv"></div></section>'].join("")},getConversationHistoryHTML:function(conv){$Support.EmbedObj;var agentphotourl=conv.attender_imgkey?_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+conv.attender_imgkey+"/photo.ls?nocache=1":"",attender=conv.attender,statuscls="";conv.chid||conv.attender?conv.attender||(attender=LSResource.getRealValue("conversation.missedchat"),statuscls=" sqico-missed"):(attender=LSResource.getRealValue("conversation.offlinechat"),statuscls=" sqico-offline");var lastmsg=Message.getDisplayContent(conv.question),islastmsgbyvisitor=!1,fileclstype="";if(conv.lastmsg){var lastmsgobj=JSON.parse(conv.lastmsg);if(islastmsgbyvisitor=$Support.Util.isAnnonUser(lastmsgobj.sender),lastmsgobj=lastmsgobj.msg){if("object"==typeof lastmsgobj)"cannedarticle"===lastmsgobj.mode?lastmsg=$FAQ.getHeaderMessage(lastmsgobj.msg):lastmsgobj.fName&&(lastmsg=lastmsgobj.fName,fileclstype=$Support.Util.getFileClassType(lastmsgobj.content));else if(lastmsg=Message.getDisplayContent(lastmsgobj),lastmsg=Markdown.apply(lastmsg),lastmsg=Message.format(lastmsg),"string"==typeof lastmsgobj)try{JSON.parse(JSON.parse(lastmsgobj).mode&&"AVCALL"===JSON.parse(lastmsgobj).mode)&&(lastmsg=Message.getAVMessageBlock(JSON.parse(lastmsgobj),!0))}catch(e){}lastmsg=fileclstype?'<em class="'+fileclstype+'">'+lastmsg+"</em>":lastmsg,lastmsg=islastmsgbyvisitor?LSResource.getRealValue("common.you")+": "+lastmsg:lastmsg}}return['<div class="siqc_cntbody" '+(conv.chid?'chid="'+conv.chid+'"':"")+' visitorid="'+conv.visitorid+'" documentclick="fetchconvtranscript">','<div class="siqc_usrimg'+statuscls+'">','<img class="'+(conv.isbotattender?"conv_boticn":"")+'" src="'+agentphotourl+'"><div class="sqico-user convrstn-usr wincustom_bg"></div>',"</div>",'<div class="siqc_msg">','<span class="txtelips">'+getEncodedText(attender)+"</span>",'<p id="desc7" class="siqc_cusmsg">'+lastmsg+"</p>","</div>",'<div id="status7" class="siqc_duration" convmtime="'+conv.endtime+'">'+MyDate.timeDifference(conv.endtime)+'<em class="siqc_eletype"></em></div>',"</div>"].join("")},getCallFAQHtml:function(){return'<div id="showsiqchatui" class="siqc_edt zsiq-faqcal textC" style="display:none;"><div class="siq-fcal sqico-bubchat" documentclick="showchatui"></div> <div class="siq-fcal sqico-call" onclick="CallImpl.startCall()"></div><div class="siq-fcal sqico-chat" ></div></div>'},getConversationCreateChatIConHTML:function(){return'<aside class="siqc_edt sqico-createchat wincustom_bg" id="showsiqchatui" documentclick="showchatui" title="'+LSResource.getRealValue("conversation.newconversation")+'" style="display:none;"></aside>'},getConversationTranscriptContainerHTML:function(){var eobj=$Support.EmbedObj;return['<section class="siqc_hstrycht siq_content '+($Support.isSignature(eobj)?" algn_hgt":"")+'" style="display:none;">',"</section>"].join("")},getLoadingHTML:function(){return'<div class="siqc-progress siqc-float siqc-shadow" id="convloadingui"><div class="siqc-progress-item"></div></div>'},getConversationListLoadingHTML:function(){return'<div class="siqc_cntbody siqc-loader" id="convlistloading"><div class="siqc-progress siqc-float"><div class="siqc-progress-item"></div></div></div>'},getchatWaitingUIinConversation:function(){var eobj=$Support.EmbedObj;return['<div class="siqc_cntbody" id="conv'+eobj.chatID+'" chid="'+eobj.chatID+'" visitorid="'+eobj.visitorID+'" documentclick="showchatui">','<div class="siqc_usrimg">','<img id="convchatattenderimg" src="">','<div class="sqico-user convrstn-usr wincustom_bg"></div>',"</div>",'<div class="siqc_msg">','<span id="convchatattendername" class="txtelips"></span>','<p id="convmsg" class="siqc_cusmsg">'+getEscapedText(eobj.question)+"</p>","</div>",'<div class="siqc_duration"><em id="convwtime"></em><span><em class="siqc_eletype"></em></span></div>',"</div>"].join("")},getPopUpMessageInconversation:function(sender,msg,senderimgsrc){return['<div class="proactv_chat" id="convpopupmsg" documentclick="showchatui">','<div class="siqc_usrimg">','<img src="'+senderimgsrc+'">','<div class="sqico-user convrstn-usr wincustom_bg"></div>',"</div>",'<div class="siqc_msg">','<span class="txtelips">'+sender+'</span><p id="desc1" class="siqc_cusmsg">'+msg+"</p>","</div>",'<em class="sqico-clear" id="removeconvpopup" documentclick="removeconvpopupmsg" title="'+LSResource.getRealValue("common.close")+'"></em>',"</div>"].join("")},getPopUpAlertInconversation:function(sender,msg,alerttime,senderimgsrc){return['<div class="proactv_chat" id="convpopupmsg" documentclick="showchatui">','<div class="siqc_usrimg">','<img src="'+senderimgsrc+'">','<div class="sqico-user convrstn-usr wincustom_bg"></div>',"</div>",'<div class="siqc_msg">','<span class="txtelips">'+sender+'</span><p id="desc1" class="siqc_cusmsg">'+msg+"</p>",'<div id="alerttimer" class="siqc_duration">'+alerttime+"</div>","</div>",'<em class="sqico-clear" id="removeconvpopup" documentclick="removeconvpopupmsg" title="'+LSResource.getRealValue("common.close")+'"></em>',"</div>"].join("")},getPopUPInfoMessageInConversation:function(msg){return['<div class="proactv_chat" id="convpopupmsg" documentclick="showchatui">','<div class="siqc_msg">','<p id="desc1" class="siqc_cusmsg">'+msg+"</p>","</div>",'<em class="sqico-clear" id="removeconvpopup" documentclick="removeconvpopupmsg" title="'+LSResource.getRealValue("common.close")+'"></em>',"</div>"].join("")},getOutgoingcallUI:function(url,name){var img="",prsnimg="";return null==url||""==url?prsnimg="<em class='sqico-person'></em>":img="<img src="+(url=url.split("?")[0])+">",null==name&&(name=""),['<div class="zsembd_audiocl textC">','<nav class="zsembd_usrprof zsembd_calrng">','<div class=" sqico-personimg">',img,prsnimg,"</div>","</nav>",'<span class="zsembd_adodesc txtelips">'+name+'<em class="txtelips font14">'+LSResource.getRealValue("av.info.calling")+"</em></span>",'<div class="cal_actns">','<div id="audiocall_mute" class="sqico-microphone" onclick="avimpl.toggleMute(this)"></div>','<div class="sqico-call reject-cal" onclick="avimpl.terminateAudioCall();"></div></div>',"</div>"].join("")},getReconnectionUI:function(url,type){var perscls="",img="";return null==url||""==url?perscls="sqico-person":img="<img src="+(url=url.split("?")[0])+">",['<div class="zsembd_audiocl textC reconnect" id="call_reconnection">','<nav class="zsembd_usrprof">','<div class="'+perscls+' sqico-personimg">',img,"</div>","</nav>",'<span class="zsembd_adodesc txtelips">'+$Support.EmbedObj.attendername+'<em class="txtelips font14">'+LSResource.getRealValue(type)+"</em></span>",'<div class="cal_actns">','<div id="audiocall_mute" class="sqico-microphone" onclick="avimpl.toggleMute(this)"></div>','<div class="sqico-call reject-cal" onclick="avimpl.terminateAudioCall();"></div></div>',"</div>"].join("")},getUserBusyUI:function(url){var perscls="",img="";return null==url||""==url?perscls="sqico-person":img="<img src="+(url=url.split("?")[0])+">",['<div class="zsembd_audiocl textC" id="call_Busy">','<em class="sqico-close" onclick="avimpl.clear();"></em>','<nav class="zsembd_usrprof">','<div class="'+perscls+' sqico-personimg">',img,"</div>","</nav>",'<span class="zsembd_adodesc txtelips">'+$Support.EmbedObj.attendername+'<em class="txtelips font14">'+LSResource.getRealValue("av.info.userbusy")+"</em></span>",'<div class="cal_actns">','<div class="sqico-record" onclick="avimpl.showAudioRecorder();"></div>','<div class="sqico-call" onclick="avimpl.startCall();"></div></div>',"</div>"].join("")},getAudioCallUI:function(url){var img="",prsnimg="";return null==url||""==url?prsnimg="<em class='sqico-person'></em>":img="<img src="+(url=url.split("?")[0])+">",['<div class="zsembd_audiocl textC">','<nav class="zsembd_usrprof zsembd_calrng">','<div class="sqico-personimg">',img,prsnimg,"</div>","</nav>",'<span class="zsembd_adodesc txtelips"><em class="txtelips font14">'+LSResource.getRealValue("av.info.callfrom")+"</em>"+$Support.EmbedObj.attendername+"</span>",'<div class="cal_actns">','<div class="sqico-call" onclick="avimpl.acceptCallInvite();"></div>','<div class="sqico-call reject-cal" onclick="avimpl.rejectCallInvite();"></div></div>',"</div>"].join("")},getOnCallUI:function(url){var perscls="",img="";return null==url||""==url?perscls="sqico-person":img="<img src="+(url=url.split("?")[0])+">",['<div class="zsembd_audiocl textC">','<nav class="zsembd_usrprof\t">','<div class="'+perscls+' sqico-personimg" >',img,"</div>","</nav>",'<span class="zsembd_adodesc txtelips">'+$Support.EmbedObj.attendername+'<em class="txtelips font14" id="sqico-timer"></em></span>','<div class="cal_actns">','<div id="audiocall_mute" class="sqico-microphone" onclick="avimpl.toggleMute(this)"></div>','<div class="sqico-call reject-cal" onclick="avimpl.stopOngoingCall();"></div></div>',"</div>"].join("")},getStartRecordUI:function(url){var img="";return null==url||""==url?img="<img src="+url+">":"<em class='sqico-person'></em>",['<div class="zsembd_audiocl textC">','<nav class="zsembd_usrprof">','<div class=" sqico-personimg">',img,"</div>","</nav>",'<span class="zsembd_adodesc txtelips">'+$Support.EmbedObj.attendername+'<em class="txtelips font14" id="sqico-timer"></em></span>','<div class="embed-calrec"></div>','<div class="cal_actns">',"</div>"].join("")},getAudioRecordedUI:function(url){var img="";return null==url||""==url?img="<img src="+url+">":"<em class='sqico-person'></em>",['<div class="zsembd_audiocl textC">','<em class="sqico-close" cntrl="cancelRecord"></em>','<nav class="zsembd_usrprof">','<div class=" sqico-personimg">',img,"</div>","</nav>",'<span class="zsembd_adodesc txtelips">'+$Support.EmbedObj.attendername+'<em class="txtelips font14" id="sqico-timer"></em></span>','<div class="embd-calrec" id="sqico-canvas"></div>','<div class="cal_actns">','<div class="sqico-record" cntrl="settings"></div>','<div class="sqico-play" cntrl="playRecord"></div>','<div class="sqico-videosend" cntrl="stopRecord"></div></div>',"</div>"].join("")},getTranslateBannerHTML:function(dname){return['<div class="gltr-cont" id="consentbannerdiv" cattr="gtranslateconsent" ><span class="gltr-desc">'+(40<dname.length?'<div class="txtelips">'+dname+" </div>":dname+" ")+LSResource.getRealValue("common.gdpr.translatedesc")+"<em> "+LSResource.getRealValue("common.gdpr.gtranslatehead")+'<div class="gltr-bgimg"></div></em></span><div class="gltr-done"><div documentclick="updatetranslatecookie" >OK</div></div></div>'].join("")}}}(window);function avimpl(){}function successCreateAnswer(SessionDescription){avimpl.pc.setLocalDescription(SessionDescription);var callurl=$Support.getAjaxURL("makeav",dext),dataval={};dataval.wmsid=$Support.EmbedObj.vwmsid,dataval.chid=$Support.EmbedObj.chatID,dataval.lsuid=$Support.EmbedObj.attender,dataval.session=CommonUtil.toJSON(SessionDescription),dataval.type=SessionDescription.type,dataval.version="v3",dataval.action="connectwithpeer",$.ajax({url:callurl,data:dataval,type:"POST"})}function sdrag(onDrag,onStop){var startX=0,startY=0,el=this,dragging=!1;function move(e){if($(".zsembd_audiocl").css("left")<"0"||$(".zsembd_audiocl").css("top")<"0")return $(".zsembd_audiocl").css("left")<"0"&&(el.style.left="0px"),$(".zsembd_audiocl").css("top")<"0"&&(el.style.top="0px"),dragging=!1,void window.removeEventListener("mousemove",move);if($(".zsembd_audiocl").css("right")<"0"||$(".zsembd_audiocl").css("bottom")<"0"){var leftpos=e.pageX-startX,rightpos=e.pageY-startY;return el.style.left=leftpos-10+"px",el.style.top=rightpos-10+"px",dragging=!1,void window.removeEventListener("mousemove",move)}el.style.left=e.pageX-startX+"px",el.style.top=e.pageY-startY+"px"}this.addEventListener("mousedown",function(e){dragging=!0;var left=el.style.left?parseInt(el.style.left):$(".zsembd_audiocl").css("left").replace("px",""),top=el.style.top?parseInt(el.style.top):$(".zsembd_audiocl").css("top").replace("px","");startX=e.pageX-left,startY=e.pageY-top,window.addEventListener("mousemove",move)}),window.addEventListener("mouseup",function(e){!0===dragging&&(dragging=!1,window.removeEventListener("mousemove",move))})}avimpl.setCredentials=function(data){avaction.setCredentials(data),avimpl.avparams=["newcandidate","connection_estb","chid","wmsid","mutestate","reconnecttime","callincoming","mediaStream","curr_status"],avimpl.attenderimgurl=_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+$Support.EmbedObj.attenderimagefkey+"/photo.ls?nps=404"},avimpl.showInvitation=function(data){if(avimpl.audiorecorder&&avimpl.audiorecorder.destroy(),CallImpl.isCallWithChat){avimpl.curr_status="incomingcall",CallImpl.updateUI(AV_INCOMINGCALL),avimpl.acceptCallInvite("apicall");var obj={attenderemail:$Support.EmbedObj.attenderemail};$Support.Util.handleCallbacks("call.attended",obj)}else{$Support?$Support.getParent().$ZSIQChatWindow.openChatWindow():$ZSIQChatWindow.openChatWindow(),avimpl.attenderimgurl=_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+$Support.EmbedObj.attenderimagefkey+"/photo.ls?nps=404",Message.handleBlinkTitle(LSResource.getRealValue("av.info.call.tabinfo")),EmbedSound.play("incomingcall",60);data.msg.sender,data.msg.receiver,data.msg.entityid;avimpl.agentID=data.msg.sender,$("#audiocall").addClass("cmn_disable"),avimpl.checkAndAppendUI($Temp.getAudioCallUI(avimpl.attenderimgurl)),avimpl.callincoming=!0,avaction.TYPE=data.msg.type,"null"==data.msg.type&&(avaction.TYPE="AUDIO"),"SCREEN_SHARE"===data.msg.type?avaction.TYPE="SCREEN_VIEW":"SCREEN_VIEW"===data.msg.type&&(avaction.TYPE="SCREEN_SHARE")}},avimpl.acceptCallInvite=function(type){var chid=$Support.EmbedObj.chatID;avimpl.callincoming=!1,$(".zsembd_audiocl").remove(),avimpl.checkAndAppendUI($Temp.getReconnectionUI(avimpl.attenderimgurl,"av.info.connecting")),avimpl.curr_status="connecting",CallImpl.updateUI(AV_CONNECTING);var url=$Support.getAjaxURL("makeav",dext),dataval={};dataval.chid=chid,dataval.wmsid=$Support.EmbedObj.vwmsid,dataval.mode=AUDIOCALL,dataval.lsuid=$Support.EmbedObj.attender,"apicall"==type&&(dataval.department=$Support.EmbedObj.department),dataval.action="accepted",dataval.version="v3",$.ajax({url:url,data:dataval,type:"POST"}),EmbedSound.stop(),clearInterval(avimpl.intervaltime)},avimpl.handleCallTermination=function(){LSDebugger.postDebugInfo("Audio Call_v - inside handlecallterminated chatid "+avimpl.chid,null,null,!0),$(".zsembd_audiocl").remove(),$("#audiocall").removeClass("cmn_disable")},avimpl.rejectCallInvite=function(){EmbedSound.stop();var url=$Support.getAjaxURL("makeav",dext);$(".zsembd_audiocl").remove();var dataval={};dataval.chid=$Support.EmbedObj.chatID,dataval.wmsid=$Support.EmbedObj.vwmsid,dataval.mode=AUDIOCALL,dataval.lsuid=$Support.EmbedObj.attender,dataval.action="rejected",dataval.version="v3",$.ajax({url:url,data:dataval,type:"POST"}),$("#audiocall").removeClass("cmn_disable"),clearInterval(avimpl.intervaltime),avimpl.chid=avimpl.wmsid=avimpl.mutestate=avimpl.newcandidate=avimpl.connection_estb=null},avimpl.incrementRetryCount=function(){if(LSDebugger.postDebugInfo("Audio Call_v - inside Retry count | count "+avimpl.reconnect_count+"| chid |"+avimpl.chid,null,null,!0),2<avimpl.reconnect_count)return avimpl.stopOngoingCall(),void avimpl.clear();avimpl.reconnect_count++},avimpl.addAudioElemts=function(){if(avimpl.checkAndAppendUI($Temp.getReconnectionUI(avimpl.attenderimgurl,"av.info.connecting")),avimpl.curr_status="connecting",CallImpl.updateUI(AV_CONNECTING),EmbedSound.stop(),"VIDEO"!=avaction.TYPE){localAudio=document.createElement("audio");var audiodiv=document.createElement("div");return audiodiv.id="zaudiodiv",audiodiv.style.position="relative",localAudio.id="localaudio",localAudio.autoplay=!0,audiodiv.appendChild(localAudio),void $("body").append(audiodiv)}var localVideo=document.createElement("video"),videodiv=document.createElement("div");videodiv.id="zvideodivs",videodiv.className="zvideodiv",videodiv.style.position="relative",localVideo.id="localvideo",localVideo.autoplay=!0,localVideo.src=window.URL.createObjectURL(avimpl.localStream),videodiv.appendChild(localVideo);var parentdiv=document.createElement("div");parentdiv.id="siqvideo",parentdiv.appendChild(videodiv),$(window.parent.document).find("body").append(parentdiv),$(window.parent.document).find("#siqvideo").append("<em class='siqhdr_icon' id='siq_videomin'>-</em>"),$("#siq_videomin",parent.document).on("click",function(){$(window.parent.document).find("#siqvideo").toggleClass("siq_minvideo")})},avimpl.callConnected=function(){LSDebugger.postDebugInfo("Audio Call_v - inside call connected| chid |"+avimpl.chid+" | reconect time "+avimpl.reconnecttime,null,null,!0),EmbedSound.stop(),avimpl.active=!0,avimpl.curr_status="ongoing",CallImpl.updateUI(AV_ONGOING),clearInterval(avimpl.reconnectinterval),clearInterval(avimpl.ApiCalltimer),$(".zsembd_audiocl").remove(),0!==avimpl.reconnecttime&&null!==avimpl.reconnecttime&&void 0!==avimpl.reconnecttime||(avimpl.starttime=Date.now()),avimpl.checkAndAppendUI($Temp.getOnCallUI(avimpl.attenderimgurl)),void 0!==avimpl.reconnecttime&&null!==avimpl.reconnecttime||(avimpl.reconnecttime=0),avimpl.handleTimerUI(),(avimpl.reconnecttime=0)==avimpl.mutestate&&(avimpl.localStream.getAudioTracks()[0].enabled=!avimpl.localStream.getAudioTracks()[0].enabled,$("#audiocall_mute").removeClass("sqico-microphone").addClass("sqico-muteaudio")),clearTimeout(avimpl.timer),$Support.LSDB.remove("ZLD_ApiAVCall")},avimpl.callFailure=function(type){LSDebugger.postDebugInfo("Audio Call_v - inside call failure| chid |"+avimpl.chid+" | reconect time "+avimpl.reconnecttime+" |type "+type,null,null,!0);var sdpConstraints={mandatory:{OfferToReceiveAudio:!0}};avimpl.handleCallTermination(),$(".zsembd_audiocl").remove(),avimpl.reconnecttime=(Date.now()-avimpl.starttime)/1e3,avimpl.checkAndAppendUI($Temp.getReconnectionUI(avimpl.attenderimgurl,"av.info.reconnecting")),avimpl.curr_status="reconnecting",CallImpl.updateUI(AV_RECONNECTING),type==UPSTREAM?(avimpl.reconnect_count=1,avimpl.pc.createOffer().then(avimpl.successOffer,avaction.sendLog,sdpConstraints),avimpl.reconnectinterval=setInterval(function(){avimpl.pc.createOffer().then(avimpl.successOffer,avaction.sendLog,sdpConstraints),avimpl.incrementRetryCount()},1e4)):setTimeout(function(){avimpl.stopOngoingCall(),avimpl.clear()},3e4)},avimpl.addcandidate=function(event){if(event.candidate){var candidate={};candidate.label=event.candidate.sdpMLineIndex,candidate.id=event.candidate.sdpMid,candidate.candidate=event.candidate.candidate,candstring=CommonUtil.toJSON(candidate);var dataval={action:"candidate"};dataval.wmsid=$Support.EmbedObj.vwmsid,dataval.lsuid=$Support.EmbedObj.attender,dataval.chid=$Support.EmbedObj.chatID,dataval.candidate=candstring,dataval.version="v3",$.ajax({url:$Support.getAjaxURL("makeav",dext),data:dataval,type:"POST"})}},avimpl.addremotestream=function(event){try{if("AUDIO"==avaction.TYPE||"SCREEN_SHARE"==avaction.TYPE){remoteAudio=document.createElement("audio");var audiodiv=document.getElementById("zaudiodiv");remoteAudio.id="remoteaudio",remoteAudio.autoplay=!0,audiodiv.appendChild(remoteAudio),$("body").append(audiodiv);var stream=event.stream;return event.streams&&(stream=event.streams[0]),"Chrome"===avimpl.hostbrowser||"Firefox"===avimpl.hostbrowser?remoteAudio.src=window.URL.createObjectURL(stream):remoteAudio.srcObject=stream,void(avimpl.remoteStream=stream)}stream=event.stream;event.streams&&(stream=event.streams[0]);var localVideo=document.createElement("video"),videodiv=document.createElement("div");if(videodiv.id="zvideodiv",videodiv.className="zvideodiv",videodiv.style.position="relative",localVideo.id="remotevideo",localVideo.autoplay=!0,localVideo.src=window.URL.createObjectURL(stream),avimpl.remoteStream=stream,videodiv.appendChild(localVideo),!$(window.parent.document).find("#siqvideo").length){var parentdiv=document.createElement("div");parentdiv.id="siqvideo",$(window.parent.document).find("body").append(parentdiv)}$(window.parent.document).find("#siqvideo").append(videodiv)}catch(e){LSDebugger.postDebugInfo("Audio Call - Failed in Addremote session | Exception "+e+" | chid "+avimpl.chid,null,null,!0)}},avimpl.successOffer=function(SessionDescription){avimpl.pc.setLocalDescription(SessionDescription);var callurl=$Support.getAjaxURL("makeav",dext),dataval={};dataval.wmsid=$Support.EmbedObj.vwmsid,dataval.chid=$Support.EmbedObj.chatID,dataval.lsuid=$Support.EmbedObj.attender,dataval.session=CommonUtil.toJSON(SessionDescription),dataval.type=SessionDescription.type,dataval.version="v3",dataval.action="connectwithpeer",$.ajax({url:callurl,data:dataval,type:"POST"})},avimpl.toggleMute=function(curr){var muteicon=$(curr);avimpl.localStream&&(avimpl.localStream.getAudioTracks()[0].enabled=!avimpl.localStream.getAudioTracks()[0].enabled),-1!==muteicon.attr("class").indexOf("sqico-muteaudio")?(avimpl.mutestate=!0,$("#audiocall_mute").removeClass("sqico-muteaudio").addClass("sqico-microphone")):(avimpl.mutestate=!1,$("#audiocall_mute").removeClass("sqico-microphone").addClass("sqico-muteaudio"))},avimpl.stopOngoingCallOnChatEnding=function(){for(var elms=document.querySelectorAll("#audio_callagain"),i=0;i<elms.length;i++)elms[i].style.display="none";if($("#audiocall").css("display","none"),avimpl.hideCallIcon=!1,!avimpl.active)return $(".zsembd_audiocl").remove(),void avimpl.clear();avimpl.stopOngoingCall()},avimpl.stopOngoingCall=function(){if(avimpl.active){var dataval={},callurl=$Support.getAjaxURL("makeav",dext);dataval.action="endcall",dataval.wmsid=$Support.EmbedObj.vwmsid,dataval.chid=$Support.EmbedObj.chatID,dataval.cuid=$Support.EmbedObj.visitorID,dataval.duration=Date.now()-avimpl.starttime,dataval.lsuid=$Support.EmbedObj.attender,dataval.version="v3",avimpl.showRejectedBanner(),$.ajax({url:callurl,data:dataval,type:"POST"}),LSDebugger.postDebugInfo("Audio Call_v - Stop on going call| chid |"+avimpl.chid+" | reconect time "+avimpl.reconnecttime,null,null,!0),avimpl.clear()}},avimpl.endOnReload=function(){var dataval={},callurl=$Support.getAjaxURL("makeav",dext);dataval.action="endcall",dataval.wmsid=$Support.EmbedObj.vwmsid,dataval.chid=$Support.EmbedObj.chatID,dataval.cuid=$Support.EmbedObj.visitorID,dataval.duration=Date.now()-avimpl.starttime,dataval.lsuid=$Support.EmbedObj.attender,dataval.version="v3",avimpl.showRejectedBanner(),$.ajax({url:callurl,data:dataval,type:"POST"}),avimpl.clear()},avimpl.startCall=function(){$("#audiocall").hasClass("cmn_disable")||("SCREEN_SHARE"===avaction.TYPE&&window.webkitRTCPeerConnection?window.parent.$ZSIQUtil.getSourceID():avaction.checkMediaPermission())},avimpl.StartAfterMediaPermission=function(){var chid=$Support.EmbedObj.chatID;avimpl.curr_status="outgoing",CallImpl.updateUI(AV_OUTGOINGCALL),EmbedSound.play("outgoingcall",60),avimpl.attenderimgurl=_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+$Support.EmbedObj.attenderimagefkey+"/photo.ls?nps=404";var dataval={};dataval.wmsid=$Support.EmbedObj.vwmsid,dataval.chid=chid,dataval.action="initiate",dataval.type=avaction.TYPE,dataval.mode=AUDIOCALL,dataval.cuid=$Support.EmbedObj.visitorID,dataval.lsuid=$Support.EmbedObj.attender,dataval.version="v3",$.ajax({url:$Support.getAjaxURL("makeav",dext),data:dataval,type:"POST"}),$Support.LSDB.remove("avcallstatus_"+chid),$Support.LSDB.set("avcallstatus_"+chid,!0,5e4),$("#audiocall").addClass("cmn_disable"),$(".zsembd_audiocl").remove(),avimpl.startTimer(),avimpl.checkAndAppendUI($Temp.getOutgoingcallUI(avimpl.attenderimgurl,$Support.EmbedObj.attendername))},avimpl.terminateAudioCall=function(isapicall){-1==$Support.EmbedObj.chatID&&isapicall&&(CallImpl.CallFailed=!0);var dataval={};dataval.mode=AUDIOCALL,dataval.lsuid=$Support.EmbedObj.attender,dataval.department=$Support.EmbedObj.department,dataval.wmsid=$Support.EmbedObj.vwmsid,dataval.chid=$Support.EmbedObj.chatID,isapicall&&(dataval.isapicall=!0),dataval.action="terminated",dataval.version="v3",$.ajax({url:$Support.getAjaxURL("makeav",dext),data:dataval,type:"POST"}),$Support.LSDB.get("ZLD_ApiAVCall")&&($Support.LSDB.remove("ZLD_ApiAVCall"),$Support.requestRunning_missedvisitor=!1,clearTimeout($Support.waitTimer),clearTimeout(avimpl.ApiCalltimer),delete $Support.waitingtime,$Support.removeCookie("ZLD"+$Support.EmbedObj.livelsid+"WAITING"),$Support.handleMissed("CALLENDED","2",!0)),avimpl.curr_status=null,avimpl.clear(),$Support.LSDB.remove("avcallstatus_"+$Support.EmbedObj.chatID);var obj={attenderemail:$Support.EmbedObj.attenderemail};$Support.Util.handleCallbacks("call.cancelled",obj),CallImpl.updateUI(AV_CALLAGAIN)},avimpl.startTimer=function(){clearTimeout(avimpl.timer),avimpl.timer=setTimeout(function(){LSDebugger.postDebugInfo("Audio Call_v - Call missed | chid |"+avimpl.chid+" | reconect time "+avimpl.reconnecttime,null,null,!0);var callurl=$Support.getAjaxURL("makeav",dext),dataval={};dataval.wmsid=$Support.EmbedObj.vwmsid,dataval.chid=$Support.EmbedObj.chatID,dataval.mode=AUDIOCALL,dataval.lsuid=$Support.EmbedObj.attender,dataval.action="missed",dataval.version="v3",$.ajax({url:callurl,data:dataval,type:"POST"}),avimpl.clear(),avimpl.handleUserBusy(),$Support.LSDB.remove("avcallstatus_"+$Support.EmbedObj.chatID)},5e4)},avimpl.handleUserBusy=function(){LSDebugger.postDebugInfo("Audio Call_v - Handle call busy| chid |"+avimpl.chid+" | reconect time "+avimpl.reconnecttime,null,null,!0),CallImpl.updateUI(AV_USERBUSY),avimpl.curr_status="userbusy",EmbedSound.stop(),avimpl.checkAndAppendUI($Temp.getUserBusyUI(avimpl.attenderimgurl))},avimpl.showAudioRecorder=function(){document.querySelector(".zsembd_audiocl").remove(),avimpl.isAudioRecordingSupported()?(avimpl.audiorecorder&&avimpl.audiorecorder.destroy(),avimpl.checkAndAppendUI($Temp.getAudioRecordedUI(avimpl.attenderimgurl)),avimpl.audiorecorder=Recorder("HeadShotAudioRecord"),avimpl.audiorecorder.init()):avimpl.terminateAudioCall()},avimpl.isAudioRecordingSupported=function(){return window.AudioContext=window.AudioContext||window.webkitAudioContext,window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.AudioContext&&navigator.getUserMedia&&window.URL&&window.Worker||(support=!1),!0},avimpl.showRejectedBanner=avimpl.endCall=avimpl.clear=function(){LSDebugger.postDebugInfo("Audio Call_v - Clear call| chid |"+avimpl.chid+" | reconect time "+avimpl.reconnecttime,null,null,!0);var closeTracksInStream=function(mediastream){var tracks=mediastream.getTracks();for(var i in tracks)tracks[i].stop()};for(i in avimpl.pc&&avimpl.pc.close(),avimpl.localStream&&closeTracksInStream(avimpl.localStream),avimpl.remoteStream&&closeTracksInStream(avimpl.remoteStream),avimpl.mediaStream&&closeTracksInStream(avimpl.mediaStream),EmbedSound.stop(),$("#zaudiodiv").remove(),$(window.parent.document).find("#siqvideo").remove(),$("#call_reconnection").remove(),$(".zsembd_audiocl").remove(),$("#audiocall").removeClass("cmn_disable"),$Support.LSDB.remove("ZLD_ApiAVCall"),avimpl.active=!1,$Support.getParent().$ZSIQWidgetUI.removeCallUI(),$Support.LSDB.remove("av_call"),avimpl.avparams)avimpl[avimpl.avparams[i]]=null;clearInterval(avimpl.intervaltime),clearInterval(avimpl.reconnectinterval),clearTimeout(avimpl.timer),clearTimeout(avimpl.ApiCalltimer),$Support.requestRunning_visitorfeedback=!1},avimpl.handleTimerUI=function(){avimpl.reconnecttime=isNaN(avimpl.reconnecttime)?0:avimpl.reconnecttime;var minutes,seconds,timer=avimpl.reconnecttime;clearInterval(avimpl.intervaltime),avimpl.intervaltime=setInterval(function(){minutes=parseInt(timer/60,10),seconds=parseInt(timer%60,10),minutes=minutes<10?"0"+minutes:minutes,seconds=seconds<10?"0"+seconds:seconds;for(var elms=document.querySelectorAll("#sqico-timer"),i=0;i<elms.length;i++)elms[i].textContent=minutes+":"+seconds;timer++},1e3)},avimpl.checkAttenderBrowser=function(useragent){var attender_useragent=$Support.EmbedObj.attenderuseragent;return useragent&&(attender_useragent=useragent.attender_useragent),!!attender_useragent&&(!!(attender_useragent.match(/Android/i)||attender_useragent.match(/webOS/i)||attender_useragent.match(/iPhone/i)||attender_useragent.match(/iPad/i)||attender_useragent.match(/iPod/i)||attender_useragent.match(/BlackBerry/i)||attender_useragent.match(/Windows Phone/i))||(!(!attender_useragent||!avaction.isBrowserSupported(attender_useragent))||void $("#audiocall").remove()))},avimpl.handleMinimizeState=function(){avimpl.active||avimpl.callincoming?($Support.getParent().$ZSIQWidgetUI.updateCallUI(),avimpl.callincoming?$Support.getParent().$ZSIQWidgetUI.updateIncomingCallUI():$Support.getParent().$ZSIQWidgetUI.removeIncomingCallUI()):$Support.getParent().$ZSIQWidgetUI.removeCallUI()},avimpl.checkMediaPermission=function(message,chid){$Support.Util.displayInfo(message),setTimeout(function(){$("#info_banr").remove()},1e4),avimpl.clear(),avimpl.chid=chid},Element.prototype.sdrag=sdrag,avimpl.checkAndAppendUI=function(html){CallImpl.isCallWithChat||($("body").append(html),document.getElementsByClassName("zsembd_audiocl")[0].sdrag())},avimpl.handleStartChat=function(data){CallImpl.isCallWithChat=!1;var msg=JSON.parse(data.msg.msg);"startchat"!==msg.action||msg.isvisitoraccess||window.parent._ZSIQ.JSAPI.broadcastMessage("chatstart",{})},avimpl.checkOngoingCall=function(){$Support.LSDB.get("av_call")?($Support.LSDB.remove("av_call"),CallImpl.isCallWithChat=!0,$Support.quitChat()):$Support.LSDB.get("avcallstatus_"+$Support.EmbedObj.chatID)&&avimpl.terminateAudioCall(),avimpl.checkCallIcon()},avimpl.checkCallIcon=function(){if(avimpl.hideCallIcon){$("#audiocall").css("display","none");for(var calltext=document.querySelectorAll("#audio_callagain"),i=0;i<calltext.length;i++)calltext[i].style.display="none"}},avimpl.checkAudioCallButton=function(){var msgmaindiv=$Support.contentdiv.find("#msgmaindiv");Object.keys(SUPPORT_REPS).length;msgmaindiv.length&&$Support.isChatExist()?$("#audiocall").show():$("#audiocall").hide()},avimpl.shareScreen=function(){avaction.TYPE="SCREEN_SHARE",this.startCall()};function CallImpl(){}var AV_INCOMINGCALL=1,AV_OUTGOINGCALL=2,AV_CONNECTING=3,AV_ONGOING=4,AV_RECONNECTING=5,AV_USERBUSY=6,AV_BODY=7,AV_CALLAGAIN=8,AV_RATING=9,AV_FDBCK=10,AV_FDBCKSUCCESS=11,AV_RATINGSUCCESS=12,AV_FDBKRATINGSUCCESS=13,AV_STARTRECORD=14,AV_RECORDING=15,AV_PLAY=16,AV_RECORDSENTSUCCESS=17,AV_DEPT=18,AV_MINIMIZE=1,AV_MAXIMIZE=2,AV_FEDBCK=3;CallImpl.updateUI=function(status,value){if(this.isCallWithChat)switch(status){case AV_OUTGOINGCALL:CallUIHandler.getTemplate(AV_OUTGOINGCALL,AV_MINIMIZE);break;case AV_CONNECTING:CallUIHandler.getTemplate(AV_CONNECTING,AV_MINIMIZE);break;case AV_ONGOING:CallUIHandler.getTemplate(AV_ONGOING,AV_MINIMIZE);break;case AV_RECONNECTING:CallUIHandler.getTemplate(AV_RECONNECTING,AV_MINIMIZE);break;case AV_BODY:CallUIHandler.getTemplate(AV_BODY,AV_MAXIMIZE),$(".cal-bodycont").on("scroll",function(event){CallImpl.handlescroll()});break;case AV_USERBUSY:if(!avimpl.isAudioRecordingSupported()){avimpl.terminateAudioCall();break}CallUIHandler.getTemplate(AV_USERBUSY,AV_MINIMIZE),avimpl.audiorecorder&&avimpl.audiorecorder.destroy(),avimpl.audiorecorder=Recorder(),avimpl.audiorecorder.init();break;case AV_RATING:CallUIHandler.getTemplate(AV_RATING,AV_MINIMIZE);break;case AV_CALLAGAIN:CallUIHandler.getTemplate(AV_CALLAGAIN,AV_MAXIMIZE);break;case AV_RATINGSUCCESS:CallUIHandler.getTemplate(AV_RATINGSUCCESS,AV_MINIMIZE);break;case AV_FDBCK:CallUIHandler.getTemplate(AV_FDBCK,AV_FEDBCK),$(".cal-footer").on("keyup",function(){CallImpl.checkFeedbackMsgHgt()}).focus();break;case AV_FDBCKSUCCESS:CallUIHandler.getTemplate(AV_FDBCKSUCCESS,AV_MAXIMIZE);break;case AV_RECORDING:CallUIHandler.getTemplate(AV_RECORDING,AV_MINIMIZE,-1);break;case AV_PLAY:CallUIHandler.getTemplate(AV_PLAY,AV_MINIMIZE,-1);break;case AV_RECORDSENTSUCCESS:CallUIHandler.getTemplate(AV_RECORDSENTSUCCESS,AV_MINIMIZE,-1)}},CallImpl.handlescroll=function(){var scrollheight=$(".cal-bodycont").scrollTop();if($("#call_inptfields").height()+$(".dup_div").height()<scrollheight)return $(".cal-deflnk").addClass("scrl_fix"),void $(".adocal-cont").addClass("scrl_anim");$(".adocal-cont").css("padding-top",25-scrollheight/15+"px").removeClass("scrl_anim"),$(".cal-visimg ").css("height",60-scrollheight/7+"px").css("width",60-scrollheight/7+"px"),$(".cal-cmpname").css("font-size",20-scrollheight/35+"px"),$(".cal-deflnk").removeClass("scrl_fix"),"theme4"==CallImpl.getTheme()&&$(".thme-bgimg").css("height",60-scrollheight/5.8+"px")},CallImpl.handleDeptClick=function(curr){$(".cal-bodycont").animate({scrollTop:$(".cal-bodycont").height()-$("#call_inptfields").height()+$(".cal-deflnk").height()+81},"500")},CallImpl.handleDeptSelect=function(curr){if(!$(curr).attr("status"))return!(curr.title="Offline");$Support.EmbedObj.department=curr.id,$("#call_deptlist").children().removeClass("dep-sel"),curr.className+=" dep-sel",$(".cal-bodycont").animate({scrollTop:$("#call_deptlist").height()+70},200),$("#dept_strtcall").removeClass("bg-grn").removeClass("bg-ddd").addClass("bg-grn")},CallImpl.startCall=function(){this.isCallWithChat=!0,this.updateUI(AV_BODY)},CallImpl.getAttenderImgHtml=function(){var imgkey=$Support.EmbedObj.attenderimagefkey;return imgkey&&0!=imgkey.split("_")[0]?'<div class="cal-visimg "><img src='+(imgkey=_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+imgkey+"/photo.ls?nps=404")+"></div>":'<div class="cal-visimg sqico-user"></div>'},CallImpl.compImgHtml=function(){var imgkey=$Support.EmbedObj.clogo;return imgkey?'<div class="cal-visimg "><img src='+imgkey+"></div>":'<div class="cal-visimg sqico-user"></div>'},CallImpl.getCompImgHtmlCALFAQ=function(){return'<div class="faqcal-img"><img src='+$Support.EmbedObj.clogo+"></div>"},CallImpl.getAttenderImgCALFAQHtml=function(){var imgkey=$Support.EmbedObj.attenderimagefkey;return imgkey&&0!=imgkey.split("_")[0]?'<div class="faqcal-img"><img src='+(imgkey=_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+imgkey+"/photo.ls?nps=404")+"></div>":'<div class="faqcal-img sqico-user"></div>'},CallImpl.checkAndStartCall=function(curr){if(!$("#dept_strtcall").hasClass("bg-ddd")){var editobj=$("#call_inptfields");if(!$Support.Util.validateFields(editobj))return $(".cal-bodycont").animate({scrollTop:0},500),!1;""!=$("#visname").val().trim()&&($Support.EmbedObj.visitorname=$("#visname").val()),""!=$("#visemail").val().trim()&&($Support.EmbedObj.visitoremail=$("#visemail").val()),this.isCallWithChat=!0,CallImpl.updateUI(AV_OUTGOINGCALL),$Support.startChat()}},CallImpl.checkFeedbackMsgHgt=function(){var $container=$Support.container;$("#faqcall")&&($container=$("#faqcall"));var $textarea=$container.find(".cal-footer"),$textarea1=$container.find("#fdbkarea");$textarea.removeAttr("style");var scroll_height=$textarea1[0].scrollHeight+2,style=140<scroll_height?{height:"140px",overflow:"auto"}:scroll_height<70?{height:"70px",overflow:"auto"}:{height:scroll_height+"px",overflow:"hidden"};$textarea.css(style)},CallImpl.getCompValueForKey=function(key){return window.parent.$ZSIQWidget.getEmbedObject().cinfo[key]},CallImpl.isCallAloneEmbed=function(){return CallImpl.isCallWithChat},CallImpl.getAttenderName=function(){var name=$Support.EmbedObj.attendername;return name||""},CallImpl.handleSettingUI=function(curr){if(0<$("#audio_setting",parent.document).length)return"none"===$("#audio_setting",parent.document).css("display")?void $("#audio_setting",parent.document).show():void $("#audio_setting",parent.document).hide();avaction.displaySettingUI()},CallImpl.getTheme=function(){var theme=window.parent.$ZSIQWidget.getWidgetObject().calltheme;return theme||(CallImpl.CALLFAQ=!0,"theme1")},CallImpl.getBackGndImg=function(type){return"theme4"==this.getTheme()?'<div class="thme-bgimg" style="background-image:url('+("Comp"==type?$Support.EmbedObj.clogo:_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+$Support.EmbedObj.attenderimagefkey+"/photo.ls?nps=404")+')"></div>':""},CallImpl.checkInputFields=function(){var editobj=$("#callfaq_inptfields");if(!$Support.Util.validateFields(editobj))return!1;""!=$("#visname").val().trim()&&($Support.EmbedObj.visitorname=$("#visname").val()),""!=$("#visemail").val().trim()&&($Support.EmbedObj.visitoremail=$("#visemail").val()),CallUIHandler.getTemplate(AV_DEPT,AV_MAXIMIZE)},CallImpl.checkDeptFields=function(){$("#dept_strtcall").parent().hasClass("fcal-enb")&&(this.isCallWithChat=!0,CallImpl.updateUI(AV_OUTGOINGCALL),$Support.startChat())},CallImpl.handleFAQClick=function(isheadshot){$("body").find("#faqcall").remove(),isheadshot&&$("body").append($Temp.getOnCallUI(avimpl.attenderimgurl)),$Support.container.find(".sqico-faqico").click(),document.getElementsByClassName("zsembd_audiocl")[0].sdrag()};function CallUIHandler(){}CallUIHandler.classmapp={},CallUIHandler.classmapp[AV_INCOMINGCALL]="",CallUIHandler.classmapp[AV_OUTGOINGCALL]="outcal",CallUIHandler.classmapp[AV_CONNECTING]="cal-recnct",CallUIHandler.classmapp[AV_ONGOING]="outcal",CallUIHandler.classmapp[AV_RECONNECTING]="cal-recnct",CallUIHandler.classmapp[AV_USERBUSY]="",CallUIHandler.classmapp[AV_RATING]="pL25",CallUIHandler.classmapp[AV_USERBUSY]="";var CALLALONE=1,CALLPLUSFAQ=2,CHATPLUSCALLPLUSFAQ=3;CallUIHandler.getTemplate=function(action,type,temp){if("FAQPLUSCALL"!=CallImpl.getTheme()){switch((-1==temp?$Support.container.find("#audiorec"):$Support.container.find("#audiocal")).replaceWith(this.mapTemp(action)),handleDrag(),setTimeout(function(){$(".zsembd_audiocl").hide()},1),type){case AV_MINIMIZE:$Support.getParent().$ZSIQWidgetUI.handleMinimizeCall();break;case AV_MAXIMIZE:$Support.getParent().$ZSIQWidgetUI.handleMinCall();break;case AV_FEDBCK:$Support.getParent().$ZSIQWidgetUI.handlefbCall()}}else 0<$("body").find("#faqcall").length?$("body").find("#faqcall").replaceWith(this.getTempForCALLPLUSFAQ(action,CALLPLUSFAQ)):$("body").prepend(this.getTempForCALLPLUSFAQ(action,CALLPLUSFAQ))},CallUIHandler.mapTemp=function(action){return"theme5"==CallImpl.getTheme()?this.getTempForSignChat(action):CallUIHandler.classmapp.hasOwnProperty(action)?this.getTempForThemes(action):this.getRequiredHtml(action)},CallUIHandler.getRequiredHtml=function(action,type){var html="";switch(action){case AV_INCOMINGCALL:html=type==CALLPLUSFAQ?this.getFQCALINCallhtml():this.getIncommingCallHtml();break;case AV_OUTGOINGCALL:html=type==CALLPLUSFAQ?this.getFQCALOUTCallhtml():this.getOutgoingCallHtml();break;case AV_CONNECTING:html=type==CALLPLUSFAQ?this.getFQCALConnectingCallhtml():this.getConnectingHtml();break;case AV_ONGOING:html=type==CALLPLUSFAQ?this.getFQCALOnCallhtml():this.getOnGoingCallHtml();break;case AV_RECONNECTING:html=this.getReConnectingHtml();break;case AV_USERBUSY:html=type==CALLPLUSFAQ?this.getFQCALUserBusyhtml():this.getUserBusyHtml();break;case AV_RATING:html=type==CALLPLUSFAQ?this.getFQCALRatinghtml():this.getRatingHtml();break;case AV_BODY:html=type==CALLPLUSFAQ?this.getFQCALBodyhtml():this.getBodyHtml();break;case AV_DEPT:html=this.getFQCALDepthtml();break;case AV_CALLAGAIN:html=type==CALLPLUSFAQ?this.getFQCALCallAgainhtml():this.getCallCancelledHtml();break;case AV_RATINGSUCCESS:html=this.getRatingSuccessHtml();break;case AV_FDBCK:html=type==CALLPLUSFAQ?this.getFQCALFDBKhtml():this.getFdbkratingHtml();break;case AV_FDBCKSUCCESS:html=type==CALLPLUSFAQ?this.getFQCALFDBKSucesshtml():this.getFdbkSuccessHtml();break;case AV_RECORDING:html=type==CALLPLUSFAQ?this.getFQCALRecordhtml():this.getRecordingHtml();break;case AV_PLAY:html=type==CALLPLUSFAQ?this.getFQCALAVPlayhtml():this.getRecordAVPlayHtml();break;case AV_RECORDSENTSUCCESS:html=type==CALLPLUSFAQ?this.getFQCALRecordSuccesshtml():this.getRecordSuccessHtml()}return html},CallUIHandler.getTempForThemes=function(action){return['<div class="cal-wrap" id="'+(action==AV_USERBUSY?"audiorec":"audiocal")+'"><div class="posrel dib-mid">','<div class="cal-widgt '+CallImpl.getTheme()+" "+CallUIHandler.classmapp[action]+'">','<div class="actbtn"><em class="sqico-min sqico-settings" id="call_stngicon" title="'+LSResource.getRealValue("common.settings")+'" onclick="CallImpl.handleSettingUI(this)"></em></div>',this.getRequiredHtml(action),"</div>","</div></div>"].join("")},CallUIHandler.getTempForSignChat=function(action){return['<div class="cal-wrap" id="audiocal"><div class="posrel dib-mid">','<div class="cal-widgt '+CallImpl.getTheme()+" "+CallUIHandler.classmapp[action]+'">','<div class="actbtn"><em class="sqico-min sqico-settings" id="call_stngicon" title="'+LSResource.getRealValue("common.settings")+'" onclick="CallImpl.handleSettingUI(this)"></em></div>',this.getRequiredHtml(action),"</div></div>"].join("")},CallUIHandler.getTempForCALLPLUSFAQ=function(action,type){return['<div class="faq-cal" id="faqcall"> <div class="fcal-actnbtn"> <em id="call_stngicon" class="sqico-settings dib-mid curP" title="'+LSResource.getRealValue("common.settings")+'" onclick="CallImpl.handleSettingUI()"></em> <em class="sqico-min siq-minimize-icon dib-mid curP" title="'+LSResource.getRealValue("common.minimize")+'" documentclick="min_iframe"></em> </div><div class="faqcal-wndw">',this.getRequiredHtml(action,type),"</div></div>"].join("")},CallUIHandler.getOutgoingCallHtml=function(){return['<div class="posrel usr-imginfo"> '+CallImpl.compImgHtml()+" </div> ",'<div class="cal-vstrdetl"> <nav class="cal-actvevstr elips font18">'+CallImpl.getCompValueForKey("name")+'</nav> <p class="cal-usrdesc elips">'+LSResource.getRealValue("av.info.calling")+"</p> </div>",' <div class="cal-optns posrel textR"> <span id="audiocall_mute" class="sqico-microphone bg-aaa" onclick="avimpl.toggleMute(this)"></span> <span class="sqico-call cal-rjct" onclick="avimpl.terminateAudioCall(true);"></span> </div>'].join("")},CallUIHandler.getIncommingCallHtml=function(){return['<div class="posrel usr-imginfo"> '+CallImpl.getAttenderImgHtml()+" </div>",'<div class="cal-vstrdetl"> <nav class="cal-actvevstr elips font18">'+CallImpl.getAttenderName()+'</nav> <p class="cal-usrdesc elips">'+LSResource.getRealValue("av.info.reconnecting")+"</p> </div> ",'<div class="cal-optns posrel textR"> <span id="audiocall_mute" class="sqico-microphone bg-aaa" onclick="avimpl.toggleMute(this)"></span> <span class="sqico-call cal-rjct" onclick="avimpl.stopOngoingCall()"></span> </div>'].join("")},CallUIHandler.getOnGoingCallHtml=function(){return[' <div class="posrel usr-imginfo"> '+CallImpl.getAttenderImgHtml()+" </div>",' <div class="cal-vstrdetl"> <nav class="cal-actvevstr elips font18">'+$Support.EmbedObj.attendername+'</nav> <p class="cal-usrdesc elips" id="sqico-timer">00:00</p> </div>',' <div class="cal-optns posrel textR"> <span id="audiocall_mute" class="sqico-microphone bg-aaa" onclick="avimpl.toggleMute(this)"></span> <span class="sqico-call cal-rjct" onclick="avimpl.stopOngoingCall();"></span> </div>'].join("")},CallUIHandler.getConnectingHtml=function(){return['<div class="posrel usr-imginfo"> '+CallImpl.getAttenderImgHtml()+" </div>",'<div class="cal-vstrdetl"> <nav class="cal-actvevstr elips font18">'+CallImpl.getAttenderName()+'</nav> <p class="cal-usrdesc elips">'+LSResource.getRealValue("av.info.connecting")+"</p> </div> ",'<div class="cal-optns posrel textR"> <span id="audiocall_mute" class="sqico-microphone bg-aaa" onclick="avimpl.toggleMute(this)"></span> <span class="sqico-call cal-rjct" onclick="avimpl.terminateAudioCall(true)"></span> </div>'].join("")},CallUIHandler.getReConnectingHtml=function(){return['<div class="posrel usr-imginfo"> '+CallImpl.getAttenderImgHtml()+" </div>",'<div class="cal-vstrdetl"> <nav class="cal-actvevstr elips font18">'+CallImpl.getAttenderName()+'</nav> <p class="cal-usrdesc elips">'+LSResource.getRealValue("av.info.reconnecting")+"</p> </div> ",'<div class="cal-optns posrel textR"> <span id="audiocall_mute" class="sqico-microphone bg-aaa" onclick="avimpl.toggleMute(this)"></span> <span class="sqico-call cal-rjct" onclick="avimpl.stopOngoingCall()"></span> </div>'].join("")},CallUIHandler.getUserBusyHtml=function(){return['<div class="posrel usr-imginfo">'+CallImpl.compImgHtml()+"</div>",'<div class="cal-vstrdetl"><nav class="cal-actvevstr elips font18">'+LSResource.getRealValue("av.info.oprbusy")+'</nav><p class="cal-usrdesc elips">'+LSResource.getRealValue("av.info.voicemsg")+"</p></div>",'<div class="cal-optns posrel textR"><span cntrl="startRecord" class="sqico-record bg-aaa"></span></div>'].join("")},CallUIHandler.getRatingHtml=function(){return['<div class="posrel usr-imginfo">'+CallImpl.getAttenderImgHtml()+"</div>",'<div class="cal-vstrdetl textC"><nav class="cal-actvevstr elips font16">'+LSResource.getRealValue("av.info.rating")+'</nav><div class="rating font18">'+this.getStarHTML()+'</div><p class="elips c777 font14">'+LSResource.getRealValue("av.info.ratigclick")+"</p>","</div></div>"].join("")},CallUIHandler.getStarHTML=function(selindex){for(var star="",attr=null!=selindex?"":'documentclick="sendCallRating"',i=0;i<5;i++)star+='<span class="sqico-star'+(i===selindex?" sel":"")+'" '+attr+"></span>";return star},CallUIHandler.getCallCancelledHtml=function(){return['<div class="cal-wrap" id="audiocal"> <div class="adocal-cont dtfix '+CallImpl.getTheme()+'"> '+CallImpl.getBackGndImg("Comp")+'<div class="header">',' <div class="actbtn"><em class="sqico-min siq-minimize-icon" title="'+LSResource.getRealValue("ne.title.minimize")+'" documentclick="min_iframe"></em></div> '+CallImpl.compImgHtml()+' <div> <div class="cal-cmpname font20 fontB">'+CallImpl.getCompValueForKey("name")+'</div> <div class="cal-cmpdesc lH22 font14"></div> </div> </div>',' <div class="cal-bodycont posrel"> <p class="cal-weldesc lH22 c333">'+CallImpl.getCompValueForKey("desc")+'</p> <div class="sqico-call bg-grn mA" onclick="$Support.startChat()"></div> </div> </div> </div>'].join("")},CallUIHandler.getFdbkratingHtml=function(){return['<div class="cal-wrap" id="audiocal"> <div class="adocal-cont dtfix '+CallImpl.getTheme()+' cal-oflne" style="height:354px;"> '+CallImpl.getBackGndImg()+' <div class="header">',' <div class="actbtn"><em class="sqico-min siq-minimize-icon" title="'+LSResource.getRealValue("ne.title.minimize")+'" documentclick="min_iframe"></em></div> <div class="posrel dib-mid"> '+CallImpl.getAttenderImgHtml()+'<em class="sqico-star usr-rtng"><em class="rtng-val">'+$Support.rating+'</em></em></div> <div> <div class="cal-cmpname font20 fontB">'+$Support.EmbedObj.attendername+"</div> </div> </div>",' <div class="cal-bodycont posrel"> <div class="ofln-msg mT5">'+LSResource.getRealValue("av.info.ratingsuccess")+'</div> </div> <div class="cal-footer" style="height:70px;"> <textarea class="bg-f6 font13 c333 lH20" dockeyup="feedback" dockeydown="textarea" id="fdbkarea" data-validate="required" placeholder="'+LSResource.getRealValue("av.info.fdkbckmsg")+'" autofocus></textarea> <div class="sqico-calsend fdbak-send msg-send" documentclick="sendCallFb"></div> </div> </div> </div>'].join("")},CallUIHandler.getFdbkSuccessHtml=function(){return['<div class="cal-wrap" id="audiocal"> <div class="adocal-cont dtfix '+CallImpl.getTheme()+' cal-oflne"> '+CallImpl.getBackGndImg()+' <div class="header">',' <div class="actbtn"><em class="sqico-min siq-minimize-icon" title="'+LSResource.getRealValue("ne.title.minimize")+'" documentclick="min_iframe"></em></div> <div class="posrel dib-mid"> '+CallImpl.getAttenderImgHtml()+'<em class="sqico-star usr-rtng"><em class="rtng-val">'+$Support.rating+'</em></em></div> <div> <div class="cal-cmpname font20 fontB">'+$Support.EmbedObj.attendername+"</div> </div> </div>",' <div class="cal-bodycont posrel"> <div class="ofln-msg mT5">'+LSResource.getRealValue("av.info.ratingandfbk")+'</div> <div class="sqico-call bg-grn mT25 mA" onclick="$Support.startChat()"></div> </div> </div> </div>'].join("")},CallUIHandler.getRecordingHtml=function(){return['<div class="cal-wrap ado-rec" id="audiorec"><div class="cal-widgt '+CallImpl.getTheme()+'">','<div class="actbtn"><em class="sqico-min sqico-settings" title="'+LSResource.getRealValue("common.settings")+'" onclick="CallImpl.handleSettingUI(this)"></em></div><div class="posrel usr-imginfo"> '+CallImpl.compImgHtml()+'</div><div class="cal-vstrdetl"><p class="cal-vstmsg" id="sqico-timer">00:00:00</p><p class="cal-usrdesc elips">'+LSResource.getRealValue("av.info.recordingaudio")+"</p></div>",'<div class="vc-recrd pR10" id="sqico-canvas"></div><div class="cal-optns posrel textR"><div class="recd-optn" cntrl="stopRecord" ></div><em class="font14 rec-timer" id="sqico-remtimer">00:00</em></div></div></div>'].join("")},CallUIHandler.getRecordAVPlayHtml=function(){return['<div class="cal-wrap" id="audiorec"><div class="posrel dib-mid"><div class="cal-widgt '+CallImpl.getTheme()+'">','<div class="actbtn"><em class="sqico-min sqico-settings" title="'+LSResource.getRealValue("common.settings")+'" onclick="CallImpl.handleSettingUI(this)"></em></div><div class="posrel usr-imginfo"> '+CallImpl.compImgHtml()+"</div>",'<div class="cal-vstrdetl"><div id="slide" ><div id="fill" style="width: 2px;"></div><div id="thumb" style="left: 0px;"></div></div><div class="cal-usrdesc mT5"><div cntrl="playRecord" class="sqico-play font12 mR10 curP"></div><div id="sqico-timer" style="display:inline;">00:00 / 00:00</div></div></div><div class="cal-optns posrel textR"><span class="sqico-record  bg-aaa font19" cntrl="startRecord"></span><span class="sqico-videosend bg-blue mL20" cntrl="uploadRecord"></span></div></div></div></div>'].join("")},CallUIHandler.getRecordSuccessHtml=function(){return['<div class="cal-wrap" id="audiocal"><div class="posrel dib-mid"><div class="cal-widgt '+CallImpl.getTheme()+' pL25">','<div class="actbtn"><em class="sqico-min sqico-settings" title="'+LSResource.getRealValue("common.settings")+'" onclick="CallImpl.handleSettingUI(this)"></em></div><div class="posrel usr-imginfo"> '+CallImpl.compImgHtml()+"</div>",'<div class="cal-vstrdetl"><p class="cal-vstmsg textC">'+LSResource.getRealValue("av.info.voicesent")+'</p></div><div class="cal-optns posrel textR"><span class="sqico-call cal-acpt" onclick="$Support.startChat()"></span></div></div></div></div>'].join("")},CallUIHandler.getBodyHtml=function(){var eobj=$Support.EmbedObj,eprops=($Support.EmbedObj.status,eobj.eprops);return['<div class="cal-wrap" id="audiocal"> <div class="adocal-cont dtfix '+CallImpl.getTheme()+' ad-dep"> '+CallImpl.getBackGndImg("Comp")+' <div class="header"> <div class="actbtn"><em class="sqico-min siq-minimize-icon" title="'+LSResource.getRealValue("ne.title.minimize")+'" documentclick="min_iframe"></em></div> '+CallImpl.compImgHtml()+' <div> <div class="cal-cmpname font20 fontB">'+CallImpl.getCompValueForKey("name")+'</div> <div class="cal-cmpdesc font14">'+LSResource.getRealValue("av.info.welcomemsg")+"</div> </div> </div>",'<div class="cal-bodycont posrel"> <div class="vistr-dtlfld" id=call_inptfields>',JSON.parse(eprops.isname[0])?this.getNameHTML(eprops.isname[1].ismandatory):"",JSON.parse(eprops.isemail[0])?this.getEmailHTML(eprops.isemail[1].ismandatory):"",'</div> <div class="mT15">',1<$Support.EmbedObj.deptlist.length?' <div class="dup_div posrel mT20"><div class="cal-deflnk mT20 curP font16" onclick="CallImpl.handleDeptClick()">'+LSResource.getRealValue("av.info.deptchoose")+"</div></div>":'<div class="sqico-call bg-grn mA" onclick="CallImpl.checkAndStartCall()"></div>',1<$Support.EmbedObj.deptlist.length&&(eobj.department,1)?this.getDeptList():"","</div></div> </div>"].join("")},CallUIHandler.getNameHTML=function(required,onenter){onenter=onenter||"";var validate="optional",blur="";validate="required",LSResource.getRealValue("ne.required"),blur=' docblur="required"';var visitor_name=$Support.Util.isInValidVisitorName($Support.EmbedObj.visitorname)?"":$Support.EmbedObj.visitorname,placeholder_cls=visitor_name?"dN":"";return'<label class="posrel"><input onkeyup="CallUIHandler.handletextfiled(this)" type="text" value="'+getEncodedText(visitor_name)+'" id="visname" class="siq-input-text-box" '+blur+onenter+' info="name" autofocus purpose="visitorname" data-validate="'+validate+' charlimit 100"/><span class="ph-mntry '+placeholder_cls+'">'+LSResource.getRealValue("ne.entername")+this.getRequiredHTML()+'</span><em class="sqico-invalid" title="'+LSResource.getRealValue("ne.required")+'"></em></label>'},CallUIHandler.getEmailHTML=function(required){LSResource.getRealValue("ne.required");var visitor_email=$Support.EmbedObj.visitoremail||"";return['<label class="posrel"><input onkeyup="CallUIHandler.handletextfiled(this)" type="text" id="visemail" value="'+visitor_email+'" class="siq-input-text-box" info="email" purpose="visitoremail" data-validate="required email charlimit 100" docblur="email" /><span class="ph-mntry '+(visitor_email?"dN":"")+'">'+LSResource.getRealValue("ne.enteremail")+this.getRequiredHTML()+'</span><em class="sqico-invalid" title="'+LSResource.getRealValue("ne.required")+'"></em></label>',this.getFetchMailHTML()].join("")},CallUIHandler.handletextfiled=function(curr){$(curr).siblings("span").addClass("dN"),""==curr.value&&$(curr).siblings("span").removeClass("dN")},CallUIHandler.getPhoneHTML=function(required){var validate="optional",red_txt="",blur="";return"true"===required&&(validate="required",red_txt=" ("+LSResource.getRealValue("ne.required")+")",blur=' docblur="required"'),'<div custom="phone"><input type="text" value="'+($Support.EmbedObj.visitorphone||"")+'" class="siq-input-text-box" id="visphone" placeholder="'+LSResource.getRealValue("ne.enterphone")+red_txt+'" class="" '+blur+' info="phone" purpose="visitorphone"  data-validate="'+validate+' phone"/>'+this.getRequiredHTML("*")+"</div>"},CallUIHandler.getRequiredHTML=function(txt){return txt=txt||"",'<em class="req siq-required" title="'+LSResource.getRealValue("ne.required")+'">*</em>'},CallUIHandler.getFetchMailHTML=function(required){return $Support.EmbedObj.fetchid?'<div class="fetchmail" id="fetchmail"><span class="sqico-fb"></span><span class="sqico-gplus"></span></div>':""},CallUIHandler.getDeptList=function(){var depthtml="",deptlist=$Support.EmbedObj.deptlist;for(i in deptlist){var deptname=deptlist[i].DNAME;depthtml+='<span class="depmnt-items font14 curP" onclick="CallImpl.handleDeptSelect(this)" status="'+deptlist[i].STATUS+'" id="'+deptlist[i].ID+'">'+deptname+"</span>"}return['<div class="pL15" id="call_deptlist">',depthtml,'</div> <div class="sqico-call bg-ddd mA mT25" id=dept_strtcall onclick="CallImpl.checkAndStartCall(this)"></div> '].join("")},CallUIHandler.getFQCALINCallhtml=function(){},CallUIHandler.getFQCALBodyhtml=function(){var eobj=$Support.EmbedObj,eprops=($Support.EmbedObj.status,eobj.eprops);return['<div class="faqcal-head"><div class="posrel fcal-usrdetl"> '+CallImpl.getCompImgHtmlCALFAQ()+'</div> <div class="font22 cfff faqcal-usr">'+CallImpl.getCompValueForKey("name")+'</div> <p class="cfff lH22 font16 faqcal-desc">'+CallImpl.getCompValueForKey("desc")+"</p> </div>",'<div class="faq-cal-sec font14"> <div class="vistr-dtlfld" id="callfaq_inptfields">',JSON.parse(eprops.isname[0])?this.getNameHTML(eprops.isname[1].ismandatory):"",JSON.parse(eprops.isemail[0])?this.getEmailHTML(eprops.isemail[1].ismandatory):"",'</div> <div class="faqcal-btn cfff curP" onclick="CallImpl.checkInputFields(this)">'+LSResource.getRealValue("av.info.deptchoose")+"</div></div>"].join("")},CallUIHandler.getFQCALDepthtml=function(){var depthtml="",deptlist=$Support.EmbedObj.deptlist;for(i in deptlist){var deptname=deptlist[i].DNAME;depthtml+='<span status="'+deptlist[i].STATUS+'" call-dept="" id="'+deptlist[i].ID+'">'+deptname+"</span>"}return setTimeout(function(){$("#FQCLdeptlist").on("click","[call-dept]",function(){$("#FQCLdeptlist").find("[call-dept]").removeClass("fcal-sel"),$(this).addClass("fcal-sel"),$Support.EmbedObj.department=this.id,$("#dept_strtcall").parent().removeClass("fcal-dis").addClass("fcal-enb")})},2),['<div class="faqcal-head"> <div class="posrel fcal-usrdetl">'+CallImpl.getCompImgHtmlCALFAQ()+'</div> <div class="font22 cfff faqcal-usr">'+CallImpl.getCompValueForKey("name")+'</div> <p class="cfff lH22 font16 faqcal-desc">'+CallImpl.getCompValueForKey("desc")+"</p> </div>",'<div class="faqcal-sec font14 textL"><div class="fcal-dephed dib-mid">'+LSResource.getRealValue("av.info.deptchoose")+'</div><div class="fcal-dept mT15" style="" id="FQCLdeptlist">',depthtml,'</div></div> <div class="fcal-btnoptn dib-mid mT25 fcal-dis"><span class="fcal-btns sqico-call" onclick="CallImpl.checkDeptFields(this)" id="dept_strtcall"></span> <div class="cddd textC mT10">'+LSResource.getRealValue("av.info.call")+"</div> </div>"].join("")},CallUIHandler.getFQCALOUTCallhtml=function(){return['<div class="faqcal-head"> <div class="posrel fcal-usrdetl">'+CallImpl.getCompImgHtmlCALFAQ()+'</div> <div class="font22 cfff faqcal-usr">'+CallImpl.getCompValueForKey("name")+'</div> <p class="cfff lH22 font16 faqcal-desc">'+LSResource.getRealValue("av.info.calling")+"</p> </div>",'<div class="dtfix w100"> <div class="fcal-btnoptn"> <span id="audiocall_mute" onclick="avimpl.toggleMute(this)" class="fcal-btns sqico-microphone"></span> <div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.mute")+'</div> </div> <div class="fcal-btnoptn dib-mid mT40"> <span class="fcal-btns sqico-call cal-rjct" onclick="avimpl.terminateAudioCall(true);"></span> <div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.end")+"</div> </div> </div>"].join("")},CallUIHandler.getFQCALConnectingCallhtml=function(){return['<div class="faqcal-head"><div class="posrel fcal-usrdetl"> '+CallImpl.getAttenderImgCALFAQHtml()+' </div><div class="font22 cfff faqcal-usr">'+CallImpl.getAttenderName()+'</div> <p class="cfff lH22 font16 faqcal-desc">'+LSResource.getRealValue("av.info.connecting")+"</p> </div>",'<div class="dtfix w100"> <div class="fcal-btnoptn"> <span class="fcal-btns sqico-microphone" id="audiocall_mute" onclick="avimpl.toggleMute(this)"></span> <div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.mute")+'</div> </div> <div class="fcal-btnoptn"> <span class="fcal-btns sqico-faqico" onclick="CallImpl.handleFAQClick()"></span> <div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.faq")+'</div> </div> <div class="fcal-btnoptn"> <span class="fcal-btns sqico-call cal-rjct" onclick="avimpl.terminateAudioCall(true)"></span> <div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.end")+"</div> </div> </div>"].join("")},CallUIHandler.getFQCALOnCallhtml=function(){return['<div class="faqcal-head"> <div class="posrel fcal-usrdetl">'+CallImpl.getAttenderImgCALFAQHtml()+'</div> <div class="font22 cfff faqcal-usr">'+CallImpl.getAttenderName()+'</div> <p class="cfff lH22 font16 faqcal-desc" id="sqico-timer">00:00</p> </div>','<div class="dtfix w100"> <div class="fcal-btnoptn"> <span class="fcal-btns sqico-microphone" id="audiocall_mute" onclick="avimpl.toggleMute(this)"></span> <div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.mute")+'</div> </div> <div class="fcal-btnoptn"> <span class="fcal-btns sqico-faqico" onclick="CallImpl.handleFAQClick(true)"></span> <div class="cfff textC mT10 fcal-txt" >'+LSResource.getRealValue("av.info.faq")+'</div> </div> <div class="fcal-btnoptn"> <span class="fcal-btns sqico-call cal-rjct" onclick="avimpl.stopOngoingCall()"></span> <div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.end")+"</div> </div> </div>"].join("")},CallUIHandler.getFQCALRatinghtml=function(){return['<div class="faqcal-head"><div class="posrel fcal-usrdetl"> '+CallImpl.getAttenderImgCALFAQHtml()+'</div> <div class="font22 cfff faqcal-usr">'+CallImpl.getAttenderName()+"</div></div>",'<div class="fcal-fdback textC"><div class="ofln-msg mT25">'+LSResource.getRealValue("av.info.rating")+'</div> <div class="rating mT30">'+this.getStarHTML()+'</div><p class="elips mT20 cfff font14">'+LSResource.getRealValue("av.info.ratingclick")+"</p>"].join("")},CallUIHandler.getFQCALFDBKhtml=function(){return['<div class="faqcal-head"><div class="posrel fcal-usrdetl">'+CallImpl.getAttenderImgCALFAQHtml()+'<em class="sqico-star usr-rtng bg-999"><em class="rtng-val cfff">'+$Support.rating+'</em></em></div><div class="font22 cfff faqcal-usr">'+CallImpl.getAttenderName()+"</div></div>",'<div class="ofln-msg mT25">'+LSResource.getRealValue("av.info.ratingsuccess")+'</div><div class="cal-footer bgfff" style="height:70px;"> <textarea class="bgfff font13 c333 lH20" dockeyup="feedback" dockeydown="textarea" id="fdbkarea" data-validate="required" placeholder="'+LSResource.getRealValue("av.info.fdkbckmsg")+'" autofocus></textarea> <div class="sqico-calsend fdbak-send msg-send" documentclick="sendCallFb"></div></div>'].join("")},CallUIHandler.getFQCALFDBKSucesshtml=function(){return['<div class="faqcal-head"><div class="posrel fcal-usrdetl"> '+CallImpl.getAttenderImgCALFAQHtml()+'</div><div class="font22 cfff faqcal-usr">'+CallImpl.getAttenderName()+"</div></div>",' <div class="ofln-msg mT25">'+LSResource.getRealValue("av.info.ratingandfbk")+' </div> <div class="fcal-btnoptn"><span class="fcal-btns sqico-call bg-grn mT25" onclick="$Support.startChat()"></span><div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.callback")+"</div></div>"].join("")},CallUIHandler.getFQCALCallAgainhtml=function(){return['<div class="faqcal-head"><div class="posrel fcal-usrdetl"> '+CallImpl.getCompImgHtmlCALFAQ()+' </div><div class="font22 cfff faqcal-usr">'+CallImpl.getCompValueForKey("name")+'</div> <p class="cfff lH22 font16 faqcal-desc">'+CallImpl.getCompValueForKey("desc")+"</p> </div>",'<div class="fcal-btns sqico-call bg-grn mT25" onclick="$Support.startChat()"></div>'].join("")},CallUIHandler.getFQCALUserBusyhtml=function(){return['<div class="faqcal-head"> <div class="posrel fcal-usrdetl">'+CallImpl.getCompImgHtmlCALFAQ()+'</div> <div class="font22 cfff faqcal-usr">'+LSResource.getRealValue("av.info.oprbusy")+' </div><p  class="cfff lH22 font16 faqcal-desc elips">'+LSResource.getRealValue("av.info.voicemsg")+"</p></div>",'<div class="dtfix w100"> <div class="fcal-btnoptn"> <span class="fcal-btns sqico-record" cntrl="startRecord"></span> <div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.voicemsgtxt")+'</div> </div> <div class="fcal-btnoptn"> <span class=" fcal-btns sqico-faqico" onclick="CallImpl.handleFAQClick()"></span> <div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.faq")+'</div> </div> <div class="fcal-btnoptn"> <span class="fcal-btns sqico-call bg-grn" onclick="$Support.startChat()"></span> <div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.callback")+"</div> </div> </div>"].join("")},CallUIHandler.getFQCALRecordhtml=function(){return['<div class="faqcal-head"><div class="posrel fcal-usrdetl"> '+CallImpl.getCompImgHtmlCALFAQ()+' </div><div class="font22 cfff faqcal-usr">'+CallImpl.getCompValueForKey("name")+'</div> <p class="cfff lH22 font16 faqcal-desc" id="sqico-timer">00:00:00</p> </div>','<div class="dtfix w100"><div class="vc-recrd" id="sqico-canvas" style="margin:-30px;"></div><div class="posrel" id="faqrcd_play" style="display:none;"> <div class="fcal-btnoptn"><span class="fcal-btns sqico-record  bg-aaa font22" cntrl="startRecord"></span><div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.voicemsgtxt")+'</div></div> <div class="fcal-btnoptn"><span cntrl="playRecord" class="fcal-btns sqico-play"></span><div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.play")+'</div></div> <div class="fcal-btnoptn"><span class="fcal-btns sqico-voicesend cal-send" cntrl="uploadRecord"></span><div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.send")+'</div></div></div><div id="faqrcd"> <div class="fcal-btnoptn"><div class="rec-tmr font18 mB10" id="sqico-remtimer">00:00</div><span class="fcal-btns str-recd" cntrl="stopRecord"></span> <div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.stop")+"</div></div> </div></div>"].join("")},CallUIHandler.getFQCALAVPlayhtml=function(){return['<div class="faqcal-head"> <div class="posrel fcal-usrdetl">'+CallImpl.getCompImgHtmlCALFAQ()+'</div> <div class="font22 cfff faqcal-usr">'+CallImpl.getCompValueForKey("name")+'</div><p id="sqico-timer" style="display:inline;">00:00</p></div>','<div class="cal-vstrdetl"><div class="vc-recrd" id="sqico-canvas" style="margin:-30px;"></div></div><div class="cal-optns posrel textR"> <div class="fcal-btnoptn"><span class="fcal-btns sqico-record  bg-aaa" cntrl="startRecord"></span><div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.voicemsgtxt")+'</div></div> <div class="fcal-btnoptn"><span cntrl="playRecord" class="fcal-btns sqico-play"></span><div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.play")+'</div></div> <div class="fcal-btnoptn"><span class="fcal-btns sqico-voicesend cal-send" cntrl="uploadRecord"></span><div class="cfff textC mT10 fcal-txt">'+LSResource.getRealValue("av.info.send")+"</div></div></div></div></div></div>"].join("")},CallUIHandler.getFQCALRecordSuccesshtml=function(){return['<div class="faqcal-head"><div class="posrel fcal-usrdetl"> '+CallImpl.getCompImgHtmlCALFAQ()+' </div><div class="font22 cfff faqcal-usr">'+CallImpl.getCompValueForKey("name")+'</div> <p class="cfff lH22 font16 faqcal-desc">'+LSResource.getRealValue("av.info.voicesent")+"</p> </div>",'<div class="fcal-btns sqico-call bg-grn mT25" onclick="$Support.startChat()"></div>'].join("")},CallUIHandler.getInitialHtml=function(){return['<div class="cal-wrap" id="audiocal"><div class="adocal-cont '+CallImpl.getTheme()+'">'+CallImpl.getBackGndImg("Comp")+' <div class="header">',' <div class="actbtn"><em class="sqico-min siq-minimize-icon" title="'+LSResource.getRealValue("common.minimize")+'" documentclick="min_iframe"></em></div> '+CallImpl.compImgHtml()+" <div> ",'<div class="cal-cmpname font20 fontB elips" title="'+CallImpl.getCompValueForKey("name")+'">'+CallImpl.getCompValueForKey("name")+'</div> <div class="cal-cmpdesc"></div> </div> </div>','<section class="cal-bodycont"> <p class="cal-weldesc c333 lH22">'+CallImpl.getCompValueForKey("desc")+'</p> <div class="cal-deflnk lH22 dib-mid curP" onclick="CallImpl.startCall()">'+LSResource.getRealValue("av.info.callnow")+"</div> </section> </div> </div>"].join("")};var Recorder=function(){"use strict";var _recorderDiv,_recordingWorker,_audioContext,_audio,_analyser,_dataView,canvasOptions,_stream,_timer,_timeDiv,_remTimeDiv,_classesForButton,_events,_toggleButtons,_currAudioDuration=0,_isStopped=!0,_isPlaying=!1,_msec=0,_mediaAccessWaitingTime=0,_changeUIAfterStart=function(){},_changeUIAfterStop=function(){},_changeUIAfterSend=function(){},_isAudioRecordingSupported=function(){return window.AudioContext=window.AudioContext||window.webkitAudioContext,window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.AudioContext&&navigator.getUserMedia&&window.URL&&window.Worker||(support=!1),!0},_setEventListener=function(){_recorderDiv.addEventListener("click",_handleEvents)},_removeEventListener=function(){_recorderDiv.removeEventListener("click",_handleEvents)},_handleEvents=function(event){var trigger=event.target,cntrl=trigger.getAttribute("cntrl");_events[cntrl]&&_events[cntrl](trigger)},_setupWorkers=function(){var recordingWorkerURL=URL.createObjectURL(new Blob(["( "+_RecordingWorker+" )()"]),{type:"javascript"});(_recordingWorker=new Worker(recordingWorkerURL)).onmessage=function(event){"view"==event.data.key&&(_dataView=event.data.value)}};_toggleButtons=function(btnName){var btn=_classesForButton[btnName];btn.trigger.classList.add(btn.add),btn.trigger.classList.remove(btn.remove),btn.trigger.setAttribute("cntrl",btn.cntrl)};var _setHeadShotAudioRecordUI=function(){(_recorderDiv=document.querySelector(".zsembd_audiocl")).sdrag(),_setEventListener(),_timeDiv=_recorderDiv.querySelector("#sqico-timer");var btn1,btn2,btn3,canvas=_recorderDiv.querySelector("#sqico-canvas");canvas.innerHTML='<canvas id="level_audio2"></canvas>',canvas=canvas.querySelector("#level_audio2"),canvasOptions={elem:canvas,ctx:canvas.getContext("2d"),step:-4,bufferLength:null,dataArray:null,stepincrement:2,waveTrigger:null,lineX:0},btn1=_recorderDiv.querySelector('[cntrl="settings"]'),btn2=_recorderDiv.querySelector('[cntrl="playRecord"]'),btn3=_recorderDiv.querySelector('[cntrl="stopRecord"]'),_classesForButton={start:{trigger:btn1,cntrl:"startRecord",add:"sqico-recorder",remove:"sqico-settings"},stop:{trigger:btn3,cntrl:"stopRecord",add:"sqico-chkbx",remove:"sqico-videosend"},setting:{trigger:btn1,cntrl:"settings",add:"sqico-settings",remove:"sqico-recorder"},play:{trigger:btn2,cntrl:"playRecord",add:"sqico-play",remove:"sqico-pause"},pause:{trigger:btn2,cntrl:"pauseRecord",add:"sqico-pause",remove:"sqico-play"},send:{trigger:btn3,cntrl:"uploadRecord",add:"sqico-videosend",remove:"sqico-chkbx"}},_changeUIAfterStart=function(){_msec=0,_toggleButtons("setting"),_classesForButton.play.trigger.style.display="none",_toggleButtons("stop"),_destroyWave(!0),_currAudioDuration=6e3},_changeUIAfterStop=function(){_toggleButtons("send"),_classesForButton.play.trigger.style.display="inline-block",_toggleButtons("play"),_toggleButtons("start"),_currAudioDuration=_msec,_msec=0},_changeUIAfterSend=function(){_recorderDiv.remove()}},_setWidgetAudioRecordUI=function(){(_recorderDiv=document.querySelector("#audiorec"))||(_recorderDiv=document.querySelector("#faqcall")),_setEventListener(),_changeUIAfterStart=function(){_msec=0,_currAudioDuration=6e3,CallImpl.updateUI(AV_RECORDING),(_recorderDiv=document.querySelector("#audiorec"))||(_recorderDiv=document.querySelector("#faqcall")),_timeDiv=_recorderDiv.querySelector("#sqico-timer"),_remTimeDiv=_recorderDiv.querySelector("#sqico-remtimer");var btn1,btn2,btn3,canvas=_recorderDiv.querySelector("#sqico-canvas");"FAQPLUSCALL"==CallImpl.getTheme()?(canvas.innerHTML='<canvas id="level_audio2" style="height:100px;width: 100%;"></canvas>',canvas=canvas.querySelector("#level_audio2"),canvasOptions={elem:canvas,ctx:canvas.getContext("2d"),step:-4,bufferLength:null,dataArray:null,stepincrement:2,waveTrigger:null,lineX:0},btn1=_recorderDiv.querySelector('[cntrl="settings"]'),btn2=_recorderDiv.querySelector('[cntrl="playRecord"]'),btn3=_recorderDiv.querySelector('[cntrl="stopRecord"]'),_classesForButton={start:{trigger:btn1,cntrl:"startRecord",add:"sqico-recorder",remove:"sqico-settings"},stop:{trigger:btn3,cntrl:"stopRecord",add:"sqico-chkbx",remove:"sqico-videosend"},setting:{trigger:btn1,cntrl:"settings",add:"sqico-settings",remove:"sqico-recorder"},play:{trigger:btn2,cntrl:"playRecord",add:"sqico-play",remove:"sqico-pause"},pause:{trigger:btn2,cntrl:"pauseRecord",add:"sqico-pause",remove:"sqico-play"},send:{trigger:btn3,cntrl:"uploadRecord",add:"sqico-videosend",remove:"sqico-chkbx"}}):(canvas.innerHTML='<canvas id="level_audio"  style="height: 60px;width: 72px;padding: 10px 10px 10px 0px;" ></canvas>',canvas=canvas.querySelector("#level_audio"),canvasOptions={elem:canvas,ctx:canvas.getContext("2d"),bufferLength:null,dataArray:null,waveTrigger:null,slider:null,lineX:0});_setEventListener()},_changeUIAfterStop=function(){if(_currAudioDuration=_msec,_msec=0,"FAQPLUSCALL"==CallImpl.getTheme())return $("#faqrcd_play").css("display",""),void $("#faqrcd").css("display","none");CallImpl.updateUI(AV_PLAY),(_recorderDiv=document.querySelector("#audiorec"))||(_recorderDiv=document.querySelector("#faqcall")),_setEventListener();var btn=_recorderDiv.querySelector('[cntrl="playRecord"]');(_timeDiv=_recorderDiv.querySelector("#sqico-timer")).innerHTML="00:00 / "+_getRemainingTime(),canvasOptions.slider=_recorderDiv.querySelector("#slide"),canvasOptions.slider.style.cursor="pointer";var thumb=canvasOptions.slider.querySelector("#thumb"),fill=canvasOptions.slider.querySelector("#fill"),X=0,browsername=avaction.getBrowserFromUserAgent(navigator.userAgent).split("-")[0],browserflag="Chrome"==browsername||"Opera"==browsername;function move(event){var left=thumb.offsetLeft-(X-event.clientX);left>canvasOptions.slider.clientWidth-4||left<-4||(thumb.style.left=left+"px",fill.style.width=left+"px",_msec=_currAudioDuration/parseInt(canvasOptions.slider.clientWidth)*left,_audio&&(_audio.currentTime=browserflag?_msec/200:_msec/100),X=event.clientX)}function drop(e){document.onmouseup=null,document.onmousemove=null,_isPlaying&&_audio&&(startPlayingTimer(),_audio.play())}canvasOptions.slider.onclick=function(event){var left=event.clientX-canvasOptions.slider.getBoundingClientRect().left-5;left>canvasOptions.slider.clientWidth-4||left<-4||(thumb.style.left=left+"px",fill.style.width=left+"px",_msec=_currAudioDuration/parseInt(canvasOptions.slider.clientWidth)*left,_audio&&(_isPlaying&&_audio.pause(),_audio.currentTime=browserflag?_msec/200:_msec/100,_isPlaying&&_audio.play()))},thumb.onmousedown=function(event){event.stopPropagation(),X=event.clientX,document.onmouseup=drop,_isPlaying&&_audio&&(_audio.pause(),clearInterval(_timer)),document.onmousemove=move},_classesForButton={play:{trigger:btn,cntrl:"playRecord",add:"sqico-play",remove:"sqico-pause"},pause:{trigger:btn,cntrl:"pauseRecord",add:"sqico-pause",remove:"sqico-play"}}},_changeUIAfterSend=function(){CallImpl.updateUI(AV_RECORDSENTSUCCESS)}},_startRecording=function(){!_isPlaying&&_isStopped&&(_changeUIAfterStart(),_recordingWorker.postMessage({command:"clear"}),_audio=null,_record(),_isStopped=!1)},_stopRecording=function(){_isStopped||(_changeUIAfterStop(),_audioContext.close(),_closeStream(),_recordingWorker.postMessage({command:"getView"}),_destroyWave(!0),_isStopped=!0)},_pausePlaying=function(){_audio&&(_isPlaying=!1,clearInterval(_timer),_audio.pause(),(!CallImpl.isCallWithChat||"FAQPLUSCALL"==CallImpl.getTheme())&&_destroyWave(!1)),_toggleButtons("play")},_playRecordedAudio=function(){if(_toggleButtons("pause"),_audio)return _isPlaying=!0,(!CallImpl.isCallWithChat||"FAQPLUSCALL"==CallImpl.getTheme())&&_initCanvas(_drawWave,25),_audio.play(),void startPlayingTimer();_audio=new Audio,_isPlaying=!0,"FAQPLUSCALL"==CallImpl.getTheme()&&_initCanvas(_drawWave,25),_play(),startPlayingTimer()},_play=function(){var url=URL.createObjectURL(new Blob([_dataView],{type:"audio/wav"}));if(_audio.src=url,!CallImpl.isCallWithChat){(_audioContext=new AudioContext).resume();var source=_audioContext.createMediaElementSource(_audio);_analyser=_audioContext.createAnalyser(),source.connect(_analyser),_analyser.connect(_audioContext.destination),_initCanvas(_drawWave,25)}_audio.play()},_convertToMP3=function(){var blob,file,view,wav,samples;_removeEventListener(),_pausePlaying(),_changeUIAfterSend(),window.lamejs?(view=_dataView,wav=lamejs.WavHeader.readHeader(view),samples=new Int16Array(view.buffer,wav.dataOffset,wav.dataLen/2),blob=function(channels,sampleRate,samples){for(var buffer=[],mp3enc=new lamejs.Mp3Encoder(channels,sampleRate,128),remaining=samples.length,i=0;1152<=remaining;i+=1152){var mono=samples.subarray(i,i+1152),mp3buf=mp3enc.encodeBuffer(mono);0<mp3buf.length&&buffer.push(new Int8Array(mp3buf)),remaining-=1152}var d=mp3enc.flush();return 0<d.length&&buffer.push(new Int8Array(d)),new Blob(buffer,{type:"audio/mp3"})}(wav.channels,wav.sampleRate,samples),file=new File([blob],"Audio.mp3",{type:"audio/mp3"})):(blob=new Blob([_dataView],{type:"audio/wav"}),file=new File([blob],"Audio.wav",{type:"audio/wav"})),_sendToServer(file)},_sendToServer=function(file){LSDragDrop.pos=0,LSDragDrop.nooffiles=1,LSDragDrop.uploadFile($Support.EmbedObj.chatID,[file]),_destroy()},_destroy=function(){clearInterval(_timer),_destroyWave(!0),canvasOptions=_events=_classesForButton=null,_recordingWorker&&(_recordingWorker.terminate(),_recordingWorker=null),_audioContext&&("closed"!=_audioContext.state&&_audioContext.close(),_audioContext=null),_recorderDiv&&_recorderDiv.remove(),avimpl.audiorecorder=null,avimpl.clear()},_record=function(){(_audioContext=new AudioContext).resume(),_recordingWorker.postMessage({command:"setProperty",audioFormat:"audio/wav",bufferSize:4096,channels:1,sampleRate:_audioContext.sampleRate}),navigator.getUserMedia({audio:!0,video:!1},_successCallBack,_errorCallBack),_removeEventListener()},_successCallBack=function(mediaStream){_recorderDiv.onclick||_setEventListener(),_mediaAccessWaitingTime=_audioContext.currentTime,_stream=mediaStream;var micAudio=_audioContext.createMediaStreamSource(mediaStream),context=micAudio.context,processor=(context.createScriptProcessor||context.createJavaScriptNode).call(context,4096,2,2);_analyser=_audioContext.createAnalyser(),processor.onaudioprocess=_onAudioProcessCallback,micAudio.connect(_analyser),_analyser.connect(processor),processor.connect(_audioContext.destination),CallImpl.isCallWithChat&&"FAQPLUSCALL"!=CallImpl.getTheme()?_initCanvas(_drawBar,50):_initCanvas(_drawWave,25)},_onAudioProcessCallback=function(event){var arrayBuffer=[];setRecordingTime(_audioContext.currentTime-_mediaAccessWaitingTime);for(var i=0;i<1;i++)arrayBuffer.push(event.inputBuffer.getChannelData(i));_recordingWorker.postMessage({command:"record",buffer:arrayBuffer})},_closeStream=function(){_stream&&(_stream.getTracks().forEach(function(track){track.stop()}),_stream=null)},_errorCallBack=function(){_destroy()},_RecordingWorker=function(){var samples,buffer=[],bufferSize=0,numChannels=2,sampleRate=0,operations={record:function(data){buffer.push(data.buffer[0]),data.buffer[1]&&buffer.push(data.buffer[1])},getView:function(){postMessage({key:"view",value:function(samples){function writeString(view,offset,string){for(var i=0;i<string.length;i++)view.setUint8(offset+i,string.charCodeAt(i))}var buf=new ArrayBuffer(44+2*samples.length),view=new DataView(buf);return writeString(view,0,"RIFF"),view.setUint32(4,36+2*samples.length,!0),writeString(view,8,"WAVE"),writeString(view,12,"fmt "),view.setUint32(16,16,!0),view.setUint16(20,1,!0),view.setUint16(22,numChannels,!0),view.setUint32(24,sampleRate,!0),view.setUint32(28,4*sampleRate,!0),view.setUint16(32,2*numChannels,!0),view.setUint16(34,16,!0),writeString(view,36,"data"),view.setUint32(40,2*samples.length,!0),function(output,offset,input){for(var i=0;i<input.length;i++,offset+=2){var s=Math.max(-1,Math.min(1,input[i]));output.setInt16(offset,s<0?32768*s:32767*s,!0)}}(view,44,samples),view}(function(){samples=new Float32Array(buffer.length*bufferSize);var k=0;if(1==numChannels)for(var i=0;i<buffer.length;i++)for(var j=0;j<bufferSize;j++)samples[k++]=buffer[i][j];else if(2==numChannels)for(var i=0;i<buffer.length;i+=2)for(var j=0;j<bufferSize;j++)samples[k++]=buffer[i][j],samples[k++]=buffer[i+1][j];return samples}())})},setProperty:function(data){data.audioFormat,bufferSize=data.bufferSize,numChannels=data.channels,sampleRate=data.sampleRate},clear:function(){buffer=[]}};self.onmessage=function(event){var data=event.data,command=data.command;operations[command]&&operations[command](data)}};var _initCanvas=function(callback,updateTime){canvasOptions.bufferLength=_analyser.frequencyBinCount,canvasOptions.dataArray=new Uint8Array(canvasOptions.bufferLength),canvasOptions.elem.style.backgroundColor="rgba(0,0,0,0)",canvasOptions.waveTrigger&&clearInterval(canvasOptions.waveTrigger),canvasOptions.waveTrigger=setInterval(function(){requestAnimationFrame(callback)},updateTime)},_drawWave=function(){_analyser.getByteTimeDomainData(canvasOptions.dataArray),_setCanvasStyle(),_isStopped&&(canvasOptions.lineX=canvasOptions.elem.width/_currAudioDuration*(_msec<_currAudioDuration-1?_msec:0),_plotLine(canvasOptions.ctx));for(var audio=0,i=0;i<canvasOptions.bufferLength;i++){var v=canvasOptions.dataArray[i]/128*(canvasOptions.elem.height/10)*1.5;audio=Math.max(audio,v)}canvasOptions.step+=canvasOptions.stepincrement;var step=canvasOptions.step;_plotSine(audio/1.5,step),_plotSine(-audio/1.5,1.5*step),_plotSine(audio/2,3*step)},_plotLine=function(ctx){ctx.beginPath(),ctx.moveTo(canvasOptions.lineX-1,50),ctx.lineTo(canvasOptions.lineX-1,100),ctx.stroke()},_plotSine=function(audio,step){var ctx=canvasOptions.ctx,x=0,y=0,frequency=1.5*canvasOptions.elem.width/10,height=audio/(canvasOptions.elem.height/6);for(height*=audio,canvasOptions.ctx.strokeStyle="rgb(35, 141, 233)",ctx.beginPath();x<canvasOptions.lineX;)y=canvasOptions.elem.height/2+height*Math.sin((x+step)/frequency),ctx.lineTo(x,y),x+=1;for(ctx.stroke(),canvasOptions.ctx.strokeStyle="white",ctx.beginPath();x<canvasOptions.elem.width;)y=canvasOptions.elem.height/2+height*Math.sin((x+step)/frequency),ctx.lineTo(x,y),x+=1;ctx.stroke()},_destroyWave=function(flagToStop){canvasOptions&&(canvasOptions.waveTrigger&&clearInterval(canvasOptions.waveTrigger),flagToStop&&(canvasOptions.lineX=0))},_setCanvasStyle=function(){canvasOptions.ctx.lineWidth=1.5,canvasOptions.ctx.clearRect(0,0,canvasOptions.elem.width,canvasOptions.elem.height),canvasOptions.ctx.fillStyle="rgba(100,100,100,0)",canvasOptions.ctx.fillRect(0,0,canvasOptions.elem.width,canvasOptions.elem.height),canvasOptions.ctx.moveTo(0,canvasOptions.elem.height/2)},_drawBar=function(){var barHeight,ctx=canvasOptions.ctx,dataArray=canvasOptions.dataArray,WIDTH=(canvasOptions.bufferLength,canvasOptions.elem.width),barWidth=WIDTH/36,HEIGHT=canvasOptions.elem.height,x=0;_analyser.getByteFrequencyData(canvasOptions.dataArray);var curr_theme=CallImpl.getTheme();ctx.fillStyle="theme3"==curr_theme?"rgb(51, 51, 51)":"rgb(255,255,255)",ctx.fillRect(0,0,WIDTH,HEIGHT);for(var cornerRadius=barWidth/4,i=18;0<=i;i--){var ratio=HEIGHT/(barHeight=dataArray[9<i?18-i:i]);ratio<1&&0!=barHeight&&(barHeight=HEIGHT*ratio),ctx.fillStyle="theme3"==curr_theme?"white":"rgb(73, 113, 127)",ctx.lineJoin="round",ctx.lineWidth=cornerRadius,ctx.fillRect(x+cornerRadius/2,(HEIGHT-barHeight)/2+cornerRadius/2,barWidth-cornerRadius,barHeight-cornerRadius),x+=2*barWidth}},_moveSlider=function(){var x=parseInt(canvasOptions.slider.clientWidth)/_currAudioDuration*(_msec<_currAudioDuration-1?_msec:0);x>canvasOptions.slider.clientWidth-4||(canvasOptions.slider.children[1].style.left=x+"px",canvasOptions.slider.children[0].style.width=x+"px")},setRecordingTime=function(time){_msec=parseInt(100*time);var sec=parseInt(_msec/100),min=parseInt(sec/60);if(_currAudioDuration<=_msec)return _updateTimerUI((_msec=_currAudioDuration)%100,sec%60,min),void _stopRecording();_updateTimerUI(_msec%100,sec%60,min)},startPlayingTimer=function(){clearInterval(_timer),_timer=setInterval(function(){var sec=parseInt(_msec/100),min=parseInt(sec/60);_updateTimerUI(_msec%100,sec%60,min),_currAudioDuration<=_msec?stopPlayingTimer():_msec++},10)},stopPlayingTimer=function(){clearInterval(_timer),_destroyWave(),_msec=0,_isPlaying=!1,_toggleButtons("play"),CallImpl.isCallWithChat&&(_timeDiv.innerHTML="00:00 / "+_getRemainingTime())},_updateTimerUI=function(_msec,sec,min){var remTime=CallImpl.isCallWithChat?_getRemainingTime():"";_timeDiv.innerHTML=(min<10?"0"+min:min)+":"+(sec<10?"0"+sec:sec),remTime&&_isStopped&&canvasOptions.slider?(_timeDiv.innerHTML+=" / "+remTime,_moveSlider()):_timeDiv.innerHTML+=":"+(_msec<10?"0"+_msec:_msec),remTime&&!_isStopped&&(_remTimeDiv.innerHTML=remTime)},_getRemainingTime=function(){var sec=parseInt(_currAudioDuration/100)-parseInt(_msec/100),min=parseInt(sec/60);return(min<10?"0"+min:min)+":"+((sec%=60)<10?"0"+sec:sec)};return{init:function(){_isAudioRecordingSupported()?(_setupWorkers(),_events={startRecord:_startRecording,stopRecord:_stopRecording,pauseRecord:_pausePlaying,playRecord:_playRecordedAudio,uploadRecord:_convertToMP3,cancelRecord:_destroy},CallImpl.isCallWithChat?_setWidgetAudioRecordUI():(_setHeadShotAudioRecordUI(),_startRecording())):_destroy()},destroy:function(){_destroy()},isAudioRecordingSupported:function(){return _isAudioRecordingSupported()}}};function avaction(){}function mediafailureoffer(stream,type){if(stream&&stream.name){if("NotAllowedError"!==stream.name){switch(stream.name){case"NotFoundError":case"DevicesNotFoundError":message=LSResource.getRealValue("av.info.microphone.notavailable");break;case"SourceUnavailableError":case"PermissionDeniedError":case"SecurityError":default:message=LSResource.getRealValue("av.info.microphone.blocked")}avimpl.checkMediaPermission(message,avimpl.chid),type&&avimpl.rejectCallInvite(avimpl.chid,null),LSDebugger.postDebugInfo("Audio Call - Inside Filure media | PeerConnection "+avimpl.pc,null,null,!0)}}else avimpl.StartAfterMediaPermission()}avaction.TYPE="AUDIO",avaction.supportedbrowsers=["Chrome","Firefox","Opera","Safari","Edge"],avaction.getScreenID=function(){return window.webkitRTCPeerConnection?'{"mandatory": { "chromeMediaSource": "desktop", "maxWidth": 1920, "maxHeight": 1080, "minAspectRatio": 1.77 }, "optional": [] }':'{"mediaSource":"screen"}'},avaction.constraints={AUDIO:{audio:!0,video:!1},VIDEO:{audio:!0,video:!0},SCREEN_SHARE:{audio:!1,video:JSON.parse(avaction.getScreenID())},SCREEN_VIEW:{audio:!0,video:!1}},avaction.init=function(data){if("credential"===data.msg.cbtype&&avimpl.setCredentials(data),"invite"===data.msg.cbtype&&(data.msg.credential&&avimpl.setCredentials(data),avimpl.showInvitation(data)),"accept"===data.msg.cbtype&&this.requestStream(data,UPSTREAM),"reject"===data.msg.cbtype&&(avimpl.showRejectedBanner(data),avimpl.handleUserBusy()),"candidate"===data.msg.cbtype&&(avimpl.connection_estb?avaction.addIceCandidate(data):(avimpl.newcandidate||(avimpl.newcandidate=[]),avimpl.newcandidate.push(data))),"answer"===data.msg.cbtype){var answermsg=JSON.parse(data.msg.answer);if(avimpl.pc.setRemoteDescription(new RTCSessionDescription(answermsg)),avimpl.connection_estb=!0,avimpl.newcandidate)for(var i in avimpl.newcandidate)avaction.addIceCandidate(avimpl.newcandidate[i]);avimpl.pc.onaddstream=avimpl.pc.ontrack=function(event){avimpl.remoteStream&&avimpl.remoteStream.active||avimpl.addremotestream(event)}}"endcall"===data.msg.cbtype&&avimpl.endCall(),"offer"===data.msg.cbtype&&this.requestStream(data,DOWNSTREAM)},avaction.setNRSServers=function(stun_turnurls){this.NRSServers=stun_turnurls},avaction.setCredentials=function(data){avaction.setNRSSereverUrls(data.msg.username,data.msg.credential),avimpl.chid=data.msg.entityid},avaction.setNRSSereverUrls=function(username,credential){this.NRSServers||(this.NRSServers=_STUN_TURN_URLS);var serverurls=this.NRSServers.split(","),connectionParams={iceServers:[]};for(var i in serverurls)connectionParams.iceServers.push({urls:serverurls[i],username:username,credential:credential});avimpl.iceServerlist=connectionParams,LSDebugger.postDebugInfo("Audio Call - Ice Servers "+avimpl.iceServerlist+" | Server urls "+this.NRSServers,null,null,!0)},avaction.requestStream=function(data,type){if(!avimpl.iceServerlist)return LSDebugger.postDebugInfo("Audio Call - End on reload| chid |"+avimpl.chid+" | Data "+data+" |type "+type,null,null,!0),void avimpl.endOnReload();if(LSDebugger.postDebugInfo("Audio Call - chat id after ice servers"+data.msg.uid+" | type "+type,null,null,!0),avimpl.getMediaApi=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||null,avimpl.getMediaApi)if(window.webkitRTCPeerConnection?(avimpl.hostbrowser="Chrome",window.RTCPeerConnection=webkitRTCPeerConnection):window.mozRTCPeerConnection&&(avimpl.hostbrowser="Firefox",window.RTCPeerConnection=mozRTCPeerConnection),avimpl.chid=data.msg.entityid,avimpl.mediaStream){var stream=avimpl.mediaStream;type==UPSTREAM?avaction.initializeConnection(stream,type):type==DOWNSTREAM&&(avimpl.offer=CommonUtil.parseToJSON(data.msg.offer),avaction.initializeConnection(stream,type))}else avimpl.getMediaApi.call(navigator,avaction.constraints[avaction.TYPE],function(stream){type==UPSTREAM?avaction.initializeConnection(stream,type):type==DOWNSTREAM&&(avimpl.offer=CommonUtil.parseToJSON(data.msg.offer),avaction.initializeConnection(stream,type))},function(stream){mediafailureoffer(stream,type)})},avaction.initializeConnection=function(stream,type){var sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};if(avimpl.pc=new RTCPeerConnection(avimpl.iceServerlist),avimpl.localStream=localStream=stream,avimpl.pc.addStream(stream),LSDebugger.postDebugInfo("Audio Call - Added local Stream | Stream "+stream+" | PeerConnection "+avimpl.pc+" type "+type,null,null,!0),type==DOWNSTREAM&&avimpl.pc.setRemoteDescription(new RTCSessionDescription(avimpl.offer)),avimpl.connection_estb=!0,avimpl.newcandidate)for(var i in avimpl.newcandidate)avaction.addIceCandidate(avimpl.newcandidate[i]);LSDebugger.postDebugInfo("Audio Call - Added candidate in Queue | avmpl.newcandidate "+avimpl.newcandidate+" | PeerConnection "+avimpl.pc+" | connectionstate "+avimpl.connection_estb,null,null,!0),avimpl.pc.onicecandidate=function(event){avimpl.addcandidate(event)},avimpl.pc.onaddstream=avimpl.pc.ontrack=function(event){avimpl.remoteStream&&avimpl.remoteStream.active||avimpl.addremotestream(event)},LSDebugger.postDebugInfo("Audio Call - Added onicecandidate and onaddstream | Stream "+stream+" | PeerConnection "+avimpl.pc+" type "+type,null,null,!0),avimpl.addAudioElemts(),type==UPSTREAM?avimpl.pc.createOffer().then(avimpl.successOffer,avaction.sendLog,sdpConstraints):("Firefox"===avimpl.hostbrowser&&(sdpConstraints=sdpConstraints.mandatory),avimpl.pc.createAnswer(avimpl.successOffer,avaction.sendLog,sdpConstraints)),avimpl.pc.oniceconnectionstatechange=function(event){var status=avimpl.pc.iceConnectionState;LSDebugger.postDebugInfo("Audio Call - State change event | event "+status+" | PeerConnection "+avimpl.pc,null,null,!0),status==AV_CONNECTED?avimpl.callConnected(event):status==AV_FAILED&&avimpl.callFailure(type)}},avaction.addIceCandidate=function(data){LSDebugger.postDebugInfo("Audio Call - Inside Add Ice Candidate | data "+data+" | PeerConnection "+avimpl.pc,null,null,!0);var message=JSON.parse(data.msg.candidate),candidate=new RTCIceCandidate({sdpMid:message.id,sdpMLineIndex:message.label,candidate:message.candidate});avimpl.pc.addIceCandidate(candidate)},avaction.checkMediaPermission=function(){if(avimpl.getMediaApi=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||null,!avimpl.getMediaApi)return!1;avimpl.getMediaApi.call(navigator,avaction.constraints[avaction.TYPE],function(stream){mediafailureoffer(null),avimpl.mediaStream=stream},function(stream){mediafailureoffer(stream)})},avaction.sendLog=function(){LSDebugger.postDebugInfo("Audio Call - Inside Filure offer | PeerConnection "+avimpl.pc,null,null,!0)},avaction.getBrowserFromUserAgent=function(userAgent){var user=userAgent.toLowerCase(),browser="unknown-unknown";if(-1<user.indexOf("msie")){var substring=userAgent.substring(userAgent.indexOf("MSIE")).split(";")[0];browser=substring.split(" ")[0].replace("MSIE","IE")+"-"+substring.split(" ")[1]}else-1<user.indexOf("edge")?browser=userAgent.substring(userAgent.indexOf("Edge")).split(" ")[0].replace("/","-"):-1<user.indexOf("safari")&&-1<user.indexOf("version")?browser=userAgent.substring(userAgent.indexOf("Safari")).split(" ")[0].split("/")[0]+"-"+userAgent.substring(userAgent.indexOf("Version")).split(" ")[0].split("/")[1]:-1<user.indexOf("opr")||-1<user.indexOf("opera")?-1<user.indexOf("opera")?browser=userAgent.substring(userAgent.indexOf("Opera")).split(" ")[0].split("/")[0]+"-"+userAgent.substring(userAgent.indexOf("Version")).split(" ")[0].split("/")[1]:-1<user.indexOf("opr")&&(browser=userAgent.substring(userAgent.indexOf("OPR")).split(" ")[0].replace("/","-").replace("OPR","Opera")):-1<user.indexOf("chrome")?browser=userAgent.substring(userAgent.indexOf("Chrome")).split(" ")[0].replace("/","-"):-1<user.indexOf("firefox")&&(browser=userAgent.substring(userAgent.indexOf("Firefox")).split(" ")[0].replace("/","-"));return browser},avaction.isBrowserSupported=function(useragent){var agentbrowser=this.getBrowserFromUserAgent(useragent),browsername=agentbrowser.split("-")[0],browserversion=parseInt(agentbrowser.split("-")[1]),isbrowsersupported=!1;switch(browsername){case"Chrome":isbrowsersupported=23<=browserversion;break;case"Firefox":isbrowsersupported=22<=browserversion;break;case"Opera":isbrowsersupported=18<=browserversion;break;case"Safari":isbrowsersupported=11<=browserversion}return isbrowsersupported},avaction.displaySettingUI=function(html){var mediaDevices={camera:[],mic:[],speaker:[]},deviceIdMap={};navigator.mediaDevices.enumerateDevices().then(function(devices){devices.forEach(function(device){"videoinput"==(deviceIdMap[device.kind+"&"+device.deviceId]=device).kind?mediaDevices.camera.push(device):"audioinput"==device.kind?mediaDevices.mic.push(device):"audiooutput"==device.kind&&mediaDevices.speaker.push(device)});var stnghtml='<div class="siq-setngs-view font16" id="audio_setting"> <div class="setngs-head c666"><span class="sel-bor" mdevice-switch="mic">Audio Input</span> <span mdevice-switch="speaker" >Sound Output</span> </div>';if(mediaDevices.mic.length){var select=avimpl.localStream?avimpl.localStream.getAudioTracks()[0].label:"default";stnghtml+='<div class="setngs-optn c333 font14 mL20" mdevice-cnt="mic">',mediaDevices.mic.forEach(function(device){var sel="";select===device.deviceId&&(sel='class="sqico-tick"'),stnghtml+="<div "+sel+' deviceid="'+device.deviceId+'">'+device.label+"</div>"}),stnghtml+="</div>"}if(mediaDevices.speaker.length){select="default";stnghtml+='<div class="setngs-optn c333 font14 mL20" mdevice-cnt="speaker" style="display:none;">',mediaDevices.speaker.forEach(function(device){var sel="";select===device.deviceId&&(sel='class="sqico-tick"'),stnghtml+="<div "+sel+' deviceid="'+device.deviceId+'">'+device.label+"</div>"}),stnghtml+="</div>"}stnghtml+="</div>",$(window.parent.document).find("body").append(stnghtml),$("#audio_setting",parent.document).on("click","[mdevice-switch]",function(){$("#audio_setting",parent.document).find("[mdevice-switch]").removeClass("sel-bor");var category=$(this).addClass("sel-bor").attr("mdevice-switch");$("#audio_setting",parent.document).find("[mdevice-cnt]").hide(),$("#audio_setting",parent.document).find('[mdevice-cnt="'+category+'"]').show()}),$("#audio_setting",parent.document).on("click","[deviceid]",function(){var category=$(this).parent().attr("mdevice-cnt");if($("#audio_setting",parent.document).find('[mdevice-cnt="'+category+'"]').children().removeClass("sqico-tick"),$(this).addClass("sqico-tick"),"mic"!=category){var deviceid=$(this).attr("deviceid"),element=document.getElementById("remoteaudio");void 0!==element.sinkId&&element.setSinkId(deviceid).then(function(){})}});var siqframe=parent.document.getElementById("siqiframe").getBoundingClientRect(),callicon=document.getElementById("call_stngicon").getBoundingClientRect(),setngdiv=parent.document.getElementById("audio_setting").style;setngdiv.left=siqframe.left+callicon.left-260+"px",setngdiv.top=siqframe.top+callicon.top+15+"px",$(document).click(function(event){$(event.target).closest("#audio_setting",parent.document).length||$(event.target).closest("#call_stngicon",parent.document).length||$("#audio_setting",parent.document).is(":visible")&&$("#audio_setting",parent.document).hide()})})};$FAQ=function(){_searchtimer=0;var _getprefixURL=function(){return _SCHEMA+"://"+_EMBEDSERVERURL},_handleArticleList=function(callback){var sessiondata=$Support.LSDB.getFromSession(_getSessionKey());if(sessiondata)callback(sessiondata);else{$("#faqdiv").html($Temp.getLoadingHTML());var deptid=$Support.EmbedObj.mappeddept,depturl="";deptid&&"-1"!==deptid&&(depturl="department_id="+deptid),$Support.getParent().$ZSIQUtil.ajax(_getprefixURL()+"/visitor/v2/"+_SCREENNAME+"/cannedmessages/count?"+depturl,function(response){var data=JSON.parse(response).data;$Support.LSDB.storeInSession(_getSessionKey(),data),callback(data)},"",!0)}},_updateVote=function(data,articleid,callback,type){$.ajax({url:_getprefixURL()+"/visitor/v2/"+_SCREENNAME+"/cannedmessages/"+articleid+"/vote?type="+type,type:"POST",dataType:"json",data:data,success:function(data){callback(data)}})},_getArticleList=function(deptid,cat_id,callback,ignorelimit){var key=cat_id?"_"+cat_id:"",sessiondata=$Support.LSDB.getFromSession("faq_"+deptid+key);if(ignorelimit||!sessiondata){var posturl="",limit=99;cat_id?(posturl="&canned_category_id="+cat_id,limit=ignorelimit?99:15,$("#"+cat_id).html('<div class="cat_loading">'+$Temp.getLoadingHTML()+"</div>")):$("#faqdiv").html($Temp.getLoadingHTML());posturl=cat_id?"&canned_category_id="+cat_id:"";$Support.getParent().$ZSIQUtil.ajax(_getprefixURL()+"/visitor/v2/"+_SCREENNAME+"/cannedmessages?limit="+limit+"&department_id="+deptid+posturl,function(response){var data=JSON.parse(response).data;callback(data)},function(){},!0)}else callback(sessiondata)},_renderCategoryHeader=function(deptid){var sessiondata=$Support.LSDB.getFromSession(_getSessionKey());if(sessiondata){for(var categoryinfo=[],i=0;i<sessiondata.length;i++)if(sessiondata[i].department_id===deptid){categoryinfo=sessiondata[i].categoryinfo;break}var acc_header="";for(i=0;i<categoryinfo.length;i++){var cat_id=categoryinfo[i].categoryid;acc_header+='<div class="posrel" category_id="'+cat_id+'" data-type="accordian"><div data-type="accordian-item"><div id="'+cat_id+'"></div><div class="artcle-viewal" documentclick="extendview">'+LSResource.getRealValue("faq.article.viewall")+'</div></div><div data-type="accordian-header" class="dsp_table faq-cat"><div>'+categoryinfo[i].categoryname+'</div><div class="sqico-darrow"></div></div></div>'}}var faqdiv=$("#faqdiv"),isfadeEffect=!faqdiv.find("#article-wrap").length;faqdiv.html('<div id="article-wrap">'+acc_header+"</div>"),isfadeEffect&&faqdiv.hide().fadeIn(),$Support.Util.handleAccordian(function(curr){var dept_id=faqdiv.attr("department_id"),cat_id=curr.parent().attr("category_id");_getArticleList(dept_id,cat_id,function(data){$Support.LSDB.storeInSession("faq_"+dept_id+"_"+cat_id,data),_populateArticles(dept_id,"",data,cat_id),15<data.length&&_showViewArticle(cat_id)})}),$('[data-type="accordian-header"]:first').trigger("click")},_populateArticles=function(deptid,srchval,data,cat_id){data=data||$Support.LSDB.getFromSession("faq_"+deptid);for(var iscategoryenabled=_isShowArticleByCategory(srchval),count=0,cnt="",deptmapping=[],j=0;j<data.length;j++){var articleobj={};if("object"==typeof data[j]&&(articleobj=$Support.LSDB.getFromSession("article_"+data[j].id)||data[j]),0!==getObjectSize(articleobj)){var msg=CommonUtil.decodeHTML(articleobj.message).replace(/<br *\/?>/gi," "),liked=articleobj.visitors_liked?'<em class="sqico-like">'+articleobj.visitors_liked+"</em>":"",viewed=articleobj.visitors_viewed?"<em viewid="+articleobj.id+">"+articleobj.visitors_viewed+"</em> "+LSResource.getRealValue("faq.views"):LSResource.getRealValue("faq.noviews");cnt+='<div class="dsp_table faqarticle" documentclick="faqpreview" article-id="'+articleobj.id+'"><div class="sqico-faqarticle"></div><div class="f15">'+getEncodedText(msg)+'<p class="font14 article">'+viewed+liked+"</p></div></div>",deptmapping.push(articleobj.id),count++}}iscategoryenabled&&$("#"+cat_id).html(cnt),count&&!iscategoryenabled&&$("#faqdiv").html(cnt),count||$("#faqdiv").html(_noResultsHTML(srchval))},_showViewArticle=function(cat_id){$("#"+cat_id).addClass("view_article"),$(".artcle-viewal").attr("categoryid",cat_id)},_noResultsHTML=function(srchval){var norarticletext=(srchval=srchval||"")?LSResource.getRealValue("faq.noarticles"):LSResource.getRealValue("faq.empty.articles"),btntext=-1==$Support.EmbedObj.chatID?LSResource.getRealValue("ne.chatnow"):LSResource.getRealValue("ne.gotochat");return'<div class="nofaq"><div class="faq-reslt-img"></div><p>'+srchval+"</p>"+norarticletext+($Support.EmbedObj.status?'<div class="chatnw"><em class="wincustom_clr" documentclick="showchatui">'+btntext+"</em></div>":"")+"</div>"},_isShowArticleByCategory=function(srchval){return!srchval&&(!!$Support.EmbedObj.faqaccess.length&&"1"==$Support.EmbedObj.faqaccess[1].orderbycategory)},_getSessionKey=function(deptid){return deptid?"faq_"+deptid:"faq_count"},_populateDepartmentList=function(data,srchval){for(var cnt="",i=0;i<data.length;i++){var article=data[i],articlecount=article.count;if(0!==articlecount){var deptname=article.department_name;void 0!==srchval&&-1===deptname.toLowerCase().indexOf(srchval.toLowerCase())||(articlecount=1===articlecount?articlecount+" "+LSResource.getRealValue("faq.article"):articlecount+" "+LSResource.getRealValue("faq.articles"),cnt+='<div class="dsp_table faqlst" documentclick="faqcategory" department="'+deptname+'" departmentid="'+article.department_id+'"><div class="sqico-faqdept"></div><div>'+deptname+'<p class="font14 article">'+articlecount+"</p></div></div>")}}var faqdiv=$("#faqdiv");if(cnt){var isfadeEffect=!faqdiv.find(".faqlst").length;faqdiv.html(cnt),isfadeEffect&&faqdiv.hide().fadeIn()}else faqdiv.html(_noResultsHTML(srchval))},_updateHeader=function(data){$(".faq-srch").remove();var heading=data.title||"";heading=data.hasarrow?'<span class="sqico-larrow" documentclick="showfaq"></span>'+heading:heading;var desc=data.desc||"",classname=data.classname||"";$("#attname").html(heading),$("#attabtme").html(desc).after('<div class="faq-srch min-view" documentclick="faqsearch"><span class="sqico-search"></span><input type="text" id="faqsearch-field" placeholder="'+LSResource.getRealValue("faq.search.hint")+'" dockeyup="searchfaq" dockeydown="searchfaq"/><em class="sqico-close"></em></div>'),("2"===$Support.container.attr("themeid")?$("#cmpylogo"):$("header")).removeClass("category").addClass(classname)},_updateSession=function(data,$curr){var ses=$Support.LSDB.getFromSession("article_"+data.id[0]),obj={2:"visitors_viewed",3:"visitors_liked",4:"visitors_disliked"},type=data.type[0];ses[obj[type]]=parseInt(ses[obj[type]])+1,$Support.LSDB.storeInSession("article_"+data.id[0],ses),$curr.find("em[viewid="+data.id+"]").text(ses[obj[type]])},_getBGImageHTML=function(){return'<div id="faqbox" class="siq_content"><div class="zsiq-wrap"><div class="zsiq-wrap-body"><div class="zsiq-wrap-child"><span>Q</span><div class="zsiq-wrp-lne"></div></div><div class="zsiq-wrap-child"><span>A</span><div class="zsiq-wrp-lne"></div></div></div><div class="zsiq-wrap-body2"><div class="zsiq-wrap-child"><span>Q</span><div class="zsiq-wrp-lne"></div></div><div class="zsiq-wrap-child"><span>A</span><div class="zsiq-wrp-lne"></div></div></div></div><div id="faqdiv"></div></div>'};return{showFAQUI:function(curr){if(!$Support.Util.isPreview()){var faqdiv=$("#faqdiv");faqdiv.length||($("footer").before(_getBGImageHTML()),faqdiv=$("#faqdiv")),curr.addClass("sel").prev(".sel").removeClass("sel"),faqdiv.parents(".siqembed").children("section").hide(),_handleArticleList(function(data){_populateDepartmentList(data)}),$Support.Util.updateViewAttribute("faqview"),_updateHeader({title:$Support.Util.getFAQLabel(),desc:LSResource.getRealValue("faq.header.desc")}),$Support.Util.calculateContentHeight(),$("#faqdiv").removeAttr("department_id")}},showCategory:function(curr){if(!$Support.Util.isPreview()){var dept_id=curr.attr("departmentid");$("#faqdiv").attr("department_id",dept_id),_isShowArticleByCategory()?_renderCategoryHeader(dept_id):_getArticleList(dept_id,"",function(data){$Support.LSDB.storeInSession("faq_"+dept_id,data),_populateArticles(dept_id,"",data)}),_updateHeader({title:curr.attr("department"),classname:"category",hasarrow:!0})}},handleSearch:function(curr){if(!$Support.Util.isPreview()){curr.removeClass("min-view category");var srchbox=curr.find("input").focus();curr.find(".sqico-close").on("click",function(e){curr.addClass("min-view"),srchbox.val(""),$FAQ.searchFAQ(srchbox),e.stopPropagation()})}},showFAQPreview:function($curr){var articleid=$curr.attr("article-id"),showvote=$Support.getParent().$ZSIQUtil.getCookieValue("Article_"+articleid);!function(articleid,callback){var sessiondata=$Support.LSDB.getFromSession("article_"+articleid)||{},articleinfo=sessiondata.article_info;sessiondata&&articleinfo&&articleinfo.content?callback(sessiondata):$Support.getParent().$ZSIQUtil.ajax(_getprefixURL()+"/visitor/v2/"+_SCREENNAME+"/cannedmessages/"+articleid,function(response){var data=JSON.parse(response).data;$Support.LSDB.storeInSession("article_"+articleid,data),callback(data)},function(){},!0)}(articleid,function(data){if(data&&data.message){_updateVote(JSON.stringify({type:"2"}),articleid,function(data){_updateSession(data,$curr)},2);var chtnowhtml,previewhtml=(chtnowhtml=$Support.EmbedObj.status?'<div class="zsiq-cbtn" onclick="$ZSIQChatWindow.startChat(event)">{CHATNOW}</div>':"",'<div class="zsiq_prv_main" zsiqclose="true" id="zsiqimagepreview" onclick="$ZSIQChatWindow.closeImagePreview(event)"><div id="zsiqfaqpreview" articleid="{ARTICLEID}"><div class="zsiq-prev-body"><div class="zsiq-prev-header" id="zsiq-prev-header">{HEADER}</div><div class="zsiq-prev-content"><div>{CONTENT}</div></div></div><div class="zsiq-footer">'+_getBGImageHTML()+chtnowhtml+'{VOTE}</div><em class="sqico-close" zsiqclose="true" onclick="$ZSIQChatWindow.closeImagePreview(event)"></em></div></div>'),btntext=-1==$Support.EmbedObj.chatID?LSResource.getRealValue("ne.chatnow"):LSResource.getRealValue("ne.gotochat"),votehtml=""===showvote?function(data){var liked=data.visitors_liked||"",disliked=data.visitors_disliked||"";return'<div class="zsiq-aside">'+LSResource.getRealValue("faq.ishelpful")+'<span class="sqico-like" onclick="$ZSIQChatWindow.updateVote(event, this)" data-vote="3">'+liked+'</span><span class="sqico-dislike" onclick="$ZSIQChatWindow.updateVote(event, this)"  data-vote="4">'+disliked+"</span></div>"}(data):"";previewhtml=previewhtml.replace(/{HEADER}/g,data.message).replace(/{ARTICLEID}/g,articleid).replace(/{VOTE}/g,votehtml).replace(/{CHATNOW}/g,btntext).replace(/{CONTENT}/g,data.article_info.content),$(window.parent.document).find("body").append(previewhtml)}else $(window.parent.document).find("body").append('<div class="zsiq_prv_main" zsiqclose="true" id="zsiqimagepreview" onclick="$ZSIQChatWindow.closeImagePreview(event)"><div id="zsiqfaqpreview" class="siq-empty-slate" articleid="{ARTICLEID}"><div class="zsiq-prev-body"><div class="siq-emtyimg"><img src="https://img.zohostatic.com/salesiq/Jul_19_2018_1_https/images/articleemptystate.svg"></div><p class="siq-emtydesc">'+LSResource.getRealValue("faq.empty.desc")+'</p></div><div class="zsiq-footer">'+_getBGImageHTML()+'</div><em class="sqico-close" zsiqclose="true" onclick="$ZSIQChatWindow.closeImagePreview(event)"></em></div></div>')})},updateVote:function(e,curr){curr=$(curr);var data=JSON.stringify({type:curr.attr("data-vote")}),prevwin=curr.parents("#zsiqfaqpreview");_updateVote(data,prevwin.attr("articleid"),function(data){_updateSession(data,curr),curr.parent().html(LSResource.getRealValue("faq.feedback"))},curr.attr("data-vote"))},getCustomCard:function(msg){var articleobj=JSON.parse(CommonUtil.decodeHTML(msg)),cnt="";if("object"==typeof articleobj){var agentphotourl=articleobj.owner_imgkey?_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+articleobj.owner_imgkey+"/photo.ls?nocache=1":"";cnt='<div class="ext-msg-card" documentclick="faqpreview" article-id="'+articleobj.id+'"><div class="card-header"><em class="ext-icon">?</em><span class="dsplycell">'+articleobj.header+'</span></div><div class="card-footer"><img src="'+agentphotourl+'" />'+LSResource.getRealValue("faq.articleby")+" <em>"+articleobj.ownername+"</em></div></div>"}return cnt},getHeaderMessage:function(msg){var articleobj=JSON.parse(CommonUtil.decodeHTML(msg));return"object"==typeof articleobj?articleobj.header:""},searchFAQ:function(curr,ev){clearTimeout(_searchtimer);var key=$Support.Util.getKeyCode(ev);if(!(-1<["37","38","39","40","13","9","16"].indexOf(key))){var query=$.trim(curr.val()).toLowerCase();!query||query.length<3?function(srchval){var deptid=$("#faqdiv").attr("department_id");if(deptid){if(""===srchval&&_isShowArticleByCategory())return _renderCategoryHeader(deptid);_populateArticles(deptid,srchval)}else _handleArticleList(function(data){_populateDepartmentList(data)})}(query):_searchtimer=setTimeout(function(){!function(query,callback){$Support.getParent().$ZSIQUtil.ajax(_getprefixURL()+"/"+_SCREENNAME+"/searchcanned.ls?query="+query+"&entities=2&mode=listview",function(response){var data=JSON.parse(response);data&&0==data[0].res_count&&(data=[]),callback(data)},"",!0)}(query,function(data){query===curr.val().toLowerCase()&&_populateArticles("",query,data)})},500)}},updateMessageCount:function(opr){if("newmsg"===opr||"newchat"===opr||"triggerchat"===opr){var count=$Support.getUnreadCount();count&&($("#conv-tab").addClass("count").find(".siqc_eletype").show().html(count)[0].className="siqc_eletype")}},showAllArticlesInCategory:function(curr){curr.parent().find(".view_article").removeAttr("style").removeClass("view_article");var dept_id=$("#faqdiv").attr("department_id"),cat_id=curr.attr("categoryid");_getArticleList(dept_id,cat_id,function(data){_populateArticles(dept_id,"",data,cat_id)},!0)}}}();